{
    "name": "Tokens sale",
    "conditions": "ContractConditions(\"@1DeveloperCondition\")",
    "data": [
        {
            "Name": "ts_contract_investors",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "Div(list-group-item mt-lg mb-lg ml-lg mr-lg){\n    Div(Class: h3 text-bold m0 text-center, Body: To Apla Users who have passed)\n    Div(Class: h3 text-bold m0 text-center, Body: the KYC screening at SnapSwap International S.A.)\n\n    Div(Class: h4 mt-xl, Body: Em(Date: 1st of November 2018))\n    Div(Class: h4, Body: Em(Re: Invitation to submit purchase orders to buy APLA Tokens))\n\n    Div(Class: h4 mt-xl, Body: Dear Apla User,)\n    Div(Class: h4, Body: We are very delighted that you have chosen the Apla blockchain platform to build decentralised applications, create ecosystems and accommodate your other business needs.)\n    Div(Class: h4, Body: According to Article 8.1 of the Apla General Terms and Conditions (Span(Class: text-primary, Body: www.apla.io)), EGAAS S.A. will be charging a license fee for each transaction signed by Apla users on the platform. The license fee is payable in the internal virtual currency of the Apla platform ecosystem named APLA tokens. Hence, in order to use the platform, you will need to have APLA tokens on your APLA Wallet prior to signing each transaction.)\n    Div(Class: h4){\n        Span(EGAAS S.A. will be conducting an initial sale of APLA Tokens from November 2018 until July 2019. The commercial terms of the sale are summarised below:)\n        Button(Class: btn-xs btn-link, Page: ts_commercial_terms){\n            Span(Class: h4, Body: The commercial terms)\n        }.Popup(70, The commercial terms)\n    }\n\n    Div(Class: h4, Body: Please submit your purchase order to buy APLA tokens after you have reviewed and agreed with the legal terms of sale.)\n    Div(Class: h4, Body: After we have received your purchase order, we will send you an invoice for making the payment of the purchase price.)\n    Div(Class: h4, Body: Please reach out to us via the email Span(Class: text-primary, Body: luxembourg@apla.io) if you have any questions or require any clarification of the above terms. We’ll also give you an access to the online data room with all information and legal documents concerning the Apla project, if you require so.)\n\n    Div(Class: h4 mt-xl, Body: Kind regards,)\n    Div(row){\n        Div(col-sm-6){\n            Div(Class: h4 m0, Body: Oleg Strelenko)\n        }\n        Div(col-sm-6){\n            Div(Class: h4 m0, Body: Vitaly Bondar)\n        }\n    }\n    Div(row){\n        Div(col-sm-6){\n            Div(Class: h4 m0, Body: Director)\n        }\n        Div(col-sm-6){\n            Div(Class: h4 m0, Body: Director)\n        }\n    }\n\n    Div(Class: h4 mt-xl, Body: Annexes:)\n    Div(Class: h4 m0, Body: Annex 1. Purchase Order)\n    Div(Class: h4 m0, Body: Annex 2. Standard Terms & Conditions of Sale)\n\n    Div(row mt-xl pull-right){\n        Div(col-sm-12){\n            Button(Class: btn btn-primary h4, Page: ts_buyer_contract, Body: Standard terms and conditions of sale)\n        }\n    }\n}.Style(\n    padding-left: 60px!important; \n    padding-right: 60px!important;\n)",
            "Type": "blocks"
        },
        {
            "Name": "admin_menu",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "If(#ecosystem_id# == 1){\n    MenuItem(Title:$@1ts_settings$, Page:ts_settings, Icon:\"icon-wrench\")\n}",
            "Type": "menu"
        },
        {
            "Name": "default_menu",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "If(#ecosystem_id# == 1){\n    SetVar(is_allowed, 0).(k_id, 0).(unreaded_wallet_id,0).(exist_wallet_id,0)\n    DBFind(@1keys).Where({id:#key_id#}).Vars(k)\n    DBFind(@1ts_wallets).Where({key_id_buyer:#key_id#}).Vars(exist_wallet)\n    DBFind(@1ts_wallets).Where({key_id_buyer:#key_id#, rejected_at:0, signed_at:0}).Vars(unreaded_wallet)\n    If(#k_id#!=0){\n        If(#exist_wallet_id#>0){\n            If(#unreaded_wallet_id#==0){\n                SetVar(is_allowed, 1)\n            }\n        }.Else{\n            SetVar(is_allowed, 1)\n        }\n    }\n    If(#is_allowed#==1){\n        SetVar(snapswap_role_id,0).(admin_role_id,0).(manager_role_id,0).(seller_role_id,0)\n        SetVar(snapswap_role_id, EcosysParam(Name:role_snapswap))\n        SetVar(admin_role_id, EcosysParam(Name:role_sale_admin))\n        SetVar(manager_role_id, EcosysParam(Name:role_sale_manager))\n        SetVar(seller_role_id, EcosysParam(Name:role_sale_seller))\n\n        Span(\"Set here the menu of the first ecosystem\")\n        If(And(#role_id#>0,Or(#role_id#==#admin_role_id#,#role_id#==#manager_role_id#,#role_id#==#seller_role_id#,#role_id#==#snapswap_role_id#))){\n            MenuItem(Title:$@1ts_free_wallets$, Page:@1ts_free_wallets, Icon:\"icon-credit-card\")\n        }\n        If(And(#role_id#>0,Or(#role_id#==#admin_role_id#,#role_id#==#manager_role_id#,#role_id#==#seller_role_id#,#role_id#==#snapswap_role_id#))){\n            MenuItem(Title:$@1ts_wallets$, Page:@1ts_wallets, Icon:\"icon-credit-card\")\n        }\n        If(And(#role_id#>0,Or(#role_id#==#admin_role_id#,#role_id#==#manager_role_id#,#role_id#==#seller_role_id#,#role_id#==#snapswap_role_id#))){\n            MenuItem(Title:$@1ts_sales$, Page:@1ts_sales, Icon:\"icon-credit-card\")\n        }\n    }\n}",
            "Type": "menu"
        },
        {
            "Name": "ts_sales",
            "Columns": "[\n    {\n        \"conditions\": \"false\",\n        \"name\": \"buyer_transferred_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\")\",\n        \"name\": \"seller_reject_comment\",\n        \"type\": \"text\"\n    },\n    {\n        \"conditions\": \"false\",\n        \"name\": \"amount\",\n        \"type\": \"varchar\"\n    },\n    {\n        \"conditions\": \"false\",\n        \"name\": \"currency_type\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\")\",\n        \"name\": \"manager_rejected_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferSeller\\\")\",\n        \"name\": \"seller_transferred_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"false\",\n        \"name\": \"amount_apl\",\n        \"type\": \"money\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\",\\\"@1TsTransferSeller\\\")\",\n        \"name\": \"key_id_seller\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\")\",\n        \"name\": \"seller_rejected_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"false\",\n        \"name\": \"key_id_sale_apl_admin\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\")\",\n        \"name\": \"manager_reject_comment\",\n        \"type\": \"text\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\",\\\"@1TsTransferManager\\\")\",\n        \"name\": \"key_id_sale_apl_manager\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"false\",\n        \"name\": \"created_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"false\",\n        \"name\": \"key_id_buyer\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\",\\\"@1TsTransferManager\\\",\\\"@1TsTransferAdmin\\\",\\\"@1TsTransferSeller\\\")\",\n        \"name\": \"status\",\n        \"type\": \"number\"\n    }\n]",
            "Permissions": "{\"insert\": \"ContractAccess(\\\"@1TsTransferAdmin\\\")\", \"update\": \"ContractAccess(\\\"@1TsTransferReject\\\",\\\"@1TsTransferSeller\\\",\\\"@1TsTransferManager\\\")\", \"new_column\": \"ContractConditions(\\\"@1AdminCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Name": "ts_wallets",
            "Columns": "[\n    {\n        \"conditions\":\"ContractAccess(\\\"@1TsBuyerAction\\\",\\\"@1TsConsensusAction\\\")\",\n        \"name\":\"rejected_at\",\n        \"type\":\"number\"\n    },\n    {\n        \"conditions\":\"ContractAccess(\\\"@1TsKeyApprove\\\")\",\n        \"name\":\"key_id_buyer\",\n        \"type\":\"number\"\n    },\n    {\n        \"conditions\":\"ContractAccess(\\\"@1TsConsensusAction\\\")\",\n        \"name\":\"key_id_signer\",\n        \"type\":\"number\"\n    },\n    {\n        \"conditions\":\"false\",\n        \"name\":\"btc\",\n        \"type\":\"money\"\n    },\n    {\n        \"conditions\":\"false\",\n        \"name\":\"eth\",\n        \"type\":\"money\"\n    },\n    {\n        \"conditions\":\"ContractAccess(\\\"@1TsBuyerAction\\\")\",\n        \"name\":\"signed_at\",\n        \"type\":\"number\"\n    },\n    {\n        \"conditions\":\"ContractAccess(\\\"@1TsKeyApprove\\\")\",\n        \"name\":\"created_at\",\n        \"type\":\"number\"\n    },\n    {\n        \"conditions\": \"false\",\n        \"name\": \"wallet_eth\",\n        \"type\": \"text\"\n    },\n    {\n        \"conditions\": \"false\",\n        \"name\": \"wallet_btc\",\n        \"type\": \"text\"\n    },\n    {\n        \"conditions\":\"ContractAccess(\\\"@1TsFreeWalletDelete\\\")\",\n        \"name\":\"deleted\",\n        \"type\":\"number\"\n    },\n    {\n        \"conditions\":\"ContractAccess(\\\"@1TsKeyApprove\\\")\",\n        \"name\": \"pub_buyer\",\n        \"type\": \"text\"\n    },\n    {\n        \"conditions\":\"ContractAccess(\\\"@1TsKeyApprove\\\")\",\n        \"name\": \"pub_short_buyer\",\n        \"type\": \"text\"\n    }\n]",
            "Permissions": "{\"insert\": \"ContractAccess(\\\"@1TsFreeWalletAdd\\\")\", \"update\": \"ContractAccess(\\\"@1TsBuyerAction\\\",\\\"@1TsConsensusAction\\\",\\\"@1TsKeyApprove\\\",\\\"@1TsFreeWalletDelete\\\")\", \"new_column\": \"ContractConditions(\\\"@1AdminCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Name": "ts_currency_type",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "@1btc,@1eth,@1euro",
            "Type": "app_params"
        },
        {
            "Name": "ts_statuses",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "@1waiting_manager_approved,@1waiting_seller_transfer,@1finished,@1rejected",
            "Type": "app_params"
        },
        {
            "Name": "ts_statuses_classes",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "text-muted,text-info,text-success,text-warning",
            "Type": "app_params"
        },
        {
            "Name": "default_page",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "If(#ecosystem_id# == 1){\n    DBFind(@1ts_wallets).Where({key_id_buyer:#key_id#, rejected_at:0, signed_at:0}).Vars(unconfirmed_wallet)\n    If(#unconfirmed_wallet_id#>0){\n        Include(@1ts_contract_investors)\n    }.Else{\n        Include(@1profile)\n    }\n}\nIf(#ecosystem_id# > 1){\n    DBFind(@1roles).Where({\"ecosystem\": #ecosystem_id#}).Count(roles_count)\n    If(#roles_count# > 0){\n        Include(@1profile)\n    }.Else{\n        Include(@1welcome)\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_buyer_congratulation",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1ts_wallets).Where({\"key_id_buyer\":#key_id#}).Vars(w)\nIf(#w_id# > 0){\n    Div(list-group-item mt-lg mb-lg ml-lg mr-lg){\n        Div(Class: h3 text-bold text-center pb-xl, Body: Purchase Order)\n        Div(Class: h4 pb-lg, Body: In response to your invitation to submit a purchase order as of 1s tof November 2018, we would like to submit the below purchase order to buy APLA Tokens: )\n            Div(){\n                Div(row){\n                    Div(col-md-12){\n                        Div(table tablez){\n                            Div(table__row){\n                                Div(table__cell table__cell_10){APLA Wallet Number}\n                                Div(table__cell table__cell_10){Address(#key_id#)}\n                            }\n                            Div(table__row){\n                                Div(table__cell table__cell_10){Number of APLA Tokens to buy}\n                                Div(table__cell table__cell_10){}\n                            }\n                            Div(table__row){\n                                Div(table__cell table__cell_10 tborder){Payment means}\n                                Div(table__cell table__cell_10 tborder){\n                                    Div(Class: text-normal, Body: BTC: #w_wallet_btc#)\n                                    Div(Class: text-normal, Body: ETH: #w_wallet_eth#)\n                                }\n                            }\n                        }\n                    }\n                }\n            }.Style(\n                .row-flex {\n                    display: flex;\n                    flex-flow: row wrap;\n                }\n                .table {\n                    display: table;\n                    border: solid 1px #000000;\n                }\n                .tablez {\n                    border: solid 1px #000000;\n                }\n                .table .table__head {\n                    display: table-header-group;\n                    background: blue;\n                    color: #fff;\n                }\n                .table .table__head .table__cell {\n                    font-size: 15px;\n                    color: #000000;\n                    background: #B7B7B7;\n                }\n                .table > div:not(.table__body) {\n                    display: table-row-group;\n                }\n                .table .table__body:last-child .table__row:last-child .table__cell {\n                    border-bottom: none;\n                }\n                .table .table__row {\n                    display: table-row;\n                    flex-direction: row;\n                    flex-wrap: no-wrap;\n                }\n                .table .table__row:nth-child(2n) {\n                    display: table-row;\n                    flex-direction: row;\n                    flex-wrap: no-wrap;\n                    border-left: solid 1px red;\n                }\n                .table .table__row .table__cell {\n                    border-bottom: solid 1px #000000;\n                }\n                .table .table__cell {\n                    display: table-cell;\n                    padding: 8px 10px;\n                    font-size: 14px;\n                    color: #000000;\n                    border-right: solid 1px #000000;\n                }\n                .tborder {\n                    border-bottom: 0!important;\n                }\n                .table .table__cell:last-child {\n                    border-right: none;\n                }\n                .table .table__cell.table__cell_collapse {\n                    width: 1px;\n                }\n                .table .table__cell.table__cell_10 {\n                    width: 10%;\n                }\n                .table .table__cell.table__cell_20 {\n                    width: 20%;\n                }\n                .table .table__cell.table__cell_25 {\n                    width: 25%;\n                }\n                .table .table__cell.table__cell_30 {\n                    width: 30%;\n                }\n                .table .table__cell.table__cell_40 {\n                    width: 40%;\n                }\n                .table .table__cell.table__cell_50 {\n                    width: 50%;\n                }\n                .table .table__cell.table__cell_60 {\n                    width: 60%;\n                }\n                .table .table__cell.table__cell_70 {\n                    width: 70%;\n                }\n                .table .table__cell.table__cell_80 {\n                    width: 80%;\n                }\n                .table .table__cell.table__cell_18 {\n                    width: 18%;\n                }\n                .table .table__cell.table__cell_90 {\n                    width: 90%;\n                }\n                .table .table__cell.table__cell_stretch {\n                    width: 100%;\n                }\n            )\n        Div(Class: h4, Body: We hereby acknowledge the receipt of and agree with the Standard Terms & Conditions of Sale. )\n        Div(){\n            DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"closed\").Vars(note)\n            If(#note_closed# == 0){\n                Button(Body: $@1readed$, Class: btn btn-primary pull-right, Page: default_page, Contract: NotificationsClose, Params: \"notific_id=#notific_id#\")\n            }\n        }\n    }\n}.Else{\n    Div(list-group-item text-center h4 ml mr mt-lg){\n        $@1wallet$ $@1not_found$\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_buyer_contract",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1ts_wallets).Where({key_id_buyer:#key_id#, key_id_signer:0, rejected_at:0}).Vars(unconfirmed_wallet)\nIf(#unconfirmed_wallet_id#>0){\n    Div(list-group-item mt-lg mb-lg ml-lg mr-lg){\n        Div(Class: h3 text-bold m0 text-center, Body: APLA Tokens)\n        Div(Class: h3 text-bold m0 text-center, Body: Standard Terms and Conditions of Sale)\n\n        Div(Class: h4 mt-xl text-bold, Body: 1. Introduction)\n        Div(Class: h4, Body: The present standard terms and conditions of sale (T&Cs) govern the relationship between the Seller and Buyer in connection with the sale and purchase of the APLA Tokens as per the EGAAS S.A. letter to the Apla Users as of 1st of November 2018.).Style(padding-right: 60px!important;)\n        Div(Class: h4 mt-xl text-bold, Body: Glossary of Terms)\n\n        Div(){\n            Div(Class: h4, Body: Strong(Body: 1.1) Unless the context requires otherwise, the following terms of this Article 1 shall be used in this Agreement:)\n            Div(Class: h4, Body: Strong(Body: APLA Wallet) means a software application for storing, holding and transferring APLA Tokens;)\n            Div(Class: h4, Body: Strong(Body: APLA Tokens) means a digital representation of value generated by the source code of the Apla platform ecosystem that is used by Apla users to pay a license fee for the execution of smart contracts, creation of tables, and adding new columns and rows to them in all Apla ecosystems;)\n            Div(Class: h4, Body: Strong(Body: Apla Contractual Documentation) means the Terms & Conditions and Apla policies, as amended from time to time, that can be downloaded from Span(Class: text-primary, Body: www.apla.io) website; )\n            Div(Class: h4, Body: Strong(Body: Apla platform) means a software program for executing smart laws and smart contracts based on the distributed ledger technology, the source code of which is stored at GitHub.com/AplaProject. The program operates on the basis of peer to peer (P2P) architecture that is a system of peer client-side programs installed on users' computers and participating in data exchange via peer to peer (P2P) computer network; )\n            Div(Class: h4, Body: Strong(Body: Apla Software) means the Apla platform software the source code of which is published at GitHub.com/AplaProject; )\n            Div(Class: h4, Body: Strong(Body: Buyer) means a legal entity or individual that has signed the Commercial Terms with the Seller; )\n            Div(Class: h4, Body: Strong(Body: Commercial Terms) means the price, payment, delivery and other terms of sale of APLA Tokens indicated in the Seller’s letter to the potential Buyers as of 1st of November 2018;)\n            Div(Class: h4, Body: Strong(Body: Laws) means the civil law in general, any constitution, legislation, decree, order, instruction, rule, regulation, ordinance, code, directive, by-law, judgment, international treaty or any other legislative or quasi-legislative measure related, in each case, to the respective jurisdiction that may be applicable to any transaction closed or to the circumstances existing as of the respective date and, in each case (if any liability is stipulated by or may arise in accordance with them) including any former provision (that may be statutorily amended or re-enacted from time to time) that was directly or indirectly replaced by such provision;)\n            Div(Class: h4, Body: Strong(Body: Luxembourg) means the Grand Duchy of Luxembourg;)\n            Div(Class: h4, Body: Strong(Body: Parties) means both the Seller and Buyer;)\n            Div(Class: h4, Body: Strong(Body: Party) means either the Seller or Buyer as the context suggests; )\n            Div(Class: h4, Body: Strong(Body: Public Authority) means any supranational, national, municipal, local or foreign public authority or organisation, or any department, commission, administration, bureau, agency, court or instrumentality, subdivision or any other authority thereof, or any quasi-public or private authority having any regulatory, tax, financial regulation and any other public or quasi-public authority)\n            Div(Class: h4, Body: Strong(Body: Purchase Order)  means an order to purchase APLA Tokens submitted by the Buyer to the Seller in accordance with the Commercial Terms; )\n            Div(Class: h4, Body: Strong(Body: Seller) means Strong(Body: EGAAS S.A.,) a legal entity incorporated under the laws of the Grand Duchy of Luxembourg, registered at RCS Luxembourg under the number B216 352 and having its registered office at L-1273 Luxembourg, 20, rue de Bitbourg; )\n            Div(Class: h4, Body: Strong(Body: SnapSwap) means SnapSwap International S.A., a legal entity incorporated under the laws of the Grand Duchy of Luxembourg, having its registered office at 59, Boulevard Royal L-2449 Luxembourg and authorised as an electronic money institution by the Ministry of Finance. )\n            Div(Class: h4, Body: Strong(Body: 1.2 In the context of this Agreement:) )\n            Div(){\n                Div(Class: h4, Body: Strong(Body: 1.2.1) A reference to this Agreement shall be interpreted as a reference to this document, including all amendments, supplements, appendices, novations or transfer of rights made from time to time;)\n                Div(Class: h4, Body: Strong(Body: 1.2.2) A reference to the article, clause, sub-clause or appendix, unless such reference is followed by the name of a particular document, shall be deemed the reference to an article, clause, section or appendix to this Agreement;)\n                Div(Class: h4, Body: Strong(Body: 1.2.3) A reference to the terms defined in this Agreement includes the singular and plural of those terms and denotes the masculine, feminine or neuter gender, as the context requires;)\n                Div(Class: h4, Body: Strong(Body: 1.2.4) It is understood that the words “including” and “includes” are followed by the expression “without limitation”, and such expressions shall be without prejudice to the generality of the foregoing;)\n                Div(Class: h4, Body: Strong(Body: 1.2.5) Headings are for the convenience only and shall not affect the interpretation of this Agreement; and)\n                Div(Class: h4, Body: Strong(Body: 1.2.6) All terms that are written in capital letters and not defined in clause 1.1 shall have the meaning ascribed to those terms in the text of this Agreement or appendices hereto.)\n            }.Style(padding-left: 50px!important;)\n\n            Div(Class: h4, Body: Strong(Body: 2 Subject matter) )\n            Div(Class: h4, Body: Strong(Body: 2.1) Subject to the terms and conditions set forth herein, Seller shall sell and Buyer shall buy the number of APLA Tokens indicated in Purchase Order of Buyer to the extent such an order has been accepted by Seller. Seller shall be deemed accepted Purchase Order of Buyer by sending an invoice for making the payment of the purchase price to Buyer in response to the submitted Purchase Order.)\n            Div(Class: h4, Body: Strong(Body: 2.2) No U.S. Buyers. APLA Tokens during the initial sale are not being offered to U.S. persons. U.S. persons are strictly prohibited and restricted from purchasing APLA Tokens and Seller is not soliciting purchases by U.S. persons in any way. )\n            Div(Class: h4, Body: Strong(Body: 2.3) APLA Tokens are not intended to be offered for investment purposes. The pure purpose of the legitimate use of APLA Tokens is to pay for license fees in connection with the execution of transactions on Apla Platform. )\n            Div(Class: h4, Body: Strong(Body: 2.4) Buyer acknowledges and agrees that Buyer is not purchasing APLA Tokens for purposes of investment, speculation, as some type of arbitrage strategy, for immediate resale or other financial purposes. )\n\n            Div(Class: h4, Body: Strong(Body: 3 Transfer of APLA Tokens) )\n            Div(Class: h4, Body: Strong(Body: 3.1) Buyer shall open APLA Wallet in accordance with the rules set forth in the Apla Contractual Documentation and following the KYC (know-your-customer procedure) with SnapSwap. Buyer shall inform Seller about the public key of the opened APLA Wallet in Purchase Order.)\n            Div(Class: h4, Body: Strong(Body: 3.2) Seller shall transfer the number of APLA Tokens, indicated in Purchase Order accepted by Seller, to the APLA Wallet of Buyer within 2 business days following the receipt of the purchase price from the Buyer. )\n    \n\n            Div(Class: h4, Body: Strong(Body: 4 Representations and warranties of the Parties))\n                Div(Class: h4, Body: Strong(Body: 4.1) Seller gives no guarantee and/or warrantee as regards the market value of APLA Tokens throughout the term of this T&C and thereafter. )\n                Div(Class: h4, Body: Strong(Body: 4.2) Buyer is made aware of the potential high volatility of APLA Tokens on the market and other risks pretraining to crypto-currencies as further defined in the warning of the CSSF published on Span(Class: text-primary, Body: http://www.cssf.lu/fileadmin/files/Protection_consommateurs/Avertissements/W_virtual_currencies_140318_eng.pdf))\n                Div(Class: h4, Body: Strong(Body: 4.3) Hereby Buyer gives to Seller the following true, correct and irrevocable representations and warranties that shall be true at the date of submitting Purchase Order to Seller: )\n                Div(){\n                    Div(){\n                        Div(Class: h4, Body: Strong(Class: wrap, Body: 4.3.1) Span(Class: underline, Body: Legal Status of Buyer.) Buyer is not undergoing any liquidation and/or bankruptcy procedure.)\n                        Div(Class: h4, Body: Strong(Class: wrap, Body: 4.3.2) Span(Class: underline, Body: Powers and Authorities of Buyer.)  Buyer has right, power and authority to enter into, execute and deliver these T&Cs, any other documents contemplated hereby and the transaction contemplated hereby and to perform its obligations hereunder and all corporate actions necessary for this has been undertaken by Buyer.  The T&Cs are valid and legally binding for Buyer and can be lawfully enforced in accordance with their terms. The signatory of Buyer that has executed the T&Cs was duly granted with the relevant powers.)\n                        Div(Class: h4, Body: Strong(Class: wrap, Body: 4.3.3) Span(Class: underline, Body: No Conflict.) The execution of the T&Cs and the fulfilment of obligations by Buyer will not constitute any conflict with (i) the provisions of Buyer’s constituent documents and any other documents regulating Buyer’s status and activities, (ii) any laws, rules or regulations, arbitral awards, court rulings, official orders, resolutions, instructions etc. applicable to Buyer. Buyer obtained all applicable governmental, statutory, regulatory or other consents, licences, authorisations, waivers and exemptions required to enter into these T&Cs and any other documents contemplated hereby and to perform its obligations hereunder.)\n                        Div(Class: h4, Body: Strong(Class: wrap, Body: 4.3.4) Span(Class: underline, Body: Finance.) Buyer has and will have its own cash and/or fully available credit lines to fulfil its obligations hereunder.)\n                    }.Style(padding-left: 50px!important;)\n                    Div(Class: h4, Body: Strong(Body: 4.4) Hereby Seller gives to Buyer the following true, correct and irrevocable warranties and representations that shall be valid at the date of accepting Purchase Order:)\n                    Div(){\n                        Div(Class: h4, Body: Strong(Class: wrap, Body: 4.4.1) Span(Class: underline, Body: Legal Status of Seller.) Seller is a corporation duly established and acting on a legal basis in accordance with the legislation of Luxembourg. Seller is not undergoing any liquidation and/or bankruptcy procedure. )\n                        Div(Class: h4, Body: Strong(Class: wrap, Body: 4.4.2) Span(Class: underline, Body: Powers and Authorities of Seller.) Seller has right, power and authority to enter into, execute and deliver these T&Cs, any other documents contemplated hereby and the transaction contemplated hereby and to perform its obligations hereunderand all corporate actions necessary for this has been undertaken by Seller. The T&Cs are valid and legally binding for Seller and can be lawfully enforced in accordance with its terms. The signatory of Seller that has executed the T&Cs was duly granted with the relevant powers.)\n                        Div(Class: h4, Body: Strong(Class: wrap, Body: 4.4.3) Span(Class: underline, Body: No Conflict.) The execution of the T& and the fulfilment of obligations by Seller will not constitute any conflict with (i) the provisions of Seller’s constituent documents and any other documents regulating the Seller’s status and activities, (ii) any laws, rules or regulations, arbitral awards, court rulings, official orders, resolutions, instructions etc. applicable to Seller. Seller obtained all applicable governmental, statutory, regulatory or other consents, licences, authorisations, waivers and exemptions required to enter into these T&Cs and any other documents contemplated hereby and to perform its obligations hereunder.)\n                        Div(Class: h4, Body: Strong(Class: wrap, Body: 4.4.4) Span(Class: underline, Body: Title to APLA Tokens.) As of the date of accepting Purchase Order, Seller will have legal and unrestricted title to the APLA Tokens being the subject matter of these T&Cs, free from any pledge, lien, any other encumbrances and defects. )\n                    }.Style(padding-left: 50px!important;)\n                }.Style(\n                    .underline {\n                        text-decoration: underline;\n                    }\n                    .wrap {\n                        padding-right: 8px!important;\n                    }\n                )\n                Div(Class: h4, Body: Strong(Body: 4.5) Unless otherwise specifically provided in these T&Cs, in the event that at any time it appears that any of the warranties and representations was not true and correct in any material respect when made, then the Party to whom these warranties and representations were given shall give prompt written notice of any such breach to the other Party and give this default Party the opportunity to eliminate (at the defaulting Party’s own cost and expense) any such breach and the Party to whom these warranties and representations were given shall be required (at the defaulting Party’s own cost and expense) to provide such assistance to the default Party with remedying any such breach as the defaulting party may reasonably request.)\n                Div(Class: h4, Body: Strong(Body: 5 Liability))\n                Div(Class: h4, Body: Strong(Body: 5.1 ) The Seller’s liability under these T&Cs may not exceed the amount of the purchase price received by Seller from Buyer for APLA Tokens.)\n                Div(Class: h4, Body: Strong(Body: 5.2) Seller shall in no case be liable for indirect or consequential damages incurred by Buyer. )\n                Div(Class: h4, Body: Strong(Body: 5.3) None of the Parties  shall be liable for a failure to properly perform their duties under these T&Cs if this non-performance or poor performance is resulted from force majeure events. Force majeure event means any event and/or circumstance, which is beyond the reasonable control of, and is not attributable to, the affected party resulting in the affected party being prevented from performing or being delayed in the performance of any of its obligations under the T&Cs. Force majeure event may include, but not limited to, an act of a Public Authority or court of any state, interruption or unavailability of power supplies and telecommunication networks in addition to the acts of God. )\n                Div(Class: h4, Body: Strong(Body: 6 Entry into Force))\n                Div(Class: h4, Body: Strong(Body: 6.1) These T&Cs shall come into force on the date when Seller has accepted Purchase Order of Buyer.  )\n                Div(Class: h4, Body: Strong(Body: 7 Termination of agreement))\n                Div(Class: h4, Body: The agreement between the Parties shall be deemed terminated on the following grounds: )\n                Div(Class: h4, Body: Strong(Body: 7.1) Buyer has not transferred the purchase price to Seller for APLA Tokens indicated in Purchase Order accepted by Seller within 5 business days from the acceptance date. )\n                Div(Class: h4, Body: Strong(Body: 8 Severability))\n                Div(Class: h4, Body: If any part of this agreement is recognized invalid, unlawful, or unenforceable, the other part will continue to be valid and enforceable to the fullest extent permitted by applicable Law. The invalid, unlawful, or unenforceable part shall be construed and further negotiated by the parties concerned in a manner compliant with applicable Law and consistent with original intentions of the Parties. )\n                Div(Class: h4, Body: Strong(Body: 9 Notices))\n                Div(Class: h4, Body: All notices under this Agreement shall be sent by registered mail or private courier to the following addresses:)\n                Div(Class: h4, Body: If to Seller: L-1273 Luxembourg, 20, rue de Bitbourg)\n                Div(Class: h4, Body: If to the Buyer: address of APLA Wallet of Buyer)\n                Div(Class: h4, Body: or to such other addresses as shall be indicated by the Parties hereto. All notices shall be deemed to have been received [7 (seven) calendar] days after posting by registered mail or upon confirmation of receipt if sent by private courier.)\n                Div(Class: h4, Body: Strong(Body: 10 Dispute Resolution))\n                Div(Class: h4, Body: All disputes arising out of or in connection with these T&Cs shall be referred to the Arbitration Centre at the Chamber of Commerce and Industry of Luxembourg for final resolution under the Rules of Arbitration established by such Centre by one arbitrator appointed in accordance with those Rules.)\n                Div(Class: h4, Body: The law applicable to the relations of the Parties under these T&Cs shall be the Law of Luxembourg.)\n        }.Style(padding-left: 50px!important;)\n\n        Div(mt-xl mb-lg){\n            Button(Body: $@1reject$, Class: btn btn-danger, Page: default_page, Contract: TsBuyerAction, Params: \"Action=reject\")\n            Button(Body: $@1accept$, Class: btn btn-primary pull-right, Page: default_page, Contract: TsBuyerAction, Params: \"Action=accept\")\n        }\n\n    }.Style(\n        padding-left: 60px!important; \n        padding-right: 60px!important;\n    )\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_commercial_terms",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "Div(ml mr){\n    Div(Class: h5 text-bold, Body: 1. Price, sale rounds and extra terms:)\n    Div(row){\n        Div(col-md-12){\n            Div(table tablez){\n                Div(table__head){\n                    Div(table__row){\n                        Div(table__cell table__cell_20){Round}\n                        Div(table__cell table__cell_10){Volume of APLA Tokens}\n                        Div(table__cell table__cell_10){Price, EUR, excl. VAT}\n                        Div(table__cell table__cell_10){Discount}\n                        Div(table__cell){Extra terms}\n                    }\n                }\n                Div(table__row){\n                    Div(table__cell){Round 1 (01.11.18-20.12.18)}\n                    Div(table__cell){15 100 000}\n                    Div(table__cell){5}\n                    Div(table__cell){20%}\n                    Div(table__cell){25% of unsold APLA tokens during each Round 2 to 7 will be proportionally distributed for free among the buyers purchased the tokens during Round 1. \n                    This option becomes available only if the conditions for free distribution of APLA Tokens to the buyers participating to the Rounds 2-7 have been fulfilled.\n                    If you acquire APLA Tokens for the amount of at least 125,000 EUR, you will be entitled to additional benefits.  Please reach out to us via email luxembourg@apla.io to get more details. \n                    }\n                }\n                Div(table__row){\n                    Div(table__cell){Round 2(20.12.18-01.02.19)}\n                    Div(table__cell){1 000 000}\n                    Div(table__cell){5}\n                    Div(table__cell){0%}\n                    Div(table__cell tborder){75% of unsold APLA tokens during each Round 2 to 7 will be proportionally distributed for free among the buyers participating to the respective round. This option becomes available only if at least 40% of APLA tokens have been sold out during this round. In all other cases, the unsold tokens remain the property of the current owner.\n                    }\n                }\n                Div(table__row){\n                    Div(table__cell){Round 4 (01.03.19-01.04.19)}\n                    Div(table__cell){5 000 000}\n                    Div(table__cell){5}\n                    Div(table__cell){0%}\n                    Div(table__cell tborder){}\n                }\n                Div(table__row){\n                    Div(table__cell){Round 5 (01.04.19-01.05.19)}\n                    Div(table__cell){7 000 000}\n                    Div(table__cell){5}\n                    Div(table__cell){0%}\n                    Div(table__cell tborder){}\n                }\n                Div(table__row){\n                    Div(table__cell){Round 6 (01.05.19-01.06.19)}\n                    Div(table__cell){12 000 000}\n                    Div(table__cell){5}\n                    Div(table__cell){0%}\n                    Div(table__cell tborder){}\n                }\n                Div(table__row){\n                    Div(table__cell tborder){Round 7 (01.06.19-01.07.19)}\n                    Div(table__cell tborder){16 000 000}\n                    Div(table__cell tborder){5}\n                    Div(table__cell tborder){0%}\n                    Div(table__cell tborder){}\n                }\n            }\n        }\n    }\n    Div(Class: h5 m0, Body: Each round starts at 11:01 am and ends at 11 am of the designated date)\n\n    Div(row mt-xl){\n        Div(col-sm-3){\n            Div(Class: h5 text-bold, Body: 2. Delivery of APLA Tokens)\n        }\n        Div(col-sm-9){\n            Div(Class: h5, Body: The number of APLA tokens you have paid for, will be delivered to your APLA Wallet within 2 business days after EGAAS S.A. have received the payment of the purchase price.)\n        }\n    }\n    Div(row){\n        Div(col-sm-3){\n            Div(Class: h5 text-bold, Body: 3. Payment currency)\n        }\n        Div(col-sm-9){\n            Div(Class: h5, Body: EUR/BTC/ETH)\n        }\n    }\n    Div(row){\n        Div(col-sm-3){\n            Div(Class: h5 text-bold, Body: 4. Payment terms )\n        }\n        Div(col-sm-9){\n            Div(Class: h5, Body: If you make a payment in EUR, you will need to make a transfer of the purchase price from your EUR account with SnapSwap to the EUR account of EGAAS S.A. with the same financial institution. Please indicate in the payment order your APLA Wallet number for the delivery of APLA Tokens.)\n            Div(Class: h5, Body: If you make a payment in BTC or ETH, the Bitstamp exchange rate of BTC/EUR or ETH/EUR shall be used to calculate the EUR equivalent. The Bitstamp rate shall be defined on the day EGAAS S.A. have received BTC or ETH into its wallet. )\n            Div(Class: h5, Body: The details of the BTC or ETH wallets of EGAAS S.A. will be communicated to you for each transaction individually after we have received your purchase order. )\n        }\n    }\n    Div(row){\n        Div(col-sm-3){\n            Div(Class: h5 text-bold, Body: 5. Legal terms)\n        }\n        Div(col-sm-9){\n            Div(Class: h5, Body: Standard Terms & Conditions of Sale enclosed to these commercial terms. )\n        }\n    }\n\n    Div(row mt-xl pull-right){\n        Div(col-sm-12){\n            Button(Class: btn btn-default, Page: default_page, Body: Back)\n        }\n    }\n}.Style(\n    .row-flex {\n        display: flex;\n        flex-flow: row wrap;\n    }\n    .table {\n        display: table;\n        border: solid 1px #000000;\n    }\n    .tablez {\n        border: solid 1px #000000;\n    }\n    .table .table__head {\n        display: table-header-group;\n        background: blue;\n        color: #fff;\n    }\n    .table .table__head .table__cell {\n        font-size: 15px;\n        color: #000000;\n        background: #B7B7B7;\n    }\n    .table > div:not(.table__body) {\n        display: table-row-group;\n    }\n    .table .table__body:last-child .table__row:last-child .table__cell {\n        border-bottom: none;\n    }\n    .table .table__row {\n        display: table-row;\n        flex-direction: row;\n        flex-wrap: no-wrap;\n    }\n    .table .table__row:nth-child(2n) {\n        display: table-row;\n        flex-direction: row;\n        flex-wrap: no-wrap;\n        border-left: solid 1px red;\n    }\n    .table .table__row .table__cell {\n        border-bottom: solid 1px #000000;\n    }\n    .table .table__cell {\n        display: table-cell;\n        padding: 8px 10px;\n        font-size: 14px;\n        color: #000000;\n        border-right: solid 1px #000000;\n    }\n    .tborder {\n        border-bottom: 0!important;\n    }\n    .table .table__cell:last-child {\n        border-right: none;\n    }\n    .table .table__cell.table__cell_collapse {\n        width: 1px;\n    }\n    .table .table__cell.table__cell_10 {\n        width: 10%;\n    }\n    .table .table__cell.table__cell_20 {\n        width: 20%;\n    }\n    .table .table__cell.table__cell_25 {\n        width: 25%;\n    }\n    .table .table__cell.table__cell_30 {\n        width: 30%;\n    }\n    .table .table__cell.table__cell_40 {\n        width: 40%;\n    }\n    .table .table__cell.table__cell_50 {\n        width: 50%;\n    }\n    .table .table__cell.table__cell_60 {\n        width: 60%;\n    }\n    .table .table__cell.table__cell_70 {\n        width: 70%;\n    }\n    .table .table__cell.table__cell_80 {\n        width: 80%;\n    }\n    .table .table__cell.table__cell_18 {\n        width: 18%;\n    }\n    .table .table__cell.table__cell_90 {\n        width: 90%;\n    }\n    .table .table__cell.table__cell_stretch {\n        width: 100%;\n    }\n)",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_consensus_contract",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\nSetVar(isStartProcessing,0)\nIf(#notific_id#>0){\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->wallet_id,date_start_processing,notification->type,processing_info->member_id,closed\").Vars(note)\n    If(#note_date_start_processing#!=\"\"){\n        SetVar(isStartProcessing,1)\n    }\n}\n\nSetVar(this_page, ts_consensus_contract)\nDiv(content-wrapper){\n    Form(){\n        DBFind(@1ts_wallets).Where({id:#note_page_params_wallet_id#, rejected_at:0}).Vars(wallet)\n        If(#wallet_id#>0){\n            Div(list-group-item){\n                Div(text-center text-bold h4 m0){\n                    LangRes(@1key_id_investor)\n                }\n            }\n            Div(list-group-item){\n                Div(row){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1key_id_investor$\n                    }\n                    Div(col-sm-9 text-left){\n                        LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#wallet_key_id_buyer#\"){\n                            Address(#wallet_key_id_buyer#)\n                        }\n                    }\n                }\n                Div(row){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1signed_at$\n                    }\n                    Div(col-sm-9 text-left){\n                        DateTime(#wallet_signed_at#, \"YYYY-MM-DD HH:MI:SS\")\n                    }\n                }\n                Div(row mt-sm){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1pub_key$\n                    }\n                    Div(col-sm-9 text-left){\n                        Span(Class: h6, Body: #wallet_pub_buyer#)\n                    }\n                }\n                Div(row){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1ts_wallet_btc$\n                    }\n                    Div(col-sm-9 text-left){\n                        Span(Class: h6, Body: #wallet_wallet_btc#)\n                    }\n                }\n                Div(row){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1ts_wallet_eth$\n                    }\n                    Div(col-sm-9 text-left){\n                        Span(Class: h6, Body: #wallet_wallet_eth#)\n                    }\n                }\n            }\n            If(#note_closed# == 0){\n                Div(list-group-item){\n                    If(And(#note_processing_info_member_id#==#key_id#,#isStartProcessing#==1)){\n                        Button(Body: $@1reject$, Class: btn btn-default, Page: #this_page#, PageParams: \"notific_id=#notific_id#\", Contract: TsConsensusAction, Params: \"Action=reject,WalletId=#note_page_params_wallet_id#,NotificId=#notific_id#\")\n                        Button(Body: $@1accept$, Class: btn btn-primary pull-right, Page: #this_page#, PageParams: \"notific_id=#notific_id#\", Contract: TsConsensusAction, Params: \"Action=accept,WalletId=#note_page_params_wallet_id#,NotificId=#notific_id#\")\n                    }.ElseIf(#isStartProcessing#==1){\n                        Div(text-muted text-center){\n                            $@1notice_processing_started_another_member$\n                        }\n                    }.ElseIf(#isStartProcessing#==0){\n                        Div(text-right){\n                            Button(Body: $@1processing$, Class: btn btn-primary, Page: #this_page#, PageParams: \"notific_id=#notific_id#\", Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\")\n                        }\n                    }\n                }\n            }\n        }.Else{\n            Div(list-group-item text-center h4){\n                $@1wallet$ $@1not_found$\n            }\n        }\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_free_wallet_add",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "Form(){\n    Div(row){\n        Div(col-md-2 mt-lg text-right){\n            Label(For: wallet_btc){\n                LangRes(@1ts_wallet_btc)\n            }\n        }\n        Div(col-md-10){\n            Input(Name: wallet_btc, Type: textarea).Validate(minLength:27, maxLength:34)\n            InputErr(Name: wallet_btc, minLength: $@1validate_wallet_btc$, maxLength: $@1validate_wallet_btc$)\n        }\n    }\n    Div(row mt){\n        Div(col-md-2 mt-lg text-right){\n            Label(For: wallet_eth){\n                LangRes(@1ts_wallet_eth)\n            }\n        }\n        Div(col-md-10){\n            Input(Name: wallet_eth, Type: textarea).Validate(minLength:40, maxLength:44)\n            InputErr(Name: wallet_btc, minLength: $@1validate_wallet_eth$, maxLength: $@1validate_wallet_eth$)\n        }\n    }\n    Button(Body: LangRes(@1add), Class: btn btn-primary pull-right mt, Page: @1ts_free_wallets, Contract: @1TsFreeWalletAdd)\n    Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt, Page: @1ts_free_wallets)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_free_wallets",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1ts_free_wallets).(this_table, @1ts_wallets)\nInclude(@1pager_header)\n\nSetTitle(\"$@1ts_free_wallets$\")\nSetVar(admin_role_id, EcosysParam(Name:role_sale_admin))\nIf(And(#admin_role_id#>0,#role_id#==#admin_role_id#)){\n    AddToolButton(Title:$@1ts_free_wallet_add$, Page: @1ts_free_wallet_add, Icon: icon-wallet).Popup(Header: $@1ts_free_wallet_add$, Width: \"50\")\n}\n\nIf(GetVar(search)!=\"\"){\n    SetVar(where, {$and: [{\"deleted\":0}, {\"key_id_buyer\":0}, {$or:[{\"wallet_btc\": {$like: #search#}},{\"wallet_eth\": {$like: #search#}}]}]})\n}.Else{\n    SetVar(where, {$and: [{\"deleted\":0}, {\"key_id_buyer\":0}]}).(search,)\n}\n\nDiv(list-group-item ml-lg mr-lg pt-lg){\n    SetVar(search_name, LangRes(@1wallet))\n    Include(@1search)\n}\n\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": -1}).Limit(#pager_limit#).Offset(#pager_offset#).Custom(_btc){\n    Span(#wallet_btc#)\n}.Custom(_eth){\n    Span(#wallet_eth#)\n}.Custom(action){\n    Div(pull-right){\n        If(#deleted#==0){\n            Button(Body: Em(Class: fa fa-trash), Class: btn btn-default, Contract: @1TsFreeWalletDelete, Params: \"wallet_id=#id#\", Page: @1ts_free_wallets).Alert(Text: \"$@1sure_want_delete$\", ConfirmButton: $@1yes$, CancelButton: $@1no$, Icon: question)\n        }\n    }\n}.Count(count)\n\nDiv(fullscreen){\n    Div(table-responsive ml-lg mr-lg){\n        Div(list-group-item){\n            If(#count# > 0){\n                Table(src, \"$@1id$=id,$@1ts_wallet_btc$=_btc,$@1ts_wallet_eth$=_eth,=action\")\n            }.Else{\n                Div(Class: text-center h4 text-muted, Body: \"$@1ts_free_wallets$ $@1not_founded$\")\n            }                       \n        }.Style(\n            margin-top:-15px;\n            tbody > tr:nth-of-type(odd) {\n                background-color: #f8f9fc;\n            }\n        )\n    }\n}\nDiv(mt-sm ml-lg mr-sm mb-sm){\n    Include(@1pager)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_key_approve",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "Form(){\n    Div(row){\n        Div(col-md-2 mt-xl text-right){\n            Label(For: public_key){\n                LangRes(@1pub_key)\n            }\n        }\n        Div(col-md-10){\n            Span(Body: LangRes(@1ts_public_key_input_des), Class: text-muted m0 h6)\n            Input(Name: public_key, Type: textarea)\n        }\n    }\n    Div(row mt-sm){\n        Div(col-md-2 mt-lg text-right){\n            Label(For: token_buyer){\n                LangRes(@1public_key_type)\n            }\n        }\n        Div(col-md-10){\n            Data(key_radio, \"value,description\"){\n                investor,$@1ts_investor_key$\n                user,$@1ts_user_key$\n            }\n            RadioGroup(Name: key_type, Source: key_radio, NameColumn: description, ValueColumn: value)\n        }\n    }\n    Input(Name: current_role_id, Type: hidden, Value: #role_id#)\n    Button(Body: LangRes(@1add), Class: btn btn-primary pull-right mt, Page: @1ts_wallets, Contract: @1TsKeyApprove).Alert(Text: \"$@1want_add_investor$\", ConfirmButton: \"$@1yes$\", CancelButton: \"$@1no$\", Icon: icon-question)\n    Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt, Page: @1ts_wallets)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_notification",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\nIf(#notific_id#>0){\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"notification->type,notification->header,notification->body,id,processing_info->member_id,closed\").Vars(note)\n}\n\nDiv(content-wrapper){\n    Div(row mt-sm){\n        Div(col-lg-10 col-lg-offset-1){\n            Form(panel panel-primary){\n                DBFind(@1ts_wallets).Where({key_id_signer:{$neq:0}, rejected_at:0}).Vars(wallet)\n                If(#note_id#>0){\n                    Div(panel-body text-center){\n                        Div(h4 text-bold m0){\n                            #note_notification_header#\n                        }\n                        Div(m0){\n                            #note_notification_body#\n                        }\n                    }\n                    If(#note_closed# == 0){\n                        Div(panel-footer text-right){\n                            If(Or(#note_notification_type#==1,#note_processing_info_member_id# == #key_id#)){\n                                Button(Body: $@1readed$, Class: btn btn-primary, Page: @1default_page, Contract: NotificationsClose, Params: \"notific_id=#notific_id#\")\n                            }.ElseIf(#note_notification_type#==2){\n                                Button(Body: $@1processing$, Class: btn btn-primary, Page: @1ts_notification, PageParams: \"notific_id=#notific_id#\", Contract: NotificationsProcess, Params: \"notific_id=#notific_id#\")\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_sales",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1ts_sales).(this_table, @1ts_sales)\nInclude(@1pager_header)\n\nDBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\nSetVar(admin_role_id, EcosysParam(Name:role_sale_admin))\nSetVar(manager_role_id, EcosysParam(Name:role_sale_manager))\nSetVar(seller_role_id, EcosysParam(Name:role_sale_seller))\nSetVar(STATUS_MANAGER,1).(STATUS_SELLER,2)\n\nSetTitle(\"$@1ts_sales$\")\nIf(And(#admin_role_id#>0,#role_id#==#admin_role_id#)){\n    AddToolButton(Title:$@1ts_add_transfer$, Page: @1ts_transfer_admin, Icon: icon-wallet).Popup(Header: $@1ts_add_transfer$, Width: \"50\")\n}\n\nIf(GetVar(search)!=\"\"){\n    SetVar(where, {id:#search#})\n}.Else{\n    SetVar(where, {id:{$gt:0}}).(search,)\n}\n\nDiv(list-group-item ml-lg mr-lg pt-lg){\n    SetVar(search_name, LangRes(@1key_id))\n    Include(@1search)\n}\n\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": -1}).Limit(#pager_limit#).Offset(#pager_offset#).Custom(_id){\n    Span(#id#)\n    SetVar(w_wallet_btc,).(w_wallet_eth,).(w_pub_short_buyer,)\n    DBFind(@1ts_wallets).Where({\"key_id_buyer\":#key_id_buyer#}).Vars(w)\n}.Custom(_btat){\n    Span(Class: text-muted, Body: DateTime(#buyer_transferred_at#, Format: YYYY-MM-DD HH:MI:SS))\n}.Custom(_cat){\n    Span(Class: text-muted, Body: DateTime(#created_at#, Format: YYYY-MM-DD HH:MI:SS))\n}.Custom(_amount){\n    Div(text-right){\n        Span(Class: text-bold, Body: Money(#amount_apl#)).Style(margin-right:5px;)\n        Span(Class: text-bold, Body: APLA)\n    }\n}.Custom(_info){\n    Button(Class: btn-xs btn-link, Page: @1ts_transfer_view, PageParams: \"Id=#id#\"){\n        Span(Class: text-bold h5, Body: LangRes(@1information))\n    }.Popup(Header: $@1information$, Width: 35)\n}.Custom(_status){\n    SetVar(status_class, AppParam(App:#application_id#, Name:ts_statuses_classes, Index:#status#, Ecosystem: #ecosystem_id#))\n    Div(#status_class#){\n        AppParam(App:#application_id#, Name:ts_statuses, Index:#status#, Ecosystem: #ecosystem_id#)\n    }\n}.Custom(_action){\n    If(And(#status#==#STATUS_MANAGER#,#manager_role_id#>0,#role_id#==#manager_role_id#)){\n        Button(Class: fa fa-play btn btn-primary, Page: @1ts_transfer_manager, PageParams: \"SaleId=#id#\")\n    }\n    If(And(#status#==#STATUS_SELLER#,#seller_role_id#>0,#role_id#==#seller_role_id#)){\n        Button(Class: fa fa-play btn btn-primary, Page: @1ts_transfer_seller, PageParams: \"SaleId=#id#\")\n    }\n}.Custom(_buyer){\n    LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#key_id_buyer#\"){\n        Address(#key_id_buyer#)\n    }\n    Div(){\n        Span(Class: h6 text-muted, Body: PUB:)\n        Span(Class: h6 text-muted ml-sm, Body: #w_pub_short_buyer#)\n    }\n}.Custom(_wlts){\n    Div(){\n        Span(Class: h6 text-muted, Body: BTC:)\n        Span(Class: h6 ml-sm, Body: #w_wallet_btc#)\n    }\n    Div(){\n        Span(Class: h6 text-muted, Body: ETH:)\n        Span(Class: h6 ml-sm, Body: #w_wallet_eth#)\n    }\n}.Count(count)\n\nDiv(fullscreen){\n    Div(table-responsive ml-lg mr-lg){\n        Div(list-group-item){\n            If(#count# > 0){\n                Table(src, \"$@1id$=_id,$@1key_id_investor$=_buyer,$@1wallets$=_wlts,$@1information$=_info,$@1investor_funds_transfer_date$=_btat,$@1created_at$=_cat,$@1status$=_status,=_action,=_amount\")\n            }.Else{\n                Div(Class: text-center h4 text-muted, Body: \"$@1sales$ $@1not_founded$\")\n            }                       \n        }.Style(\n            margin-top:-15px;\n            tbody > tr:nth-of-type(odd) {\n                background-color: #f8f9fc;\n            }\n        )\n    }\n}\nDiv(mt-sm ml-lg mr-sm mb-sm){\n    Include(@1pager)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_settings",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, ts_settings).(role_admin,0).(role_manager,0).(role_seller,0)\nSetVar(role_admin, EcosysParam(Name:role_sale_admin))\nSetVar(role_manager, EcosysParam(Name:role_sale_manager))\nSetVar(role_seller, EcosysParam(Name:role_sale_seller))\nSetVar(role_snapswap, EcosysParam(Name:role_snapswap))\n\nDBFind(@1roles,src_roles).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"role_name,id\").Limit(100)\n\nSetVar(row,\"row mt-sm\").(col_left,\"col-sm-4 text-right mt-sm\").(col_right,\"col-sm-8 text-left\")\nSetTitle($@1ts_settings$)\nDiv(content-wrapper){\n    Div(row mt-sm){\n        Div(col-lg-8 col-lg-offset-2){\n            Form(panel panel-primary){\n                Div(panel-body){\n                    Div(#row#){\n                        Div(col-sm-12 text-center text-muted){\n                            $@1ts_settings_description$\n                        }\n                    }\n                    Div(#row#){\n                        Div(#col_left#){\n                            $@1role_sale_admin$\n                        }\n                        Div(#col_right#){\n                            Select(Name:RoleAdmin, Source:src_roles, NameColumn: role_name, ValueColumn: id, Value:#role_admin#)\n                        }\n                    }\n                    Div(#row#){\n                        Div(#col_left#){\n                            $@1role_sale_manager$\n                        }\n                        Div(#col_right#){\n                            Select(Name:RoleManager, Source:src_roles, NameColumn: role_name, ValueColumn: id, Value:#role_manager#)\n                        }\n                    }\n                    Div(#row#){\n                        Div(#col_left#){\n                            $@1role_sale_seller$\n                        }\n                        Div(#col_right#){\n                            Select(Name:RoleSeller, Source:src_roles, NameColumn: role_name, ValueColumn: id, Value:#role_seller#)\n                        }\n                    }\n                    Div(#row#){\n                        Div(#col_left#){\n                            $@1role_snapswap$\n                        }\n                        Div(#col_right#){\n                            Select(Name:RoleSnapswap, Source:src_roles, NameColumn: role_name, ValueColumn: id, Value:#role_snapswap#)\n                        }\n                    }\n                }\n                Div(panel-footer text-center){\n                    Button(Body: $@1apply_settings$, Class: btn btn-primary, Page: #this_page#, Contract: TsSettings)\n                }\n            }\n        }\n    }\n}",
            "Menu": "admin_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_transfer_admin",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1ts_transfer_admin).(back_page, @1ts_sales)\n\nIf(GetVar(type_currency)==\"\"){\n    SetVar(type_currency,1)\n}\n\nForm(){\n    Div(row mb-sm){\n        Div(col-md-4 mt-sm text-right text-bold){\n            LangRes(@1type)\n        }\n        Div(col-md-8 text-left){\n            If(GetVar(type_currency)==1){\n                Input(Name: CurrencyType, Type: hidden, Value: 1)\n                Button(Body: BTC, Page: #this_page#, PageParams: \"type_currency=1\", Class: btn btn-primary disabled mr-lg).Popup(Header: $@1ts_add_transfer$, Width: \"50\")\n                Button(Body: ETH, Page: #this_page#, PageParams: \"type_currency=2\", Class: btn btn-primary mr-lg).Popup(Header: $@1ts_add_transfer$, Width: \"50\")\n                Button(Body: EUR, Page: #this_page#, PageParams: \"type_currency=3\", Class: btn btn-primary).Popup(Header: $@1ts_add_transfer$, Width: \"50\")\n            }.ElseIf(GetVar(type_currency)==2){\n                Input(Name: CurrencyType, Type: hidden, Value: 2)\n                Button(Body: BTC, Page: #this_page#, PageParams: \"type_currency=1\", Class: btn btn-primary mr-lg).Popup(Header: $@1ts_add_transfer$, Width: \"50\")\n                Button(Body: ETH, Page: #this_page#, PageParams: \"type_currency=2\", Class: btn btn-primary disabled mr-lg).Popup(Header: $@1ts_add_transfer$, Width: \"50\")\n                Button(Body: EUR, Page: #this_page#, PageParams: \"type_currency=3\", Class: btn btn-primary).Popup(Header: $@1ts_add_transfer$, Width: \"50\")\n            }.ElseIf(GetVar(type_currency)==3){\n                Input(Name: CurrencyType, Type: hidden, Value: 3)\n                Button(Body: BTC, Page: #this_page#, PageParams: \"type_currency=1\", Class: btn btn-primary mr-lg).Popup(Header: $@1ts_add_transfer$, Width: \"50\")\n                Button(Body: ETH, Page: #this_page#, PageParams: \"type_currency=2\", Class: btn btn-primary mr-lg).Popup(Header: $@1ts_add_transfer$, Width: \"50\")\n                Button(Body: EUR, Page: #this_page#, PageParams: \"type_currency=3\", Class: btn btn-primary disabled).Popup(Header: $@1ts_add_transfer$, Width: \"50\")\n            }\n        }\n    }\n    Div(row){\n        Div(col-sm-4 mt text-bold text-right){\n            If(GetVar(type_currency)==1){\n                LangRes(@1ts_wallet_btc)\n            }.ElseIf(GetVar(type_currency)==2){\n                LangRes(@1ts_wallet_eth)\n            }.ElseIf(GetVar(type_currency)==3){\n                LangRes(@1pub_key)\n            }\n        }\n        Div(col-sm-8 text-left){\n            Input(Name: WalletStr, Type: textarea)\n        }\n    }\n    Div(row mt-sm){\n        Div(col-sm-4 mt-sm text-right text-bold){\n            LangRes(@1amount_apl)\n        }\n        Div(col-sm-8 text-left){\n            Input(Name:AmountApl, Type:number)\n        }\n    }\n    Div(row mt-sm){\n        Div(col-sm-4 mt-sm text-right text-bold){\n            LangRes(@1investor_funds_transfer_date)\n        }\n        Div(col-sm-8 text-left){\n            Div(row){\n                Div(col-sm-6){\n                    Input(Name:TransferredDate, Type:date)\n                }\n                Div(col-sm-6){\n                    Input(Name:TransferredTime, Type:time, Value: \"00:00\")\n                }\n            }\n        }\n    }\n    Button(Body: $@1send_to_check$, Class: btn btn-primary pull-right mt, Page: #back_page#, Contract: TsTransferAdmin).Alert(Text: \"$@1want_add_investor$\", ConfirmButton: \"$@1yes$\", CancelButton: \"$@1no$\", Icon: question)\n    Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt, Page: #back_page#)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_transfer_manager",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\n\nSetVar(this_page, ts_transfer_manager)\nSetVar(role_param, role_sale_manager)\nSetVar(needed_role_id, EcosysParam(Name:#role_param#))\n\nSetVar(isStartProcessing,0)\nIf(#notific_id#>0){\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->sale_id,date_start_processing,notification->type,processing_info->member_id,closed\").Vars(note)\n    If(#note_date_start_processing#!=\"\"){\n        SetVar(isStartProcessing,1)\n    }\n}.ElseIf(GetVar(SaleId)!=\"\"){\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, \"page_params->sale_id\":#SaleId#, closed:0}).Columns(\"page_params->sale_id,date_start_processing,notification->type,processing_info->member_id,id\").Vars(note)\n    SetVar(notific_id,#note_id#)\n    If(#note_date_start_processing#!=\"\"){\n        SetVar(isStartProcessing,1)\n    }\n}\nSetVar(sale_id,0)\nIf(#note_page_params_sale_id#>0){\n    DBFind(@1ts_sales).Where({id:#note_page_params_sale_id#}).Vars(sale)\n    DBFind(@1ts_wallets).Where({key_id_buyer:#sale_key_id_buyer#}).Vars(wallet)\n}\n\nDiv(content-wrapper){\n    Form(){\n        If(And(#needed_role_id#>0,#role_id#==#needed_role_id#,#sale_id#>0)){\n            Div(list-group-item){\n                Div(text-center text-bold h4 m0){\n                    LangRes(@1ts_transfer_manager)\n                }\n            }\n            Div(list-group-item){\n                Div(row mt-sm){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1key_id_investor$\n                    }\n                    Div(col-sm-9 text-left){\n                        LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#sale_key_id_buyer#\"){\n                            Address(#sale_key_id_buyer#)\n                        }\n                    }\n                }\n                Div(row){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1tokens$\n                    }\n                    Div(col-sm-9 text-left){\n                        Money(#sale_amount_apl#) APLA\n                    }\n                }\n                Div(row mt-sm){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1pub_key$\n                    }\n                    Div(col-sm-9 text-left){\n                        Span(Class: h6, Body: #wallet_pub_buyer#)\n                    }\n                }\n                Div(row){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1ts_wallet_btc$\n                    }\n                    Div(col-sm-9 text-left){\n                        Span(Class: h6, Body: #wallet_wallet_btc#)\n                    }\n                }\n                Div(row){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1ts_wallet_eth$\n                    }\n                    Div(col-sm-9 text-left){\n                        Span(Class: h6, Body: #wallet_wallet_eth#)\n                    }\n                }\n                Div(row mt-sm text-muted ){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1investor_funds_transfer_date$\n                    }\n                    Div(col-sm-9 text-left){\n                        DateTime(#sale_buyer_transferred_at#, Format: YYYY-MM-DD HH:MI:SS)\n                    }\n                }\n                Div(row text-muted){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1created_at$\n                    }\n                    Div(col-sm-9 text-left){\n                        DateTime(#sale_created_at#, Format: YYYY-MM-DD HH:MI:SS)\n                    }\n                }\n                Div(row text-muted){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1created_by$\n                    }\n                    Div(col-sm-9 text-left){\n                        Address(#sale_key_id_sale_apl_admin#)\n                    }\n                }\n            }\n            If(#sale_status# == 1){\n                Div(list-group-item){\n                    If(And(#note_processing_info_member_id#==#key_id#,#isStartProcessing#==1)){\n                        Button(Body: $@1reject$, Class: btn btn-default, Page: ts_transfer_reject, PageParams: \"RoleParam=#role_param#,notific_id=#notific_id#,back_page=#this_page#\").Popup(50,\"Rejected comment\")\n                        Button(Body: $@1accept$, Class: btn btn-primary pull-right, Page: ts_sales, Contract: TsTransferManager, Params: \"SaleId=#sale_id#,NotificId=#notific_id#\")\n                    }.ElseIf(#isStartProcessing#==1){\n                        Div(text-muted text-center){\n                            process begin another manager\n                        }\n                    }.ElseIf(#isStartProcessing#==0){\n                        Div(text-right){\n                            Button(Body: $@1processing$, Class: btn btn-primary, Page: #this_page#, PageParams: \"notific_id=#notific_id#\", Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\")\n                        }\n                    }\n                }\n            }\n        }.Else{\n            Div(list-group-item text-center h4){\n                If(#needed_role_id#>0){\n                    If(#needed_role_id#!=#role_id#){\n                        DBFind(@1parameters).Where({ecosystem:#ecosystem_id#, name:#role_param#}).Vars(param)\n                        Div(h4){\n                            This page only for role from parameter LinkPage(Page: @1params_edit, PageParams: \"id=#param_id#,back_page=#this_page#\", Body:#role_param#)\n                        }\n                    }\n                }.Else{\n                    Div(h4){\n                        #role_param# not setted\n                    }\n                    Div(h4){\n                        LinkPage(Body:$@1ts_settings$, Page:ts_settings)\n                    }\n                }\n\n                If(#note_id_page_params_sale_id#>0){\n                    If(#sale_id#>0){}.Else{\n                        Sale not found\n                    }\n                }.Else{\n                    Notification not found\n                }\n            }\n        }\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_transfer_reject",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(needed_role_id,0)\nIf(GetVar(RoleParam)!=\"\"){\n    SetVar(needed_role_id, EcosysParam(Name:#RoleParam#))\n}\nIf(GetVar(notific_id)!=\"\"){\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->sale_id\").Vars(note)\n}\nSetVar(sale_id,0)\nIf(#note_page_params_sale_id#>0){\n    DBFind(@1ts_sales).Where({id:#note_page_params_sale_id#}).Vars(sale)\n}\n\nForm(){\n    If(And(#needed_role_id#>0,#role_id#==#needed_role_id#,#sale_id#>0)){\n        Div(mb){\n            Input(Name:Comment, Type:textarea)\n        }\n        Div(){\n            Button(Body: $@1back$, Class: btn btn-default, Page: #back_page#, PageParams: \"notific_id=#notific_id#\")\n            Button(Body: $@1send$, Class: btn btn-primary pull-right, Page: default_page, Contract: TsTransferReject, Params: \"RoleParam=#RoleParam#,NotificId=#notific_id#\")\n        }\n    }.Else{\n        Div(text-center text-muted){\n            If(And(#needed_role_id#>0,#role_id#!=#needed_role_id#)){\n                Div(){\n                    for added comment you must be logined as role id #needed_role_id#\n                }\n            }\n            If(#sale_id#==0){\n                Div(){\n                    sale not found\n                }\n            }\n        }\n        Div(){\n            Button(Body: $@1back$, Class: btn btn-default, Page: #back_page#, PageParams: \"notific_id=#notific_id#\")\n        }\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_transfer_seller",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\n\nSetVar(this_page, ts_transfer_seller)\nSetVar(role_param, role_sale_seller)\nSetVar(needed_role_id, EcosysParam(Name:#role_param#))\n\nAppParam(App:#application_id#, Name:ts_currency_type, Ecosystem: #ecosystem_id#, Source:currency_type)\nSetVar(isStartProcessing,0)\nIf(#notific_id#>0){\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->sale_id,date_start_processing,notification->type,processing_info->member_id,closed\").Vars(note)\n    If(#note_date_start_processing#!=\"\"){\n        SetVar(isStartProcessing,1)\n    }\n}.ElseIf(GetVar(SaleId)!=\"\"){\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, \"page_params->sale_id\":#SaleId#, closed:0}).Columns(\"page_params->sale_id,date_start_processing,notification->type,processing_info->member_id,closed\").Vars(note)\n    SetVar(notific_id,#note_id#)\n    If(#note_date_start_processing#!=\"\"){\n        SetVar(isStartProcessing,1)\n    }\n}\nSetVar(sale_id,0)\nIf(#note_page_params_sale_id#>0){\n    DBFind(@1ts_sales).Where({id:#note_page_params_sale_id#}).Vars(sale)\n}\n\nDiv(content-wrapper){\n    Form(){\n        DBFind(@1ts_wallets, wallets).Where({key_id_buyer:{$neq:0}, key_id_signer:{$neq:0}, rejected_at:0}).Vars(wallet).Custom(_name){\n            Address(#key_id_buyer#)\n        }\n        If(And(#needed_role_id#>0,#role_id#==#needed_role_id#,#sale_id#>0)){\n            Div(list-group-item){\n                Div(text-center text-bold h4 m0){\n                    LangRes(@1ts_transfer_seller)\n                }\n            }\n            Div(list-group-item){\n                Div(row mt-sm){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1key_id_investor$\n                    }\n                    Div(col-sm-9 text-left){\n                        LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#sale_key_id_buyer#\"){\n                            Address(#sale_key_id_buyer#)\n                        }\n                    }\n                }\n                Div(row){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1tokens$\n                    }\n                    Div(col-sm-9 text-left){\n                        Money(#sale_amount_apl#) APLA\n                    }\n                }\n                Div(row mt-sm){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1pub_key$\n                    }\n                    Div(col-sm-9 text-left){\n                        Span(Class: h6, Body: #wallet_pub_buyer#)\n                    }\n                }\n                Div(row){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1ts_wallet_btc$\n                    }\n                    Div(col-sm-9 text-left){\n                        Span(Class: h6, Body: #wallet_wallet_btc#)\n                    }\n                }\n                Div(row){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1ts_wallet_eth$\n                    }\n                    Div(col-sm-9 text-left){\n                        Span(Class: h6, Body: #wallet_wallet_eth#)\n                    }\n                }\n                Div(row mt-sm text-muted){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1investor_funds_transfer_date$\n                    }\n                    Div(col-sm-9 text-left){\n                        DateTime(#sale_buyer_transferred_at#, Format: YYYY-MM-DD HH:MI:SS)\n                    }\n                }\n                Div(row text-muted){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1created_at$\n                    }\n                    Div(col-sm-9 text-left){\n                        DateTime(#sale_created_at#, Format: YYYY-MM-DD HH:MI:SS)\n                    }\n                }\n                Div(row text-muted){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1created_by$\n                    }\n                    Div(col-sm-9 text-left){\n                        Address(#sale_key_id_sale_apl_admin#)\n                    }\n                }\n                Div(row text-muted){\n                    Div(col-sm-3 text-right text-bold){\n                        $@1checked_by$\n                    }\n                    Div(col-sm-9 text-left){\n                        Address(#sale_key_id_sale_apl_manager#)\n                    }\n                }\n            }\n            If(#sale_status# == 2){\n                Div(list-group-item){\n                    If(And(#note_processing_info_member_id#==#key_id#,#isStartProcessing#==1)){\n                        Button(Body: $@1reject$, Class: btn btn-default, Page: ts_transfer_reject, PageParams: \"RoleParam=#role_param#,notific_id=#notific_id#,back_page=#this_page#\").Popup(50,\"Rejected comment\")\n                        Button(Body: $@1accept$, Class: btn btn-primary pull-right, Page: ts_sales, Contract: TsTransferSeller, Params: \"SaleId=#sale_id#,NotificId=#notific_id#\")\n                    }.ElseIf(#isStartProcessing#==1){\n                        Div(text-muted text-center){\n                            process begin another seller\n                        }\n                    }.ElseIf(#isStartProcessing#==0){\n                        Div(text-right){\n                            Button(Body: $@1processing$, Class: btn btn-primary, Page: #this_page#, PageParams: \"notific_id=#notific_id#\", Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\")\n                        }\n                    }\n                }\n            }\n        }.Else{\n            Div(panel-body){\n                If(#needed_role_id#>0){\n                    If(#needed_role_id#!=#role_id#){\n                        DBFind(@1parameters).Where({ecosystem:#ecosystem_id#, name:#role_param#}).Vars(param)\n                        Div(h4){\n                            This page only for role from parameter LinkPage(Page: @1params_edit, PageParams: \"id=#param_id#,back_page=#this_page#\", Body:#role_param#)\n                        }\n                    }\n                }.Else{\n                    Div(h4){\n                        #role_param# not setted\n                    }\n                    Div(h4){\n                        LinkPage(Body:$@1ts_settings$, Page:ts_settings)\n                    }\n                }\n            }\n        }\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_transfer_view",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\nSetVar(row,\"row mt-sm\").(col_left,\"col-sm-6 text-right text-bold\").(col-right,\"col-sm-6 text-left\")\nIf(GetVar(back_page)==\"\"){\n    SetVar(back_page, @1ts_sales)\n}\nIf(GetVar(Id)){\n    DBFind(@1ts_sales).Where({id:#Id#}).Vars(sale)\n}\n\nIf(#sale_id#>0){\n    Div(#row#){\n        Div(#col_left#){\n            $@1key_id_investor$\n        }\n        Div(#col_right#){\n            LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#sale_key_id_buyer#\"){\n                Address(#sale_key_id_buyer#)\n            }\n        }\n    }\n    Div(#row#){\n        Div(#col_left#){\n            $@1tokens$\n        }\n        Div(#col_right#){\n            Money(#sale_amount_apl#) APLA\n        }\n    }\n    Div(#row#){\n        Div(#col_left#){\n            $@1key_id_sale_apl_admin$\n        }\n        Div(#col_right#){\n            Address(#sale_key_id_sale_apl_admin#) (#sale_key_id_sale_apl_admin#)\n        }\n    }\n    If(#sale_key_id_sale_apl_manager#!=0){\n        Div(#row#){\n            Div(#col_left#){\n                $@1key_id_sale_apl_manager$\n            }\n            Div(#col_right#){\n                Address(#sale_key_id_sale_apl_manager#) (#sale_key_id_sale_apl_manager#)\n            }\n        }\n        If(#sale_manager_rejected_at#>0){\n            Div(#row#){\n                Div(#col_left#){\n                    $@1manager_rejected_at$\n                }\n                Div(#col_right#){\n                    DateTime(#sale_manager_rejected_at#, Format: YYYY-MM-DD HH:MI:SS)\n                }\n            }\n\n            Div(#row#){\n                Div(#col_left#){\n                    $@1manager_reject_comment$\n                }\n                Div(#col_right#){\n                    #sale_manager_reject_comment#\n                }\n            }\n        }\n    }\n    If(#sale_key_id_seller#!=0){\n        Div(#row#){\n            Div(#col_left#){\n                $@1key_id_seller$\n            }\n            Div(#col_right#){\n                Address(#sale_key_id_seller#) (#sale_key_id_seller#)\n            }\n        }\n        If(#sale_seller_rejected_at#>0){\n            Div(#row#){\n                Div(#col_left#){\n                    $@1seller_rejected_at$\n                }\n                Div(#col_right#){\n                    DateTime(#sale_seller_rejected_at#, Format: YYYY-MM-DD HH:MI:SS)\n                }\n            }\n\n            Div(#row#){\n                Div(#col_left#){\n                    $@1seller_reject_comment$\n                }\n                Div(#col_right#){\n                    #sale_seller_reject_comment#\n                }\n            }\n        }.Else{\n            Div(#row#){\n                Div(#col_left#){\n                    $@1seller_transferred_at$\n                }\n                Div(#col_right#){\n                    DateTime(#sale_seller_transferred_at#, Format: YYYY-MM-DD HH:MI:SS)\n                }\n            }\n        }\n    }\n\n}\nDiv(row mt){\n    Div(col-md-12){\n        Button(Body: LangRes(@1back), Class: btn btn-default, Page: #back_page#)\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_wallets",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1ts_wallets).(this_table, @1ts_wallets)\nInclude(@1pager_header)\n\nSetTitle(\"$@1ts_wallets$\")\nSetVar(snapswap_role_id, EcosysParam(Name:role_snapswap))\nIf(And(#snapswap_role_id#>0,#role_id#==#snapswap_role_id#)){\n    AddToolButton(Title:$@1ts_add_public_key$, Page: @1ts_key_approve, Icon: icon-wallet).Popup(Header: $@1ts_add_public_key$, Width: \"50\")\n}\n\nIf(GetVar(search)!=\"\"){\n    SetVar(where, {$and: [{\"key_id_buyer\":{$neq:0}}, {$or:[{\"pub_buyer\": {$like: #search#}},{\"wallet_btc\": {$like: #search#}},{\"wallet_eth\": {$like: #search#}}]}]})\n}.Else{\n    SetVar(where, {\"key_id_buyer\":{$neq:0}}).(search,)\n}\n\nDiv(list-group-item ml-lg mr-lg pt-lg){\n    SetVar(search_name, LangRes(@1pub_key) \\ LangRes(@1wallet))\n    Include(@1search)\n}\n\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": -1}).Limit(#pager_limit#).Offset(#pager_offset#).Custom(_rat){\n    If(#rejected_at#>0){\n        DateTime(#rejected_at#, Format: YYYY-MM-DD HH:MI:SS)\n    }.Else{\n        Span(Class: text-muted, Body: --)\n    }\n}.Custom(_sat){\n    If(#signed_at#>0){\n        DateTime(#signed_at#, Format: YYYY-MM-DD HH:MI:SS)\n    }\n}.Custom(_cat){\n    If(#created_at#>0){\n        Span(Class:text-muted, Body:DateTime(#created_at#, Format: YYYY-MM-DD HH:MI:SS))\n    }\n}.Custom(_buyer){\n    LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#key_id_buyer#\"){\n        Address(#key_id_buyer#)\n    }\n    Div(){\n        Span(Class: h6 text-muted, Body: PUB:)\n        Span(Class: h6 text-muted ml-sm, Body: #pub_short_buyer#)\n    }\n}.Custom(_signer){\n    If(#key_id_signer#!=0){\n        Span(Class:text-success, Body: Address(#key_id_signer#))\n    }\n}.Custom(_wlts){\n    Div(){\n        Span(Class: h6 text-muted, Body: BTC:)\n        Span(Class: h6 ml-sm, Body: #wallet_btc#)\n    }\n    Div(){\n        Span(Class: h6 text-muted, Body: ETH:)\n        Span(Class: h6 ml-sm, Body: #wallet_eth#)\n    }\n}.Count(count)\n\nDiv(fullscreen){\n    Div(table-responsive ml-lg mr-lg){\n        Div(list-group-item){\n            If(#count# > 0){\n                Table(src, \"$@1id$=id,$@1key_id_investor$=_buyer,$@1wallets$=_wlts,$@1created_at$=_cat,$@1signed_at$=_sat,$@1rejected_at$=_rat,$@1key_id_consensus$=_signer\")\n            }.Else{\n                Div(Class: text-center h4 text-muted, Body: \"$@1wallets$ $@1not_founded$\")\n            }                       \n        }.Style(\n            margin-top:-15px;\n            tbody > tr:nth-of-type(odd) {\n                background-color: #f8f9fc;\n            }\n        )\n    }\n}\nDiv(mt-sm ml-lg mr-sm mb-sm){\n    Include(@1pager)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "TsBuyerAction",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsBuyerAction {\n    data {\n        Action string\n    }\n    conditions{\n        var basicAppId int\n        basicAppId = Int(DBFind(\"@1applications\").Where({ecosystem:1, name:\"Basic\"}).One(\"id\"))\n        if basicAppId == 0{\n            warning LangRes(\"@1app_not_found\", \"en\")\n        }\n        $roleConsensus = Int(EcosysParam(\"role_apla_consensus_asbl\"))\n        if $roleConsensus == 0{\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), \"role_apla_consensus_asbl\")\n        }\n        $wallet = DBFind(\"ts_wallets\").Where({key_id_buyer:$key_id, rejected_at:0}).Row()\n        if !$wallet{\n            warning \"Buyer wallet not found\"\n        }\n    }\n\n    action {\n        if $Action == \"accept\"{\n            DBUpdate(\"ts_wallets\", Int($wallet[\"id\"]), {signed_at:$time})\n            // role Apla Consensus notification\n            var params map title string\n            title = Sprintf(\"Buyer %v signed contract\", IdToAddress($key_id))\n            params[\"wallet_id\"] = $wallet[\"id\"]\n            @1NotificationsSend(\"rid,sender,text_header,page_name,params_map,closure_type\", $roleConsensus, 1, title, \"ts_consensus_contract\", params, 1)\n\n        }elif $Action == \"reject\"{\n            DBUpdate(\"ts_wallets\", Int($wallet[\"id\"]), {rejected_at:$time})\n        }\n\n        var notes array i int note map\n        notes = DBFind(\"@1notifications\").Where({ecosystem:$ecosystem_id, \"recipient->member_id\":$key_id, page_name:\"@1ts_buyer_contract\", closed:0}).Columns(\"id\")\n        while i < Len(notes){\n            note = notes[i]\n            @1NotificationsClose(\"notific_id\",Int(note[\"id\"]))\n            i = i + 1\n        }\n    }\n}\n",
            "Type": "contracts"
        },
        {
            "Name": "TsConsensusAction",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsConsensusAction {\n    data {\n        Action string\n        WalletId int\n        NotificId int\n    }\n    conditions{\n        var basicAppId int\n        basicAppId = Int(DBFind(\"@1applications\").Where({ecosystem:1, name:\"Basic\"}).One(\"id\"))\n        if basicAppId == 0{\n            warning LangRes(\"@1app_not_found\", \"en\")\n        }\n        $roleConsensus = Int(EcosysParam(\"role_apla_consensus_asbl\"))\n        if $roleConsensus == 0{\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), \"role_apla_consensus_asbl\")\n        }\n        if !RoleAccess($roleConsensus){\n            warning \"this action allowed only for role id #\" + $roleConsensus\n        }\n        $wallet = DBFind(\"ts_wallets\").Where({id:$WalletId, rejected_at:0}).Row()\n        if !$wallet{\n            warning \"Buyer wallet not found\"\n        }\n        if Int($wallet[\"signed_at\"]) == 0{\n            warning \"Buyer wallet not signed\"\n        }\n        if $wallet[\"key_id_signer\"] > 0{\n            if $wallet[\"key_id_signer\"] != $key_id{\n                warning \"This wallet was signed by asbl early\"\n            }\n        }\n    }\n\n    action {\n        if $Action == \"accept\"{\n            DBUpdate(\"ts_wallets\", Int($wallet[\"id\"]), {key_id_signer:$key_id})\n            // buyer notification\n            var params map\n            params[\"wallet_id\"] = $wallet[\"id\"]\n            @1NotificationsSend(\"member_id,sender,text_header,page_name,params_map,closure_type\", Int($wallet[\"key_id_buyer\"]), 1, \"Your wallet approved\", \"ts_buyer_congratulation\", params, 1)\n\n        }elif $Action == \"reject\"{\n            DBUpdate(\"ts_wallets\", Int($wallet[\"id\"]), {rejected_at:$time})\n        }\n        @1NotificationsClose(\"notific_id\", $NotificId)\n    }\n}\n",
            "Type": "contracts"
        },
        {
            "Name": "TsFreeWalletAdd",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsFreeWalletAdd {\n    data {\n        wallet_btc string\n        wallet_eth string\n    }\n\n    conditions {\n        var adminRoleId int adminRoleName string\n        adminRoleId = Int(EcosysParam(\"role_sale_admin\"))\n        adminRoleName = DBFind(\"@1roles\").Where({\"id\": adminRoleId}).One(\"role_name\")\n\n        if adminRoleId == 0 {\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), \"role_sale_admin\")\n        }\n\n        if !RoleAccess(adminRoleId) {\n            warning Sprintf(LangRes(\"x_role_only_action\", \"en\"), adminRoleName)\n        }\n\n        if DBFind(\"ts_wallets\").Where({\"wallet_btc\": $wallet_btc}).One(\"id\") {\n            warning Sprintf(LangRes(\"wallet_btc_exists\", \"en\"), $wallet_btc)\n        }\n\n        if DBFind(\"ts_wallets\").Where({\"wallet_eth\": $wallet_eth}).One(\"id\") {\n            warning Sprintf(LangRes(\"wallet_eth_exists\", \"en\"), $wallet_eth)\n        }\n    }\n\n    action {\n        DBInsert(\"ts_wallets\", {\"wallet_btc\": $wallet_btc, \"wallet_eth\": $wallet_eth})\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsFreeWalletDelete",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsFreeWalletDelete {\n    data {\n        wallet_id int\n    }\n\n    conditions {\n        var adminRoleId int adminRoleName string\n        adminRoleId = Int(EcosysParam(\"role_sale_admin\"))\n        adminRoleName = DBFind(\"@1roles\").Where({\"id\": adminRoleId}).One(\"role_name\")\n\n        if adminRoleId == 0 {\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), \"role_sale_admin\")\n        }\n\n        if !RoleAccess(adminRoleId) {\n            warning Sprintf(LangRes(\"x_role_only_action\", \"en\"), adminRoleName)\n        }\n    }\n\n    action {\n        DBUpdate(\"ts_wallets\", $wallet_id, {\"deleted\": 1})\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsKeyApprove",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsKeyApprove {\n    data {\n        public_key string\n        key_type string\n        current_role_id int\n    }\n\n    func getFreeWallet() int {\n        var count_wallets int wallet_map map wallet_arr array\n        wallet_arr = DBFind(\"ts_wallets\").Where({\"key_id_buyer\": 0, \"deleted\":0}).Order({\"id\": 1})\n        \n        count_wallets = Len(wallet_arr)\n        if count_wallets == 0 {\n            warning LangRes(\"@1ts_free_wallet_not_found\", \"en\")\n        }\n\n        if count_wallets == 1 {\n            var managerRoleId int\n            managerRoleId = Int(EcosysParam(\"role_sale_manager\"))\n            if managerRoleId > 0 {\n                var params map title page body string\n                title = LangRes(\"@1ts_free_wallets_emptied\", \"en\")\n                body = LangRes(\"@1ts_free_wallets_need\", \"en\")\n                page = \"@1ts_notification\"\n                @1NotificationsSend(\"rid,sender,text_header,text_body,page_name,params_map,closure_type,current_role_id\", managerRoleId, 2, title, body, page, params, 1, $current_role_id)   \n            }\n        }\n\n        wallet_map = wallet_arr[0] \n        return Int(wallet_map[\"id\"])\n    }\n\n    conditions {\n        if $public_key == \"\" {\n            warning LangRes(\"@1public_key_empty\", \"en\")\n        }\n\n        $public_key = Replace($public_key, \" \", \"\")\n        $userKey = PubToID($public_key)\n\n        if $userKey == 0 || Size($public_key) != 128 {\n            warning LangRes(\"@1public_key_invalid\", \"en\")\n        }\n\n        if DBFind(\"ts_wallets\").Where({key_id_buyer: $userKey}).One(\"id\") {\n            warning LangRes(\"@1investor_added_already\", \"en\")\n        }\n\n        if DBFind(\"@1keys\").Where({id: $userKey, ecosystem: 1}).One(\"id\") {\n            warning LangRes(\"@1key_added_already\", \"en\")\n        }\n\n        var snapSwapRoleId int snapSwapRoleName string\n        snapSwapRoleId = Int(EcosysParam(\"role_snapswap\"))\n        snapSwapRoleName = DBFind(\"@1roles\").Where({\"id\": snapSwapRoleId}).One(\"role_name\")\n\n        if snapSwapRoleId == 0 {\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), \"role_snapswap\")\n        }\n\n        if !RoleAccess(snapSwapRoleId) {\n            warning Sprintf(LangRes(\"x_role_only_action\", \"en\"), snapSwapRoleName)\n        }\n    }\n\n    action {\n        DBInsert(\"@1keys\", {\"id\": $userKey, \"pub\": $public_key, \"ecosystem\": 1})\n        var start_balance money\n        start_balance = Money(1000000000000000)\n        @1TokensSend(\"Recipient,Amount\", IdToAddress($userKey), start_balance)\n\n        if $key_type == \"investor\" {\n            $wallet_id = getFreeWallet()\n            $pub_short_buyer = Substr($public_key, 0, 12) + \"...\" + Substr($public_key, Size($public_key)-12, 12)\n            DBUpdate(\"ts_wallets\", $wallet_id, {\"key_id_buyer\": $userKey, \"created_at\": $block_time, \"pub_buyer\": $public_key, \"pub_short_buyer\": $pub_short_buyer})\n\n            // new user notification\n            var params map title page body string\n            title = LangRes(\"@1ts_hello_user_description\", \"en\")\n            body = LangRes(\"@1ts_read_contract\", \"en\")\n            page = \"@1ts_buyer_contract\"\n            @1NotificationsSend(\"member_id,sender,text_header,text_body,page_name,params_map,closure_type,current_role_id\", $userKey, 2, title, body, page, params, 1, $current_role_id)          \n        }\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsSettings",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsSettings {\n    data {\n        RoleAdmin int\n        RoleManager int\n        RoleSeller int\n        RoleSnapswap int\n    }\n    conditions{\n        MainCondition()\n    }\n    func updateParam(name string, id int){\n        if id > 0{\n            var params paramsNew map\n            params = DBFind(\"@1parameters\").Where({name:name, ecosystem:$ecosystem_id}).Row()\n            paramsNew[\"Value\"] = Str(id)\n            if params {\n                paramsNew[\"Id\"] = Int(params[\"id\"])\n                paramsNew[\"Conditions\"] = params[\"conditions\"]\n                CallContract(\"@1EditParameter\", paramsNew)\n            }else{\n                paramsNew[\"Name\"] = name\n                paramsNew[\"Conditions\"] = \"ContractConditions(\\\"MainCondition\\\")\"\n                CallContract(\"@1NewParameter\", paramsNew)\n            }\n        }\n    }\n    action {\n        updateParam(\"role_sale_admin\", $RoleAdmin)\n        updateParam(\"role_sale_manager\", $RoleManager)\n        updateParam(\"role_sale_seller\", $RoleSeller)\n        updateParam(\"role_snapswap\", $RoleSnapswap)\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsTransferAdmin",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsTransferAdmin {\n    data {\n        WalletStr string\n        CurrencyType int\n        AmountApl money\n        TransferredDate string\n        TransferredTime string\n    }\n\n    func getRoleId(name string) int {\n        var rid int\n        rid = Int(EcosysParam(name))\n        if rid == 0 {\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), name)\n        }\n        return rid\n    }\n\n    func trimZeroTime(s string) string {\n        if Contains(s, \"T00:00:00Z\") {\n            s = s Replace(s, \"T00:00:00Z\", \"\")\n        }\n        return s\n    }\n\n    func dateAddTime(d, t string) string {\n        var dt string\n        if Size(t) == 5 {\n            dt = Sprintf(\"%v %v:00\", trimZeroTime(d), t)\n        }\n        return dt\n    }\n\n    conditions {\n        $WAITING_MANAGER = 1\n        $WAITING_SELLER = 2\n        $FINISHED = 3\n        $REJECTED = 4\n        if $AmountApl <= 0 {\n            warning \"invalid amount APLA\"\n        }\n\n        $transferredAt = UnixDateTime(dateAddTime($TransferredDate, $TransferredTime))\n        if $transferredAt == 0 {\n            warning \"invalid transfer datetime\"\n        }\n        \n        $appId = Int(DBFind(\"@1applications\").Where({ecosystem:$ecosystem_id, name:\"Tokens sale\"}).One(\"id\"))\n        if $appId == 0 {\n            warning LangRes(\"@1app_not_found\", \"en\")\n        }\n        \n        $currentRole = getRoleId(\"role_sale_admin\")\n        if !RoleAccess($currentRole) {\n            warning \"this action allowed only for role id #\" + $currentRole\n        }\n\n        if $CurrencyType <= 0 || $CurrencyType > 3 {\n            warning \"Invalid Currency Type\"\n        }\n\n        if $CurrencyType == 1 {\n            $wallet = DBFind(\"ts_wallets\").Where({wallet_btc: $WalletStr}).Row()\n        }\n        if $CurrencyType == 2 {\n            $wallet = DBFind(\"ts_wallets\").Where({wallet_eth: $WalletStr}).Row()\n        }\n        if $CurrencyType == 3 {\n            if $WalletStr == \"\" {\n                warning LangRes(\"@1public_key_empty\", \"en\")\n            }\n\n            $WalletStr = Replace($WalletStr, \" \", \"\")\n            var key_id_buyer int\n            key_id_buyer = PubToID($WalletStr)\n            if key_id_buyer == 0 || Size($WalletStr) != 128 {\n                warning LangRes(\"@1public_key_invalid\", \"en\")\n            }\n            \n            $wallet = DBFind(\"ts_wallets\").Where({key_id_buyer: key_id_buyer}).Row()\n        }\n\n        if !$wallet {\n            warning \"Buyer wallet not found\"\n        }\n    }\n\n    action {\n        var sale map saleId int\n        sale[\"key_id_buyer\"] = $wallet[\"key_id_buyer\"]\n        sale[\"currency_type\"] = $CurrencyType\n        sale[\"amount_apl\"] = $AmountApl\n        sale[\"key_id_sale_apl_admin\"] = $key_id\n        sale[\"created_at\"] = $time\n        sale[\"buyer_transferred_at\"] = $transferredAt\n        sale[\"status\"] = $WAITING_MANAGER\n\n        saleId = DBInsert(\"ts_sales\", sale)\n\n        // role Apla sales manager notification\n        var params map title page string\n        title = Sprintf(\"Check sale id %v\", saleId)\n        page = \"ts_transfer_manager\"\n        params[\"sale_id\"] = saleId\n        $roleAplManager = getRoleId(\"role_sale_manager\")\n        @1NotificationsSend(\"rid,sender,text_header,page_name,params_map,closure_type,current_role_id\", $roleAplManager, 2, title, page, params, 1, $currentRole)\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsTransferManager",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsTransferManager {\n    data {\n        SaleId int\n        NotificId int\n    }\n    func getRoleId(name string) int{\n        var rid int\n        rid = Int(EcosysParam(name))\n        if rid == 0{\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), name)\n        }\n        return rid\n    }\n    conditions{\n        $WAITING_MANAGER = 1\n        $WAITING_SELLER = 2\n        $FINISHED = 3\n        $REJECTED = 4\n        $appId = Int(DBFind(\"@1applications\").Where({ecosystem:$ecosystem_id, name:\"Tokens sale\"}).One(\"id\"))\n        if $appId == 0{\n            warning LangRes(\"@1app_not_found\", \"en\")\n        }\n        $roleAplSeller = getRoleId(\"role_sale_seller\")\n        $currentRole = getRoleId(\"role_sale_manager\")\n        if !RoleAccess($currentRole){\n            warning \"this action allowed only for role id #\" + $currentRole\n        }\n\n        $sale = DBFind(\"ts_sales\").Where({id:$SaleId}).Row()\n        if !$sale{\n            warning \"Sale not found\"\n        }\n    }\n\n    action {\n        @1NotificationsClose(\"notific_id\", $NotificId)\n        DBUpdate(\"ts_sales\", Int($sale[\"id\"]), {key_id_sale_apl_manager:$key_id, status:$WAITING_SELLER})\n\n        // role Apla seller notification\n        var params map title page string\n        title = Sprintf(\"Transfer sale id %v\", $sale[\"id\"])\n        params[\"sale_id\"] = $sale[\"id\"]\n        page = \"ts_transfer_seller\"\n        @1NotificationsSend(\"rid,sender,text_header,page_name,params_map,closure_type,current_role_id\", $roleAplSeller, 2, title, page, params, 1, $currentRole)\n\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsTransferReject",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsTransferReject {\n    data {\n        Comment string\n        RoleParam string\n        NotificId int\n    }\n    func getRoleId(name string) int{\n        var rid int\n        rid = Int(EcosysParam(name))\n        if rid == 0{\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), name)\n        }\n        return rid\n    }\n    conditions{\n        $WAITING_MANAGER = 1\n        $WAITING_SELLER = 2\n        $FINISHED = 3\n        $REJECTED = 4\n\n        if !($RoleParam == \"role_sale_manager\" || $RoleParam == \"role_sale_seller\"){\n            warning \"invalid role parameter\"\n        }\n        var role noteSaleId int note map\n        role = getRoleId($RoleParam)\n        if !RoleAccess(role){\n            warning \"this action allowed only for role id #\" + role\n        }\n        note = DBFind(\"@1notifications\").Where({id:$NotificId}).Columns(\"page_params->sale_id,date_start_processing,notification->type\").Row()\n        if !note{\n            warning \"Notification not found\"\n        }\n        $needProcessing = note[\"date_start_processing\"] == \"\"\n        noteSaleId = Int(note[\"page_params.sale_id\"])\n        $sale = DBFind(\"ts_sales\").Where({id:noteSaleId}).Row()\n        if !$sale {\n            warning \"Sale not found\"\n        }\n        $saleId = Int($sale[\"id\"])\n    }\n\n    action {\n        if $needProcessing {\n            @1NotificationsProcess(\"notific_id\", $NotificId)\n        }\n        @1NotificationsClose(\"notific_id\", $NotificId)\n        var sale params map title body string prevKeyId int\n        title = Sprintf(\"Sale %v rejected\", $saleId)\n        body = $Comment\n        params[\"sale_id\"] = $saleId\n        sale[\"status\"] = $REJECTED\n        if $RoleParam == \"role_sale_manager\"{\n            sale[\"key_id_sale_apl_manager\"] = $key_id\n            sale[\"manager_reject_comment\"] = $Comment\n            sale[\"manager_rejected_at\"] = $time\n            prevKeyId = Int($sale[\"key_id_sale_apl_admin\"])\n\n        }elif $RoleParam == \"role_sale_seller\"{\n            sale[\"key_id_seller\"] = $key_id\n            sale[\"seller_reject_comment\"] = $Comment\n            sale[\"seller_rejected_at\"] = $time\n            prevKeyId = Int($sale[\"key_id_sale_apl_manager\"])\n        }\n\n        DBUpdate(\"ts_sales\", $saleId, sale)\n        @1NotificationsSend(\"member_id,sender,text_header,text_body,page_name,params_map,closure_type\", prevKeyId, 1, title, body, \"ts_notification\", params, 1)\n\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsTransferSeller",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsTransferSeller {\n    data {\n        SaleId int\n        NotificId int\n    }\n    func getRoleId(name string) int{\n        var rid int\n        rid = Int(EcosysParam(name))\n        if rid == 0{\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), name)\n        }\n        return rid\n    }\n    conditions{\n        $WAITING_MANAGER = 1\n        $WAITING_SELLER = 2\n        $FINISHED = 3\n        $REJECTED = 4\n        $appId = Int(DBFind(\"@1applications\").Where({ecosystem:$ecosystem_id, name:\"Tokens sale\"}).One(\"id\"))\n        if $appId == 0{\n            warning LangRes(\"@1app_not_found\", \"en\")\n        }\n        $currentRole = getRoleId(\"role_sale_seller\")\n        if !RoleAccess($currentRole){\n            warning \"this action allowed only for role id #\" + $currentRole\n        }\n\n        $sale = DBFind(\"ts_sales\").Where({id:$SaleId}).Row()\n        if !$sale{\n            warning \"sale not found\"\n        }\n    }\n\n    action {\n        @1NotificationsClose(\"notific_id\", $NotificId)\n        var s transfer map\n        s[\"key_id_seller\"] = $key_id\n        s[\"seller_transferred_at\"] = $time\n        s[\"status\"] = $FINISHED\n        DBUpdate(\"ts_sales\", Int($sale[\"id\"]), s)\n\n        @1TokensSend(\"Recipient,Amount\", $sale[\"key_id_buyer\"], Money($sale[\"amount_apl\"]))\n    }\n}",
            "Type": "contracts"
        }
    ]
}