{
    "name": "Tokens sale",
    "conditions": "ContractConditions(\"@1DeveloperCondition\")",
    "data": [
        {
            "Name": "admin_menu",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "MenuItem(Title:$@1ts_settings$, Page:ts_settings, Icon:\"icon-wrench\")",
            "Type": "menu"
        },
        {
            "Name": "default_menu",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "    SetVar(is_allowed, 0).(k_id, 0).(unreaded_wallet_id,0).(exist_wallet_id,0)\r\n    DBFind(@1keys).Where({id:#key_id#}).Vars(k)\r\n    DBFind(@1ts_wallets).Where({key_id_buyer:#key_id#}).Vars(exist_wallet)\r\n    DBFind(@1ts_wallets).Where({key_id_buyer:#key_id#, rejected_at:0, signed_at:0}).Vars(unreaded_wallet)\r\n\r\n    If(#k_id#!=0){\r\n        If(#exist_wallet_id#>0){\r\n            If(#unreaded_wallet_id#==0){\r\n                SetVar(is_allowed, 1)\r\n            }\r\n        }.Else{\r\n            SetVar(is_allowed, 1)\r\n        }\r\n    }\r\n\r\n    If(#is_allowed#==1){\r\n        SetVar(snapswap_role_id,0).(admin_role_id,0).(manager_role_id,0).(seller_role_id,0)\r\n        SetVar(snapswap_role_id, EcosysParam(Name:role_snapswap))\r\n        SetVar(admin_role_id, EcosysParam(Name:role_sale_admin))\r\n        SetVar(manager_role_id, EcosysParam(Name:role_sale_manager))\r\n        SetVar(seller_role_id, EcosysParam(Name:role_sale_seller))\r\n\r\n        MenuItem(Title:$@1profile$, Page:@1profile_view, Icon:\"icon-wallet\")\r\n        MenuItem(Title:$@1notifications$, Page:@1notifications_list, Icon:\"icon-flag\")\r\n        MenuItem(Title:$@1ecosystem_members$, Page:@1members_list, Icon:\"fa icon-people\")\r\n        MenuItem(Title:$@1ecosystems$, Page:@1ecosystems_list, Icon:\"fa fa-list-ul\")\r\n        MenuGroup(Title:$@1admin$, Icon:\"icon-arrow-right\"){\r\n            MenuItem(Title:$@1roles$, Page:@1roles_list, Icon:\"fa fa-list-ul\")\r\n            MenuItem(Title:$@1votings$, Page:@1voting_list, Icon:\"fa fa-edit\")\r\n            MenuItem(Title:$@1tokens_refund$, Page:@1tokenrefund_list, Icon:\"icon-shuffle\")\r\n            MenuItem(Title:$@1sysparams_candidates$, Page:@1sysparams_candidates_list, Icon:\"icon-graduation\")\r\n        }\r\n        If(And(#admin_role_id#>0,Or(#role_id#==#admin_role_id#,#role_id#==#manager_role_id#,#role_id#==#seller_role_id#))){\r\n            MenuItem(Title:$@1ts_sales$, Page:@1ts_sales, Icon:\"icon-credit-card\")\r\n        }\r\n        If(And(#snapswap_role_id#>0,#role_id#==#snapswap_role_id#)){\r\n            MenuItem(Title:$@1ts_wallets$, Page:@1ts_wallets, Icon:\"icon-credit-card\")\r\n        }\r\n    }",
            "Type": "menu"
        },
        {
            "Name": "ts_sales",
            "Columns": "[\r\n    {\r\n        \"conditions\": \"false\",\r\n        \"name\": \"buyer_transferred_at\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\")\",\r\n        \"name\": \"seller_reject_comment\",\r\n        \"type\": \"text\"\r\n    },\r\n    {\r\n        \"conditions\": \"false\",\r\n        \"name\": \"amount\",\r\n        \"type\": \"varchar\"\r\n    },\r\n    {\r\n        \"conditions\": \"false\",\r\n        \"name\": \"currency_type\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\")\",\r\n        \"name\": \"manager_rejected_at\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferSeller\\\")\",\r\n        \"name\": \"seller_transferred_at\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"conditions\": \"false\",\r\n        \"name\": \"amount_apl\",\r\n        \"type\": \"money\"\r\n    },\r\n    {\r\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\",\\\"@1TsTransferSeller\\\")\",\r\n        \"name\": \"key_id_seller\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\")\",\r\n        \"name\": \"seller_rejected_at\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"conditions\": \"false\",\r\n        \"name\": \"key_id_sale_apl_admin\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\")\",\r\n        \"name\": \"manager_reject_comment\",\r\n        \"type\": \"text\"\r\n    },\r\n    {\r\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\",\\\"@1TsTransferManager\\\")\",\r\n        \"name\": \"key_id_sale_apl_manager\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"conditions\": \"false\",\r\n        \"name\": \"created_at\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"conditions\": \"false\",\r\n        \"name\": \"key_id_buyer\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"conditions\": \"ContractAccess(\\\"@1TsTransferReject\\\",\\\"@1TsTransferManager\\\",\\\"@1TsTransferAdmin\\\",\\\"@1TsTransferSeller\\\")\",\r\n        \"name\": \"status\",\r\n        \"type\": \"number\"\r\n    }\r\n]",
            "Permissions": "{\"insert\": \"ContractAccess(\\\"@1TsTransferAdmin\\\")\", \"update\": \"ContractAccess(\\\"@1TsTransferReject\\\",\\\"@1TsTransferSeller\\\",\\\"@1TsTransferManager\\\")\", \"new_column\": \"ContractConditions(\\\"@1AdminCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Name": "ts_wallets",
            "Columns": "[\r\n    {\r\n        \"conditions\":\"ContractAccess(\\\"@1TsBuyerAction\\\",\\\"@1TsConsensusAction\\\")\",\r\n        \"name\":\"rejected_at\",\r\n        \"type\":\"number\"\r\n    },\r\n    {\r\n        \"conditions\":\"ContractAccess(\\\"@1TsBuyerAction\\\")\",\r\n        \"name\":\"key_id_buyer\",\r\n        \"type\":\"number\"\r\n    },\r\n    {\r\n        \"conditions\":\"ContractAccess(\\\"@1TsConsensusAction\\\")\",\r\n        \"name\":\"key_id_signer\",\r\n        \"type\":\"number\"\r\n    },\r\n    {\r\n        \"conditions\":\"false\",\r\n        \"name\":\"btc\",\r\n        \"type\":\"money\"\r\n    },\r\n    {\r\n        \"conditions\":\"false\",\r\n        \"name\":\"eth\",\r\n        \"type\":\"money\"\r\n    },\r\n    {\r\n        \"conditions\":\"ContractAccess(\\\"@1TsBuyerAction\\\")\",\r\n        \"name\":\"signed_at\",\r\n        \"type\":\"number\"\r\n    },\r\n    {\r\n        \"conditions\":\"false\",\r\n        \"name\":\"created_at\",\r\n        \"type\":\"number\"\r\n    }\r\n]",
            "Permissions": "{\"insert\": \"ContractAccess(\\\"@1TsKeyApprove\\\")\", \"update\": \"ContractAccess(\\\"@1TsBuyerAction\\\",\\\"@1TsConsensusAction\\\")\", \"new_column\": \"ContractConditions(\\\"@1AdminCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Name": "ts_currency_type",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "@1btc,@1eth,@1euro",
            "Type": "app_params"
        },
        {
            "Name": "ts_statuses",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "@1waiting_manager_approved,@1waiting_seller_transfer,@1finished,@1rejected",
            "Type": "app_params"
        },
        {
            "Name": "ts_statuses_classes",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "text-muted,text-info,text-success,text-warning",
            "Type": "app_params"
        },
        {
            "Name": "default_page",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "DBFind(@1ts_wallets).Where({key_id_buyer:#key_id#, rejected_at:0, signed_at:0}).Vars(unconfirmed_wallet)\r\nSetVar(founder,EcosysParam(founder_account))\r\nDiv(content-wrapper){\r\n    If(#ecosystem_id#==0){\r\n        SetTitle(\"\")\r\n    }.ElseIf(#unconfirmed_wallet_id#>0){\r\n        Div(panel panel-primary){\r\n            Div(list-group-item){\r\n                Div(){\r\n                    $@1ts_hello_user_description$\r\n                }\r\n                Div(){\r\n                    $@1read_please$ LinkPage(Body: $@1ts_buyer_contract$, Page: ts_buyer_contract)\r\n                }\r\n            }\r\n        }\r\n    }.ElseIf(#founder#==#key_id#){\r\n        Div(panel panel-primary){\r\n            Div(list-group-item text-center){\r\n                P(Class: h3 m0 text-bold, Body: $@1default_main$)\r\n            }\r\n            Div(list-group-item){\r\n                Span(Class: h3, Body: $@1default1$)\r\n                Span(Class: h3 text-primary, Body: \" https://github.com/GenesisKernel/apps \")\r\n                Span(Class: h3, Body: $@1default2$)\r\n                Span(Class: h3 text-primary, Body: \" https://genesiskernel.readthedocs.io\")\r\n            }\r\n            Div(panel-footer text-right clearfix){\r\n                Div(pull-left){\r\n                    Button(Body: $@1ecosystem_parameters$, Class: btn btn-default, Page: @1params_list)\r\n                }.Style(margin-right: 20px;)\r\n                Div(pull-left){\r\n                    Button(Body: $@1dashboard$, Class: btn btn-default, Page: @1admin_index)\r\n                }\r\n                Button(Body: $@1import$, Class: btn btn-primary, Page: @1import_upload)\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_buyer_congratulation",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\r\nDBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->wallet_id\").Vars(note)\r\n\r\nSetVar(this_page, ts_buyer_congratulation)\r\nDiv(content-wrapper){\r\n    Div(row mt-sm){\r\n        Div(col-lg-10 col-lg-offset-1){\r\n            Form(panel panel-primary){\r\n                DBFind(@1ts_wallets).Where({key_id_signer:{$neq:0}, rejected_at:0}).Vars(wallet)\r\n                If(#wallet_id#>0){\r\n                    Div(panel-body){\r\n                        текст, мол, спасибо, теперь вы можете перевести сумму любым способом, указанным в договоре\r\n                    }\r\n                    Div(panel-footer text-center){\r\n                        Button(Body: $@1readed$, Class: btn btn-primary, Page: default_page, Contract: NotificationsClose, Params: \"notific_id=#notific_id#\")\r\n                    }\r\n                }.Else{\r\n                    Div(panel-body){\r\n                        wallet не найден\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_buyer_contract",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\r\nDBFind(@1ts_wallets).Where({key_id_buyer:#key_id#, key_id_signer:0, rejected_at:0}).Vars(unconfirmed_wallet)\r\n\r\nSetTitle(\"Страница с договором на которую покупатель переходит при заходе\")\r\nDiv(content-wrapper){\r\n    Div(row mt-sm){\r\n        Div(col-lg-10 col-lg-offset-1){\r\n            Form(panel panel-primary){\r\n                If(#unconfirmed_wallet_id#>0){\r\n                    Div(panel-body){\r\n                        текст договора будет чуть позже the text of the Treaty will be a little later текст договора будет чуть позже the text of the Treaty will be a little laterтекст договора будет чуть позже the text of the Treaty will be a little laterтекст договора будет чуть позже the text of the Treaty will be a little laterтекст договора будет чуть позже the text of the Treaty will be a little laterтекст договора будет чуть позже the text of the Treaty will be a little laterтекст договора будет чуть позже the text of the Treaty will be a little later\r\n                    }\r\n                    Div(panel-footer){\r\n                        Button(Body: $@1reject$, Class: btn btn-danger, Page: default_page, Contract: TsBuyerAction, Params: \"Action=reject\")\r\n                        Button(Body: $@1accept$, Class: btn btn-primary pull-right, Page: default_page, Contract: TsBuyerAction, Params: \"Action=accept\")\r\n                    }\r\n                }.Else{\r\n                    Div(panel-body){\r\n                        вы уже заключили договор с Apla\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_consensus_contract",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\r\nSetVar(isStartProcessing,0)\r\nIf(#notific_id#>0){\r\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->wallet_id,date_start_processing,notification->type,processing_info->member_id\").Vars(note)\r\n    If(#note_date_start_processing#!=\"\"){\r\n        SetVar(isStartProcessing,1)\r\n    }\r\n}\r\n\r\nSetVar(this_page, ts_consensus_contract)\r\nSetTitle(\"Страница подписи представителем роли Apla Consensus\")\r\nDiv(content-wrapper){\r\n    Div(row mt-sm){\r\n        Div(col-lg-10 col-lg-offset-1){\r\n            Form(panel panel-primary){\r\n                DBFind(@1ts_wallets).Where({id:#note_page_params_wallet_id#, rejected_at:0}).Vars(wallet)\r\n                If(#wallet_id#>0){\r\n                    Div(panel-body){\r\n                        Div(){\r\n                            покупатель: Address(#wallet_key_id_buyer#)\r\n                        }\r\n                        Div(){\r\n                            дата подписания договора покупателем: DateTime(#wallet_signed_at#, \"YYYY-MM-DD HH:MI:SS\")\r\n                        }\r\n                    }\r\n                    Div(panel-footer){\r\n                        If(And(#note_processing_info_member_id#==#key_id#,#isStartProcessing#==1)){\r\n                            Button(Body: $@1reject$, Class: btn btn-default, Page: default_page, Contract: TsConsensusAction, Params: \"Action=reject,WalletId=#note_page_params_wallet_id#,NotificId=#notific_id#\")\r\n                            Button(Body: $@1accept$, Class: btn btn-primary pull-right, Page: default_page, Contract: TsConsensusAction, Params: \"Action=accept,WalletId=#note_page_params_wallet_id#,NotificId=#notific_id#\")\r\n                        }.ElseIf(#isStartProcessing#==1){\r\n                            Div(text-muted text-center){\r\n                                process begin another manager\r\n                            }\r\n                        }.ElseIf(#isStartProcessing#==0){\r\n                            Div(text-center){\r\n                                Button(Body: $@1processing$, Class: btn btn-primary, Page: #this_page#, PageParams: \"notific_id=#notific_id#\", Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\")\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                }.Else{\r\n                    Div(panel-body){\r\n                        wallet не найден\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_key_approve",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "Form(){\r\n    Div(form-group){\r\n        Div(row){\r\n            Div(col-md-10 mt-sm col-md-offset-2){\r\n                Span(Body: LangRes(@1ts_public_key_input_des), Class: text-muted)\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(col-md-2 mt-sm text-right){\r\n                Label(For: public_key){\r\n                    LangRes(@1pub_key)\r\n                }\r\n            }\r\n            Div(col-md-10 mt-sm){\r\n                Input(Name: public_key, Type: textarea)\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(col-md-2 mt-lg text-right){\r\n                Label(For: token_buyer){\r\n                    LangRes(@1public_key_type)\r\n                }\r\n            }\r\n            Div(col-md-10 mt-sm){\r\n                Data(key_radio, \"value,description\"){\r\n                    investor,$@1ts_investor_key$\r\n                    user,$@1ts_user_key$\r\n                }\r\n                RadioGroup(Name: key_type, Source: key_radio, NameColumn: description, ValueColumn: value)\r\n            }\r\n        }\r\n    }\r\n    Div(row mt){\r\n        Div(col-md-12){\r\n            Input(Name: current_role_id, Type: hidden, Value: #role_id#)\r\n            Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1ts_wallets)\r\n            Button(Body: LangRes(@1add), Class: btn btn-primary pull-right, Page: @1ts_wallets, Contract: @1TsKeyApprove).Alert(Text: \"$@1want_add_investor$\", ConfirmButton: \"$@1yes$\", CancelButton: \"$@1no$\", Icon: icon-question)\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_notification",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\r\nIf(#notific_id#>0){\r\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"notification->header,notification->body,id\").Vars(note)\r\n}\r\n\r\nDiv(content-wrapper){\r\n    Div(row mt-sm){\r\n        Div(col-lg-10 col-lg-offset-1){\r\n            Form(panel panel-primary){\r\n                DBFind(@1ts_wallets).Where({key_id_signer:{$neq:0}, rejected_at:0}).Vars(wallet)\r\n                If(#note_id#>0){\r\n                    Div(panel-body){\r\n                        Div(){\r\n                            #note_notification_header#\r\n                        }\r\n                        Div(){\r\n                            #note_notification_body#\r\n                        }\r\n                    }\r\n                    Div(panel-footer text-center){\r\n                        Button(Body: $@1readed$, Class: btn btn-primary, Page: @1default_page, Contract: NotificationsClose, Params: \"notific_id=#notific_id#\")\r\n                    }\r\n                }.Else{\r\n                    Div(panel-body){\r\n                        Оповещение не найдено\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_sales",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\r\nSetVar(this_page, @1ts_sales)\r\nSetVar(admin_role_id, EcosysParam(Name:role_sale_admin))\r\nSetVar(manager_role_id, EcosysParam(Name:role_sale_manager))\r\nSetVar(seller_role_id, EcosysParam(Name:role_sale_seller))\r\n\r\nSetVar(STATUS_MANAGER,1).(STATUS_SELLER,2)\r\n\r\nDiv(content-wrapper){\r\n    SetTitle($@1ts_sales$)\r\n    If(And(#admin_role_id#>0,#role_id#==#admin_role_id#)){\r\n        AddToolButton(Title:$@1ts_add_transfer$, Page: @1ts_transfer_admin, Icon: icon-wallet).Popup(Header: $@1ts_add_transfer$, Width: \"50\")\r\n    }\r\n\r\n    If(GetVar(Search)!=\"\"){\r\n        SetVar(Where, {$or:[{\"key_id_buyer\":#Search#},{\"key_id_sale_apl_manager\":#Search#}, {\"key_id_sale_apl_admin\":#Search#}, {\"key_id_seller\":#Search#}]})\r\n    }.Else{\r\n        SetVar(Where, {id:{$gt:0}}).(Search,)\r\n    }\r\n\r\n    Form(panel panel-primary){\r\n        Div(panel-body){\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    Form(input-group){\r\n                        Div(input-group-addon){\r\n                            LangRes(@1key_id)\r\n                        }\r\n                        Input(Name: Search, Value: #Search#)\r\n                        Div(input-group-btn){\r\n                            If(GetVar(Search)!=\"\"){\r\n                                Button(Class: btn btn-default fa fa-close, Page: #this_page#)\r\n                            }\r\n                            Button(Class: btn btn-default fa fa-search, Page: #this_page#, PageParams: \"Search=Val(Search),type=1\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            DBFind(@1ts_sales, sales).Where(#Where#).Order({id:-1}).Count(sales_count).Custom(_btat){\r\n                Span(Class: text-muted, Body: DateTime(#buyer_transferred_at#, Format: YYYY-MM-DD HH:MI:SS))\r\n            }.Custom(_cat){\r\n                Span(Class: text-muted, Body: DateTime(#created_at#, Format: YYYY-MM-DD HH:MI:SS))\r\n            }.Custom(_amount){\r\n                Div(text-right){\r\n                    Span(Class: text-bold, Body: #amount#).Style(margin-right:5px;)\r\n                    Span(Class: text-bold, Body: AppParam(App:#application_id#, Name:ts_currency_type, Ecosystem: #ecosystem_id#, Index: #currency_type#))\r\n                }\r\n                Div(text-right){\r\n                    Span(Class: text-bold, Body: Money(#amount_apl#)).Style(margin-right:5px;)\r\n                    Span(Class: text-bold, Body: APL)\r\n                }\r\n            }.Custom(_info){\r\n                Button(Class: btn-xs btn-link, Page: @1ts_transfer_view, PageParams: \"Id=#id#\"){\r\n                    Span(Class: text-bold h5, Body: LangRes(@1information))\r\n                }.Popup(Header: $@1information$, Width: 35)\r\n            }.Custom(_status){\r\n                SetVar(status_class, AppParam(App:#application_id#, Name:ts_statuses_classes, Index:#status#, Ecosystem: #ecosystem_id#))\r\n                Div(#status_class#){\r\n                    AppParam(App:#application_id#, Name:ts_statuses, Index:#status#, Ecosystem: #ecosystem_id#)\r\n                }\r\n            }.Custom(_action){\r\n                If(And(#status#==#STATUS_MANAGER#,#manager_role_id#>0,#role_id#==#manager_role_id#)){\r\n                    Button(Class: fa fa-play btn btn-primary, Page: @1ts_transfer_manager, PageParams: \"SaleId=#id#\")\r\n                }\r\n                If(And(#status#==#STATUS_SELLER#,#seller_role_id#>0,#role_id#==#seller_role_id#)){\r\n                    Button(Class: fa fa-play btn btn-primary, Page: @1ts_transfer_seller, PageParams: \"SaleId=#id#\")\r\n                }\r\n            }.Custom(_buyer){\r\n                LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#key_id_buyer#\"){\r\n                    Address(#key_id_buyer#)\r\n                }\r\n                Div(Class:text-muted m0 h6, Body:#key_id_buyer#)\r\n            }\r\n\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    If(#sales_count#>0){\r\n                        Div(table-responsive){\r\n                            Table(sales,\"$@1id$=id,$@1key_id_investor$=_buyer,$@1information$=_info,$@1investor_funds_transfer_date$=_btat,$@1created_at$=_cat,$@1status$=_status,=_action,=_amount\")\r\n                        }\r\n                    }.Else{\r\n                        Div(h4 text-muted text-center){\r\n                            $@1sales$ $@1not_founded$\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_settings",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, ts_settings).(role_admin,0).(role_manager,0).(role_seller,0)\r\nSetVar(role_admin, EcosysParam(Name:role_sale_admin))\r\nSetVar(role_manager, EcosysParam(Name:role_sale_manager))\r\nSetVar(role_seller, EcosysParam(Name:role_sale_seller))\r\nSetVar(role_snapswap, EcosysParam(Name:role_snapswap))\r\n\r\nDBFind(@1roles,src_roles).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"role_name,id\").Limit(100)\r\n\r\nSetVar(row,\"row mt-sm\").(col_left,\"col-sm-4 text-right mt-sm\").(col_right,\"col-sm-8 text-left\")\r\nSetTitle($@1ts_settings$)\r\nDiv(content-wrapper){\r\n    Div(row mt-sm){\r\n        Div(col-lg-8 col-lg-offset-2){\r\n            Form(panel panel-primary){\r\n                Div(panel-body){\r\n                    Div(#row#){\r\n                        Div(col-sm-12 text-center text-muted){\r\n                            $@1ts_settings_description$\r\n                        }\r\n                    }\r\n                    Div(#row#){\r\n                        Div(#col_left#){\r\n                            $@1role_sale_admin$\r\n                        }\r\n                        Div(#col_right#){\r\n                            Select(Name:RoleAdmin, Source:src_roles, NameColumn: role_name, ValueColumn: id, Value:#role_admin#)\r\n                        }\r\n                    }\r\n                    Div(#row#){\r\n                        Div(#col_left#){\r\n                            $@1role_sale_manager$\r\n                        }\r\n                        Div(#col_right#){\r\n                            Select(Name:RoleManager, Source:src_roles, NameColumn: role_name, ValueColumn: id, Value:#role_manager#)\r\n                        }\r\n                    }\r\n                    Div(#row#){\r\n                        Div(#col_left#){\r\n                            $@1role_sale_seller$\r\n                        }\r\n                        Div(#col_right#){\r\n                            Select(Name:RoleSeller, Source:src_roles, NameColumn: role_name, ValueColumn: id, Value:#role_seller#)\r\n                        }\r\n                    }\r\n                    Div(#row#){\r\n                        Div(#col_left#){\r\n                            $@1role_snapswap$\r\n                        }\r\n                        Div(#col_right#){\r\n                            Select(Name:RoleSnapswap, Source:src_roles, NameColumn: role_name, ValueColumn: id, Value:#role_snapswap#)\r\n                        }\r\n                    }\r\n                }\r\n                Div(panel-footer text-center){\r\n                    Button(Body: $@1apply_settings$, Class: btn btn-primary, Page: #this_page#, Contract: TsSettings)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "admin_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_transfer_admin",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\r\nSetVar(this_page, @1ts_transfer_admin).(back_page, @1ts_sales)\r\nSetVar(row,\"row mt-sm\").(col_left,\"col-sm-4 mt-sm text-right\").(col_right,\"col-sm-8 text-left\")\r\nAppParam(App:#application_id#, Name:ts_currency_type, Ecosystem: #ecosystem_id#, Source:currency_type)\r\n\r\nDBFind(@1ts_wallets, wallets).Where({key_id_buyer:{$neq:0}, key_id_signer:{$neq:0}, rejected_at:0}).Count(wallets_count).Custom(_name){\r\n    Address(#key_id_buyer#) (#key_id_buyer#)\r\n}\r\nForm(){\r\n    Div(#row#){\r\n        Div(#col_left#){\r\n            $@1wallet$\r\n        }\r\n        Div(#col_right#){\r\n            Input(Name: WalletStr, Placeholder: \"xxxx-xxxx-xxxx-xxxx-xxxx\")\r\n        }\r\n    }\r\n    Div(#row#){\r\n        Div(#col_left#){\r\n            $@1investment_amount$\r\n        }\r\n        Div(#col_right#){\r\n            Div(row){\r\n                Div(col-sm-8){\r\n                    Input(Name:Amount, Type:number)\r\n                }\r\n                Div(col-sm-4){\r\n                    Select(Name:CurrencyType, Source:currency_type, NameColumn: name, ValueColumn: id)\r\n                }\r\n            }\r\n        }\r\n    }\r\n    Div(#row#){\r\n        Div(#col_left#){\r\n            $@1amount_apl$\r\n        }\r\n        Div(#col_right#){\r\n            Input(Name:AmountApl, Type:number)\r\n        }\r\n    }\r\n    Div(#row#){\r\n        Div(#col_left#){\r\n            $@1investor_funds_transfer_date$\r\n        }\r\n        Div(#col_right#){\r\n            Div(row){\r\n                Div(col-sm-6){\r\n                    Input(Name:TransferredDate, Type:date)\r\n                }\r\n                Div(col-sm-6){\r\n                    Input(Name:TransferredTime, Type:time)\r\n                }\r\n            }\r\n        }\r\n    }\r\n    Div(row mt){\r\n        Div(col-md-12 text-right){\r\n            Button(Body: LangRes(@1back), Class: btn btn-default pull-left, Page: #back_page#)\r\n            Button(Body: $@1send_to_check$, Class: btn btn-primary, Page: #back_page#, Contract: TsTransferAdmin).Alert(Text: \"$@1want_add_investor$\", ConfirmButton: \"$@1yes$\", CancelButton: \"$@1no$\", Icon: question)\r\n        }\r\n    }\r\n}\r\n",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_transfer_manager",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\r\n\r\nSetVar(this_page, ts_transfer_manager)\r\nSetVar(role_param, role_sale_manager)\r\nSetVar(row,\"row mt-sm\").(col_left,\"col-sm-4 text-right\").(col_right,\"col-sm-8 text-left\")\r\nSetVar(needed_role_id, EcosysParam(Name:#role_param#))\r\n\r\nSetVar(isStartProcessing,0)\r\nIf(#notific_id#>0){\r\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->sale_id,date_start_processing,notification->type,processing_info->member_id\").Vars(note)\r\n    If(#note_date_start_processing#!=\"\"){\r\n        SetVar(isStartProcessing,1)\r\n    }\r\n}.ElseIf(GetVar(SaleId)!=\"\"){\r\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, \"page_params->sale_id\":#SaleId#, closed:0}).Columns(\"page_params->sale_id,date_start_processing,notification->type,processing_info->member_id,id\").Vars(note)\r\n    SetVar(notific_id,#note_id#)\r\n    If(#note_date_start_processing#!=\"\"){\r\n        SetVar(isStartProcessing,1)\r\n    }\r\n}\r\nSetVar(sale_id,0)\r\nIf(#note_page_params_sale_id#>0){\r\n    DBFind(@1ts_sales).Where({id:#note_page_params_sale_id#}).Vars(sale)\r\n}\r\nSetTitle($@1ts_transfer_manager$)\r\nDiv(content-wrapper){\r\n    Div(row mt-sm){\r\n        Div(col-lg-10 col-lg-offset-1){\r\n            Form(panel panel-primary){\r\n                If(And(#needed_role_id#>0,#role_id#==#needed_role_id#,#sale_id#>0)){\r\n                    Div(panel-body){\r\n                        Div(#row#){\r\n                            Div(#col_left#){\r\n                                $@1key_id_investor$\r\n                            }\r\n                            Div(#col_right#){\r\n                                LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#sale_key_id_buyer#\"){\r\n                                    Address(#sale_key_id_buyer#)\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(#row#){\r\n                            Div(#col_left#){\r\n                                $@1amount$\r\n                            }\r\n                            Div(#col_right#){\r\n                                #sale_amount# AppParam(App:#application_id#, Name:ts_currency_type, Ecosystem: #ecosystem_id#, Index: #sale_currency_type#)\r\n                            }\r\n                        }\r\n                        Div(#row#){\r\n                            Div(#col_left#){\r\n                                $@1tokens$\r\n                            }\r\n                            Div(#col_right#){\r\n                                Money(#sale_amount_apl#) APL\r\n                            }\r\n                        }\r\n                        Div(#row# text-muted){\r\n                            Div(#col_left#){\r\n                                $@1investor_funds_transfer_date$\r\n                            }\r\n                            Div(#col_right#){\r\n                                DateTime(#sale_buyer_transferred_at#, Format: YYYY-MM-DD HH:MI:SS)\r\n                            }\r\n                        }\r\n                        Div(#row# text-muted){\r\n                            Div(#col_left#){\r\n                                $@1created_at$\r\n                            }\r\n                            Div(#col_right#){\r\n                                DateTime(#sale_created_at#, Format: YYYY-MM-DD HH:MI:SS)\r\n                            }\r\n                        }\r\n                        Div(#row# text-muted){\r\n                            Div(#col_left#){\r\n                                $@1created_by$\r\n                            }\r\n                            Div(#col_right#){\r\n                                Address(#sale_key_id_sale_apl_admin#)\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(panel-footer){\r\n                        If(And(#note_processing_info_member_id#==#key_id#,#isStartProcessing#==1)){\r\n                            Button(Body: $@1reject$, Class: btn btn-danger, Page: ts_transfer_reject, PageParams: \"RoleParam=#role_param#,notific_id=#notific_id#,back_page=#this_page#\").Popup(50,\"Rejected comment\")\r\n                            Button(Body: $@1accept$, Class: btn btn-primary pull-right, Page: ts_sales, Contract: TsTransferManager, Params: \"SaleId=#sale_id#,NotificId=#notific_id#\")\r\n                        }.ElseIf(#isStartProcessing#==1){\r\n                            Div(text-muted text-center){\r\n                                process begin another manager\r\n                            }\r\n                        }.ElseIf(#isStartProcessing#==0){\r\n                            Div(text-center){\r\n                                Button(Body: $@1processing$, Class: btn btn-primary, Page: #this_page#, PageParams: \"notific_id=#notific_id#\", Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\")\r\n                            }\r\n                        }\r\n                    }\r\n                }.Else{\r\n                    Div(panel-body text-center){\r\n                        If(#needed_role_id#>0){\r\n                            If(#needed_role_id#!=#role_id#){\r\n                                DBFind(@1parameters).Where({ecosystem:#ecosystem_id#, name:#role_param#}).Vars(param)\r\n                                Div(h4){\r\n                                    this page only for role from parameter LinkPage(Page: @1params_edit, PageParams: \"id=#param_id#,back_page=#this_page#\", Body:#role_param#)\r\n                                }\r\n                            }\r\n                        }.Else{\r\n                            Div(h4){\r\n                                #role_param# not setted\r\n                            }\r\n                            Div(h4){\r\n                                LinkPage(Body:$@1ts_settings$, Page:ts_settings)\r\n                            }\r\n                        }\r\n\r\n                        If(#note_id_page_params_sale_id#>0){\r\n                            If(#sale_id#>0){}.Else{\r\n                                sale not found\r\n                            }\r\n                        }.Else{\r\n                            notification not found\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_transfer_reject",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(needed_role_id,0)\r\nIf(GetVar(RoleParam)!=\"\"){\r\n    SetVar(needed_role_id, EcosysParam(Name:#RoleParam#))\r\n}\r\nIf(GetVar(notific_id)!=\"\"){\r\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->sale_id\").Vars(note)\r\n}\r\nSetVar(sale_id,0)\r\nIf(#note_page_params_sale_id#>0){\r\n    DBFind(@1ts_sales).Where({id:#note_page_params_sale_id#}).Vars(sale)\r\n}\r\n\r\nForm(){\r\n    If(And(#needed_role_id#>0,#role_id#==#needed_role_id#,#sale_id#>0)){\r\n        Div(mb){\r\n            Input(Name:Comment, Type:textarea)\r\n        }\r\n        Div(){\r\n            Button(Body: $@1back$, Class: btn btn-default, Page: #back_page#, PageParams: \"notific_id=#notific_id#\")\r\n            Button(Body: $@1send$, Class: btn btn-primary pull-right, Page: default_page, Contract: TsTransferReject, Params: \"RoleParam=#RoleParam#,NotificId=#notific_id#\")\r\n        }\r\n    }.Else{\r\n        Div(text-center text-muted){\r\n            If(And(#needed_role_id#>0,#role_id#!=#needed_role_id#)){\r\n                Div(){\r\n                    for added comment you must be logined as role id #needed_role_id#\r\n                }\r\n            }\r\n            If(#sale_id#==0){\r\n                Div(){\r\n                    sale not found\r\n                }\r\n            }\r\n        }\r\n        Div(){\r\n            Button(Body: $@1back$, Class: btn btn-default, Page: #back_page#, PageParams: \"notific_id=#notific_id#\")\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_transfer_seller",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\r\n\r\nSetVar(this_page, ts_transfer_seller)\r\nSetVar(role_param, role_sale_seller)\r\nSetVar(row,\"row mt-sm\").(col_left,\"col-sm-4 text-right\").(col_right,\"col-sm-8 text-left\")\r\nSetVar(needed_role_id, EcosysParam(Name:#role_param#))\r\n\r\nAppParam(App:#application_id#, Name:ts_currency_type, Ecosystem: #ecosystem_id#, Source:currency_type)\r\nSetVar(isStartProcessing,0)\r\nIf(#notific_id#>0){\r\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->sale_id,date_start_processing,notification->type,processing_info->member_id\").Vars(note)\r\n    If(#note_date_start_processing#!=\"\"){\r\n        SetVar(isStartProcessing,1)\r\n    }\r\n}.ElseIf(GetVar(SaleId)!=\"\"){\r\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, \"page_params->sale_id\":#SaleId#, closed:0}).Columns(\"page_params->sale_id,date_start_processing,notification->type,processing_info->member_id\").Vars(note)\r\n    SetVar(notific_id,#note_id#)\r\n    If(#note_date_start_processing#!=\"\"){\r\n        SetVar(isStartProcessing,1)\r\n    }\r\n}\r\nSetVar(sale_id,0)\r\nIf(#note_page_params_sale_id#>0){\r\n    DBFind(@1ts_sales).Where({id:#note_page_params_sale_id#}).Vars(sale)\r\n}\r\n\r\nSetTitle($@1ts_transfer_seller$)\r\nDiv(content-wrapper){\r\n    Div(row mt-sm){\r\n        Div(col-lg-10 col-lg-offset-1){\r\n            Form(panel panel-primary){\r\n                DBFind(@1ts_wallets, wallets).Where({key_id_buyer:{$neq:0}, key_id_signer:{$neq:0}, rejected_at:0}).Vars(wallet).Custom(_name){\r\n                    Address(#key_id_buyer#)\r\n                }\r\n                If(And(#needed_role_id#>0,#role_id#==#needed_role_id#,#sale_id#>0)){\r\n                    Div(panel-body){\r\n                        Div(#row#){\r\n                            Div(#col_left#){\r\n                                $@1key_id_investor$\r\n                            }\r\n                            Div(#col_right#){\r\n                                LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#sale_key_id_buyer#\"){\r\n                                    Address(#sale_key_id_buyer#)\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(#row#){\r\n                            Div(#col_left#){\r\n                                $@1amount$\r\n                            }\r\n                            Div(#col_right#){\r\n                                #sale_amount# AppParam(App:#application_id#, Name:ts_currency_type, Ecosystem: #ecosystem_id#, Index: #sale_currency_type#)\r\n                            }\r\n                        }\r\n                        Div(#row#){\r\n                            Div(#col_left#){\r\n                                $@1tokens$\r\n                            }\r\n                            Div(#col_right#){\r\n                                Money(#sale_amount_apl#) APL\r\n                            }\r\n                        }\r\n                        Div(#row# text-muted){\r\n                            Div(#col_left#){\r\n                                $@1investor_funds_transfer_date$\r\n                            }\r\n                            Div(#col_right#){\r\n                                DateTime(#sale_buyer_transferred_at#, Format: YYYY-MM-DD HH:MI:SS)\r\n                            }\r\n                        }\r\n                        Div(#row# text-muted){\r\n                            Div(#col_left#){\r\n                                $@1created_at$\r\n                            }\r\n                            Div(#col_right#){\r\n                                DateTime(#sale_created_at#, Format: YYYY-MM-DD HH:MI:SS)\r\n                            }\r\n                        }\r\n                        Div(#row# text-muted){\r\n                            Div(#col_left#){\r\n                                $@1created_by$\r\n                            }\r\n                            Div(#col_right#){\r\n                                Address(#sale_key_id_sale_apl_admin#)\r\n                            }\r\n                        }\r\n                        Div(#row# text-muted){\r\n                            Div(#col_left#){\r\n                                $@1checked_by$\r\n                            }\r\n                            Div(#col_right#){\r\n                                Address(#sale_key_id_sale_apl_manager#)\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(panel-footer){\r\n                        If(And(#note_processing_info_member_id#==#key_id#,#isStartProcessing#==1)){\r\n                            Button(Body: $@1reject$, Class: btn btn-danger, Page: ts_transfer_reject, PageParams: \"RoleParam=#role_param#,notific_id=#notific_id#,back_page=#this_page#\").Popup(50,\"Rejected comment\")\r\n                            Button(Body: $@1accept$, Class: btn btn-primary pull-right, Page: ts_sales, Contract: TsTransferSeller, Params: \"SaleId=#sale_id#,NotificId=#notific_id#\")\r\n                        }.ElseIf(#isStartProcessing#==1){\r\n                            Div(text-muted text-center){\r\n                                process begin another seller\r\n                            }\r\n                        }.ElseIf(#isStartProcessing#==0){\r\n                            Div(text-center){\r\n                                Button(Body: $@1processing$, Class: btn btn-primary, Page: #this_page#, PageParams: \"notific_id=#notific_id#\", Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\")\r\n                            }\r\n                        }\r\n                    }\r\n                }.Else{\r\n                    Div(panel-body){\r\n                        If(#needed_role_id#>0){\r\n                            If(#needed_role_id#!=#role_id#){\r\n                                DBFind(@1parameters).Where({ecosystem:#ecosystem_id#, name:#role_param#}).Vars(param)\r\n                                Div(h4){\r\n                                    this page only for role from parameter LinkPage(Page: @1params_edit, PageParams: \"id=#param_id#,back_page=#this_page#\", Body:#role_param#)\r\n                                }\r\n                            }\r\n                        }.Else{\r\n                            Div(h4){\r\n                                #role_param# not setted\r\n                            }\r\n                            Div(h4){\r\n                                LinkPage(Body:$@1ts_settings$, Page:ts_settings)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_transfer_view",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:#ecosystem_id#, name:\"Tokens sale\"}).Columns(\"id\").Vars(application)\r\nSetVar(row,\"row mt-sm\").(col_left,\"col-sm-6 text-right text-bold\").(col-right,\"col-sm-6 text-left\")\r\nIf(GetVar(back_page)==\"\"){\r\n    SetVar(back_page, @1ts_sales)\r\n}\r\nIf(GetVar(Id)){\r\n    DBFind(@1ts_sales).Where({id:#Id#}).Vars(sale)\r\n}\r\n\r\nIf(#sale_id#>0){\r\n    Div(#row#){\r\n        Div(#col_left#){\r\n            $@1key_id_investor$\r\n        }\r\n        Div(#col_right#){\r\n            LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#sale_key_id_buyer#\"){\r\n                Address(#sale_key_id_buyer#)\r\n            }\r\n        }\r\n    }\r\n    Div(#row#){\r\n        Div(#col_left#){\r\n            $@1tokens$\r\n        }\r\n        Div(#col_right#){\r\n            Money(#sale_amount_apl#) APL\r\n        }\r\n    }\r\n    Div(#row#){\r\n        Div(#col_left#){\r\n            $@1amount$\r\n        }\r\n        Div(#col_right#){\r\n            Span(#sale_amount#).Style(margin-right:5px;)\r\n            Span(AppParam(App:#application_id#, Name:ts_currency_type, Ecosystem: #ecosystem_id#, Index: #sale_currency_type#))\r\n        }\r\n    }\r\n    Div(#row#){\r\n        Div(#col_left#){\r\n            $@1key_id_sale_apl_admin$\r\n        }\r\n        Div(#col_right#){\r\n            Address(#sale_key_id_sale_apl_admin#) (#sale_key_id_sale_apl_admin#)\r\n        }\r\n    }\r\n    If(#sale_key_id_sale_apl_manager#!=0){\r\n        Div(#row#){\r\n            Div(#col_left#){\r\n                $@1key_id_sale_apl_manager$\r\n            }\r\n            Div(#col_right#){\r\n                Address(#sale_key_id_sale_apl_manager#) (#sale_key_id_sale_apl_manager#)\r\n            }\r\n        }\r\n        If(#sale_manager_rejected_at#>0){\r\n            Div(#row#){\r\n                Div(#col_left#){\r\n                    $@1manager_rejected_at$\r\n                }\r\n                Div(#col_right#){\r\n                    DateTime(#sale_manager_rejected_at#, Format: YYYY-MM-DD HH:MI:SS)\r\n                }\r\n            }\r\n\r\n            Div(#row#){\r\n                Div(#col_left#){\r\n                    $@1manager_reject_comment$\r\n                }\r\n                Div(#col_right#){\r\n                    #sale_manager_reject_comment#\r\n                }\r\n            }\r\n        }\r\n    }\r\n    If(#sale_key_id_seller#!=0){\r\n        Div(#row#){\r\n            Div(#col_left#){\r\n                $@1key_id_seller$\r\n            }\r\n            Div(#col_right#){\r\n                Address(#sale_key_id_seller#) (#sale_key_id_seller#)\r\n            }\r\n        }\r\n        If(#sale_seller_rejected_at#>0){\r\n            Div(#row#){\r\n                Div(#col_left#){\r\n                    $@1seller_rejected_at$\r\n                }\r\n                Div(#col_right#){\r\n                    DateTime(#sale_seller_rejected_at#, Format: YYYY-MM-DD HH:MI:SS)\r\n                }\r\n            }\r\n\r\n            Div(#row#){\r\n                Div(#col_left#){\r\n                    $@1seller_reject_comment$\r\n                }\r\n                Div(#col_right#){\r\n                    #sale_seller_reject_comment#\r\n                }\r\n            }\r\n        }.Else{\r\n            Div(#row#){\r\n                Div(#col_left#){\r\n                    $@1seller_transferred_at$\r\n                }\r\n                Div(#col_right#){\r\n                    DateTime(#sale_seller_transferred_at#, Format: YYYY-MM-DD HH:MI:SS)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\nDiv(row mt){\r\n    Div(col-md-12){\r\n        Button(Body: LangRes(@1back), Class: btn btn-default, Page: #back_page#)\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ts_wallets",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1ts_wallets)\r\nSetVar(row,\"row mt-sm\").(col_left,\"col-sm-4 mt-sm text-right\").(col_right,\"col-sm-8 text-left\")\r\nSetVar(snapswap_role_id, EcosysParam(Name:role_snapswap))\r\n\r\nDiv(content-wrapper){\r\n    SetTitle($@1ts_wallets$)\r\n    If(And(#snapswap_role_id#>0,#role_id#==#snapswap_role_id#)){\r\n        AddToolButton(Title:$@1ts_add_public_key$, Page: @1ts_key_approve, Icon: icon-wallet).Popup(Header: $@1ts_add_public_key$, Width: \"50\")\r\n    }\r\n\r\n    SetVar(Where, {id:{$gt:0}})\r\n    If(GetVar(Search)!=\"\"){\r\n        SetVar(Where, {$or:[{\"key_id_buyer\":#Search#},{\"key_id_signer\":#Search#}]})\r\n    }.Else{\r\n        SetVar(Search,)\r\n    }\r\n    \r\n    Form(panel panel-primary){\r\n        Div(panel-body){\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    Form(input-group){\r\n                        Div(input-group-addon){\r\n                            LangRes(@1key_id)\r\n                        }\r\n                        Input(Name: Search, Value: #Search#)\r\n                        Div(input-group-btn){\r\n                            If(GetVar(Search)!=\"\"){\r\n                                Button(Class: btn btn-default fa fa-close, Page: #this_page#)\r\n                            }\r\n                            Button(Class: btn btn-default fa fa-search, Page: #this_page#, PageParams: \"Search=Val(Search),type=1\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            DBFind(@1ts_wallets, wallets).Where(#Where#).Order({id:-1}).Count(wallets_count).Custom(_rat){\r\n                If(#rejected_at#>0){\r\n                    DateTime(#rejected_at#, Format: YYYY-MM-DD HH:MI:SS)\r\n                }\r\n            }.Custom(_sat){\r\n                If(#signed_at#>0){\r\n                    DateTime(#signed_at#, Format: YYYY-MM-DD HH:MI:SS)\r\n                }\r\n            }.Custom(_cat){\r\n                If(#created_at#>0){\r\n                    Span(Class:text-muted, Body:DateTime(#created_at#, Format: YYYY-MM-DD HH:MI:SS))\r\n                }\r\n            }.Custom(_buyer){\r\n                LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#key_id_buyer#\"){\r\n                    Address(#key_id_buyer#)\r\n                }\r\n                Div(Class:text-muted m0 h6, Body:#key_id_buyer#)\r\n            }.Custom(_signer){\r\n                If(#key_id_signer#!=0){\r\n                    Span(Class:text-success, Body: Address(#key_id_signer#))\r\n                }\r\n            }\r\n\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    If(#wallets_count#>0){\r\n                        Div(table-responsive){\r\n                            Table(wallets,\"$@1id$=id,$@1key_id_investor$=_buyer,$@1created_at$=_cat,$@1rejected_at$=_rat,$@1signed_at$=_sat,$@1key_id_consensus$=_signer\")\r\n                        }\r\n                    }.Else{\r\n                        Div(h4 text-muted text-center){\r\n                            $@1wallets$ $@1not_founded$\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "TsBuyerAction",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsBuyerAction {\r\n    data {\r\n        Action string\r\n    }\r\n    conditions{\r\n        var basicAppId int\r\n        basicAppId = Int(DBFind(\"@1applications\").Where({ecosystem:1, name:\"Basic\"}).One(\"id\"))\r\n        if basicAppId == 0{\r\n            warning LangRes(\"@1app_not_found\", \"en\")\r\n        }\r\n        $roleConsensus = Int(EcosysParam(\"role_apla_consensus_asbl\"))\r\n        if $roleConsensus == 0{\r\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), \"role_apla_consensus_asbl\")\r\n        }\r\n        $wallet = DBFind(\"ts_wallets\").Where({key_id_buyer:$key_id, rejected_at:0}).Row()\r\n        if !$wallet{\r\n            warning \"Buyer wallet not found\"\r\n        }\r\n    }\r\n\r\n    action {\r\n        if $Action == \"accept\"{\r\n            DBUpdate(\"ts_wallets\", Int($wallet[\"id\"]), {signed_at:$time})\r\n            // role Apla Consensus notification\r\n            var params map title string\r\n            title = Sprintf(\"Buyer %v signed contract\", IdToAddress($key_id))\r\n            params[\"wallet_id\"] = $wallet[\"id\"]\r\n            @1NotificationsSend(\"rid,sender,text_header,page_name,params_map,closure_type\", $roleConsensus, 1, title, \"ts_consensus_contract\", params, 1)\r\n\r\n        }elif $Action == \"reject\"{\r\n            DBUpdate(\"ts_wallets\", Int($wallet[\"id\"]), {rejected_at:$time})\r\n        }\r\n\r\n        var notes array i int note map\r\n        notes = DBFind(\"@1notifications\").Where({ecosystem:$ecosystem_id, \"recipient->member_id\":$key_id, page_name:\"@1ts_buyer_contract\", closed:0}).Columns(\"id\")\r\n        while i < Len(notes){\r\n            note = notes[i]\r\n            @1NotificationsClose(\"notific_id\",Int(note[\"id\"]))\r\n            i = i + 1\r\n        }\r\n    }\r\n}\r\n",
            "Type": "contracts"
        },
        {
            "Name": "TsConsensusAction",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsConsensusAction {\r\n    data {\r\n        Action string\r\n        WalletId int\r\n        NotificId int\r\n    }\r\n    conditions{\r\n        var basicAppId int\r\n        basicAppId = Int(DBFind(\"@1applications\").Where({ecosystem:1, name:\"Basic\"}).One(\"id\"))\r\n        if basicAppId == 0{\r\n            warning LangRes(\"@1app_not_found\", \"en\")\r\n        }\r\n        $roleConsensus = Int(EcosysParam(\"role_apla_consensus_asbl\"))\r\n        if $roleConsensus == 0{\r\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), \"role_apla_consensus_asbl\")\r\n        }\r\n        if !RoleAccess($roleConsensus){\r\n            warning \"this action allowed only for role id #\" + $roleConsensus\r\n        }\r\n        $wallet = DBFind(\"ts_wallets\").Where({id:$WalletId, rejected_at:0}).Row()\r\n        if !$wallet{\r\n            warning \"Buyer wallet not found\"\r\n        }\r\n        if Int($wallet[\"signed_at\"]) == 0{\r\n            warning \"Buyer wallet not signed\"\r\n        }\r\n        if $wallet[\"key_id_signer\"] > 0{\r\n            if $wallet[\"key_id_signer\"] != $key_id{\r\n                warning \"This wallet was signed by asbl early\"\r\n            }\r\n        }\r\n    }\r\n\r\n    action {\r\n        if $Action == \"accept\"{\r\n            DBUpdate(\"ts_wallets\", Int($wallet[\"id\"]), {key_id_signer:$key_id})\r\n            // buyer notification\r\n            var params map\r\n            params[\"wallet_id\"] = $wallet[\"id\"]\r\n            @1NotificationsSend(\"member_id,sender,text_header,page_name,params_map,closure_type\", Int($wallet[\"key_id_buyer\"]), 1, \"Your wallet approved\", \"ts_buyer_congratulation\", params, 1)\r\n\r\n        }elif $Action == \"reject\"{\r\n            DBUpdate(\"ts_wallets\", Int($wallet[\"id\"]), {rejected_at:$time})\r\n        }\r\n        @1NotificationsClose(\"notific_id\", $NotificId)\r\n    }\r\n}\r\n",
            "Type": "contracts"
        },
        {
            "Name": "TsKeyApprove",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsKeyApprove {\r\n    data {\r\n        public_key string\r\n        key_type string\r\n        current_role_id int\r\n    }\r\n\r\n    conditions {\r\n        if $public_key == \"\" {\r\n            warning LangRes(\"@1public_key_empty\", \"en\")\r\n        }\r\n\r\n        $public_key = Replace($public_key, \" \", \"\")\r\n        if HasPrefix($public_key, \"04\") {\r\n            $public_key = Substr($public_key, 2, Size($public_key) - 2)\r\n        }\r\n        $userKey = PubToID($public_key)\r\n\r\n        if $userKey == 0 || Size($public_key) != 128 {\r\n            warning LangRes(\"@1public_key_invalid\", \"en\")\r\n        }\r\n\r\n        if DBFind(\"ts_wallets\").Where({key_id_buyer: $userKey}).One(\"id\") {\r\n            warning LangRes(\"@1investor_added_already\", \"en\")\r\n        }\r\n\r\n        if DBFind(\"keys\").Where({id: $userKey}).One(\"id\") {\r\n            warning LangRes(\"@1key_added_already\", \"en\")\r\n        }\r\n\r\n        var snapSwapRoleId int snapSwapRoleName string\r\n        snapSwapRoleId = Int(EcosysParam(\"role_snapswap\"))\r\n        snapSwapRoleName = DBFind(\"@1roles\").Where({\"id\": snapSwapRoleId}).One(\"role_name\")\r\n\r\n        if snapSwapRoleId == 0 {\r\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), \"role_snapswap\")\r\n        }\r\n\r\n        if !RoleAccess(snapSwapRoleId) {\r\n            warning Sprintf(LangRes(\"x_role_only_action\", \"en\"), snapSwapRoleName)\r\n        }\r\n    }\r\n\r\n    action {\r\n        DBInsert(\"@1keys\", {\"id\": $userKey, \"pub\": $public_key})\r\n        var start_balance money\r\n        start_balance = Money(1000000000000000)\r\n        @1TokensSend(\"Recipient,Amount\", IdToAddress($userKey), start_balance)\r\n\r\n        if $key_type == \"investor\" {\r\n            DBInsert(\"ts_wallets\", {\"key_id_buyer\": $userKey, \"created_at\": $block_time})\r\n\r\n            // new user notification\r\n            var params map title page body string\r\n            title = LangRes(\"@1ts_hello_user_description\", \"en\")\r\n            body = LangRes(\"@1ts_read_contract\", \"en\")\r\n            page = \"@1ts_buyer_contract\"\r\n            @1NotificationsSend(\"member_id,sender,text_header,text_body,page_name,params_map,closure_type,current_role_id\", $userKey, 2, title, body, page, params, 1, $current_role_id)          \r\n        }\r\n    }\r\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsSettings",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsSettings {\r\n    data {\r\n        RoleAdmin int\r\n        RoleManager int\r\n        RoleSeller int\r\n        RoleSnapswap int\r\n    }\r\n    conditions{\r\n        MainCondition()\r\n    }\r\n    func updateParam(name string, id int){\r\n        if id > 0{\r\n            var params paramsNew map\r\n            params = DBFind(\"@1parameters\").Where({name:name, ecosystem:$ecosystem_id}).Row()\r\n            paramsNew[\"Value\"] = Str(id)\r\n            if params {\r\n                paramsNew[\"Id\"] = Int(params[\"id\"])\r\n                paramsNew[\"Conditions\"] = params[\"conditions\"]\r\n                CallContract(\"@1EditParameter\", paramsNew)\r\n            }else{\r\n                paramsNew[\"Name\"] = name\r\n                paramsNew[\"Conditions\"] = \"ContractConditions(\\\"MainCondition\\\")\"\r\n                CallContract(\"@1NewParameter\", paramsNew)\r\n            }\r\n        }\r\n    }\r\n    action {\r\n        updateParam(\"role_sale_admin\", $RoleAdmin)\r\n        updateParam(\"role_sale_manager\", $RoleManager)\r\n        updateParam(\"role_sale_seller\", $RoleSeller)\r\n        updateParam(\"role_snapswap\", $RoleSnapswap)\r\n    }\r\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsTransferAdmin",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsTransferAdmin {\r\n    data {\r\n        WalletStr string\r\n        Amount string\r\n        CurrencyType int\r\n        AmountApl money\r\n        TransferredDate string\r\n        TransferredTime string\r\n    }\r\n    func getRoleId(name string) int{\r\n        var rid int\r\n        rid = Int(EcosysParam(name))\r\n        if rid == 0{\r\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), name)\r\n        }\r\n        return rid\r\n    }\r\n    func trimZeroTime(s string) string {\r\n        if Contains(s, \"T00:00:00Z\") {\r\n            s = s Replace(s, \"T00:00:00Z\", \"\")\r\n        }\r\n        return s\r\n    }\r\n    func dateAddTime(d, t string) string {\r\n        var dt string\r\n        if Size(t) == 5 {\r\n            dt = Sprintf(\"%v %v:00\", trimZeroTime(d), t)\r\n        }\r\n        return dt\r\n    }\r\n    conditions{\r\n        $WAITING_MANAGER = 1\r\n        $WAITING_SELLER = 2\r\n        $FINISHED = 3\r\n        $REJECTED = 4\r\n        if $AmountApl <= 0{\r\n            warning \"invalid amount APL\"\r\n        }\r\n        if $Amount <= 0.0{\r\n            warning \"invalid amount\"\r\n        }\r\n\r\n        $transferredAt = UnixDateTime(dateAddTime($TransferredDate, $TransferredTime))\r\n        if $transferredAt == 0 {\r\n            warning \"invalid transfer datetime\"\r\n        }\r\n        $appId = Int(DBFind(\"@1applications\").Where({ecosystem:$ecosystem_id, name:\"Tokens sale\"}).One(\"id\"))\r\n        if $appId == 0{\r\n            warning LangRes(\"@1app_not_found\", \"en\")\r\n        }\r\n        $roleAplManager = getRoleId(\"role_sale_manager\")\r\n        $currentRole = getRoleId(\"role_sale_admin\")\r\n        if !RoleAccess($currentRole){\r\n            warning \"this action allowed only for role id #\" + $currentRole\r\n        }\r\n\r\n        $WalletId = AddressToId($WalletStr)\r\n        $wallet = DBFind(\"ts_wallets\").Where({key_id_buyer:$WalletId}).Row()\r\n        if !$wallet{\r\n            warning \"Buyer wallet not found\"\r\n        }\r\n        if $CurrencyType <= 0 || $CurrencyType > 3{\r\n            warning \"Invalid Currency Type\"\r\n        }\r\n    }\r\n\r\n    action {\r\n        var sale map saleId int\r\n        sale[\"key_id_buyer\"] = $wallet[\"key_id_buyer\"]\r\n        sale[\"currency_type\"] = $CurrencyType\r\n        sale[\"amount\"] = $Amount\r\n        sale[\"amount_apl\"] = $AmountApl\r\n        sale[\"key_id_sale_apl_admin\"] = $key_id\r\n        sale[\"created_at\"] = $time\r\n        sale[\"buyer_transferred_at\"] = $transferredAt\r\n        sale[\"status\"] = $WAITING_MANAGER\r\n\r\n        saleId = DBInsert(\"ts_sales\", sale)\r\n\r\n        // role Apla sales manager notification\r\n        var params map title page string\r\n        title = Sprintf(\"Check sale id %v\", saleId)\r\n        page = \"ts_transfer_manager\"\r\n        params[\"sale_id\"] = saleId\r\n        @1NotificationsSend(\"rid,sender,text_header,page_name,params_map,closure_type,current_role_id\", $roleAplManager, 2, title, page, params, 1, $currentRole)\r\n\r\n    }\r\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsTransferManager",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsTransferManager {\r\n    data {\r\n        SaleId int\r\n        NotificId int\r\n    }\r\n    func getRoleId(name string) int{\r\n        var rid int\r\n        rid = Int(EcosysParam(name))\r\n        if rid == 0{\r\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), name)\r\n        }\r\n        return rid\r\n    }\r\n    conditions{\r\n        $WAITING_MANAGER = 1\r\n        $WAITING_SELLER = 2\r\n        $FINISHED = 3\r\n        $REJECTED = 4\r\n        $appId = Int(DBFind(\"@1applications\").Where({ecosystem:$ecosystem_id, name:\"Tokens sale\"}).One(\"id\"))\r\n        if $appId == 0{\r\n            warning LangRes(\"@1app_not_found\", \"en\")\r\n        }\r\n        $roleAplSeller = getRoleId(\"role_sale_seller\")\r\n        $currentRole = getRoleId(\"role_sale_manager\")\r\n        if !RoleAccess($currentRole){\r\n            warning \"this action allowed only for role id #\" + $currentRole\r\n        }\r\n\r\n        $sale = DBFind(\"ts_sales\").Where({id:$SaleId}).Row()\r\n        if !$sale{\r\n            warning \"Sale not found\"\r\n        }\r\n    }\r\n\r\n    action {\r\n        @1NotificationsClose(\"notific_id\", $NotificId)\r\n        DBUpdate(\"ts_sales\", Int($sale[\"id\"]), {key_id_sale_apl_manager:$key_id, status:$WAITING_SELLER})\r\n\r\n        // role Apla seller notification\r\n        var params map title page string\r\n        title = Sprintf(\"Transfer sale id %v\", $sale[\"id\"])\r\n        params[\"sale_id\"] = $sale[\"id\"]\r\n        page = \"ts_transfer_seller\"\r\n        @1NotificationsSend(\"rid,sender,text_header,page_name,params_map,closure_type,current_role_id\", $roleAplSeller, 2, title, page, params, 1, $currentRole)\r\n\r\n    }\r\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsTransferReject",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsTransferReject {\r\n    data {\r\n        Comment string\r\n        RoleParam string\r\n        NotificId int\r\n    }\r\n    func getRoleId(name string) int{\r\n        var rid int\r\n        rid = Int(EcosysParam(name))\r\n        if rid == 0{\r\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), name)\r\n        }\r\n        return rid\r\n    }\r\n    conditions{\r\n        $WAITING_MANAGER = 1\r\n        $WAITING_SELLER = 2\r\n        $FINISHED = 3\r\n        $REJECTED = 4\r\n\r\n        if !($RoleParam == \"role_sale_manager\" || $RoleParam == \"role_sale_seller\"){\r\n            warning \"invalid role parameter\"\r\n        }\r\n        var role noteSaleId int note map\r\n        role = getRoleId($RoleParam)\r\n        if !RoleAccess(role){\r\n            warning \"this action allowed only for role id #\" + role\r\n        }\r\n        note = DBFind(\"@1notifications\").Where({id:$NotificId}).Columns(\"page_params->sale_id,date_start_processing,notification->type\").Row()\r\n        if !note{\r\n            warning \"Notification not found\"\r\n        }\r\n        $needProcessing = note[\"date_start_processing\"] == \"\"\r\n        noteSaleId = Int(note[\"page_params.sale_id\"])\r\n        $sale = DBFind(\"ts_sales\").Where({id:noteSaleId}).Row()\r\n        if !$sale {\r\n            warning \"Sale not found\"\r\n        }\r\n        $saleId = Int($sale[\"id\"])\r\n    }\r\n\r\n    action {\r\n        if $needProcessing {\r\n            @1NotificationsProcess(\"notific_id\", $NotificId)\r\n        }\r\n        @1NotificationsClose(\"notific_id\", $NotificId)\r\n        var sale params map title body string prevKeyId int\r\n        title = Sprintf(\"Sale %v rejected\", $saleId)\r\n        body = $Comment\r\n        params[\"sale_id\"] = $saleId\r\n        sale[\"status\"] = $REJECTED\r\n        if $RoleParam == \"role_sale_manager\"{\r\n            sale[\"key_id_sale_apl_manager\"] = $key_id\r\n            sale[\"manager_reject_comment\"] = $Comment\r\n            sale[\"manager_rejected_at\"] = $time\r\n            prevKeyId = Int($sale[\"key_id_sale_apl_admin\"])\r\n\r\n        }elif $RoleParam == \"role_sale_seller\"{\r\n            sale[\"key_id_seller\"] = $key_id\r\n            sale[\"seller_reject_comment\"] = $Comment\r\n            sale[\"seller_rejected_at\"] = $time\r\n            prevKeyId = Int($sale[\"key_id_sale_apl_manager\"])\r\n        }\r\n\r\n        DBUpdate(\"ts_sales\", $saleId, sale)\r\n        @1NotificationsSend(\"member_id,sender,text_header,text_body,page_name,params_map,closure_type\", prevKeyId, 1, title, body, \"ts_notification\", params, 1)\r\n\r\n    }\r\n}",
            "Type": "contracts"
        },
        {
            "Name": "TsTransferSeller",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract TsTransferSeller {\r\n    data {\r\n        SaleId int\r\n        NotificId int\r\n    }\r\n    func getRoleId(name string) int{\r\n        var rid int\r\n        rid = Int(EcosysParam(name))\r\n        if rid == 0{\r\n            warning Sprintf(LangRes(\"@1role_not_set_application_parameter\", \"en\"), name)\r\n        }\r\n        return rid\r\n    }\r\n    conditions{\r\n        $WAITING_MANAGER = 1\r\n        $WAITING_SELLER = 2\r\n        $FINISHED = 3\r\n        $REJECTED = 4\r\n        $appId = Int(DBFind(\"@1applications\").Where({ecosystem:$ecosystem_id, name:\"Tokens sale\"}).One(\"id\"))\r\n        if $appId == 0{\r\n            warning LangRes(\"@1app_not_found\", \"en\")\r\n        }\r\n        $currentRole = getRoleId(\"role_sale_seller\")\r\n        if !RoleAccess($currentRole){\r\n            warning \"this action allowed only for role id #\" + $currentRole\r\n        }\r\n\r\n        $sale = DBFind(\"ts_sales\").Where({id:$SaleId}).Row()\r\n        if !$sale{\r\n            warning \"sale not found\"\r\n        }\r\n    }\r\n\r\n    action {\r\n        @1NotificationsClose(\"notific_id\", $NotificId)\r\n        var s transfer map\r\n        s[\"key_id_seller\"] = $key_id\r\n        s[\"seller_transferred_at\"] = $time\r\n        s[\"status\"] = $FINISHED\r\n        DBUpdate(\"ts_sales\", Int($sale[\"id\"]), s)\r\n\r\n        @1TokensSend(\"Recipient,Amount\", $sale[\"key_id_buyer\"], Money($sale[\"amount_apl\"]))\r\n    }\r\n}",
            "Type": "contracts"
        }
    ]
}