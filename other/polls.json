{
    "name": "Polls",
    "conditions": "ContractConditions(\"@1DeveloperCondition\")",
    "data": [
        {
            "Name": "default_menu",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "MenuItem(Title:$@1polls$, Page:@1polls_list, Icon:\"icon-chart\")",
            "Type": "menu"
        },
        {
            "Name": "polls_create",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetTitle($@1start_poll$)\nDiv(breadcrumb){\n    LinkPage(Body: $@1polls$, Page: @1polls_list)\n    Span(/, mh)\n    LinkPage(Body: $@1polls_templates$, Page: @1polls_templates)\n    Span(/,mh)\n    Span($@1start_poll$, text-muted)\n}\n\nDiv(content-wrapper){\n    If(#TemplateId#>0){\n        Div(row){\n            Div(col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2){\n                Form(panel panel-primary){\n                    Div(panel-heading){$@1enter_data_for_poll_template$}\n                    Div(list-group-item){\n                        DBFind(@1voting_templates).WhereId(#TemplateId#).Vars(template)\n                        If(#template_type_voting# == 3){\n                            Div(row){\n                                Div(col-md-4 mt text-right){\n                                    Label(For: TextDocument){\n                                        Span(Body: $@1enter_your_questions$)\n                                    }\n                                }\n                                Div(col-md-8 mb-sm text-left){\n                                    Input(Name: TextDocument, Type: textarea)\n                                }\n                            }\n                            Div(row){\n                                Div(col-md-4 mt-sm text-right){\n                                    Label(For: Duration){\n                                        $@1duration$ ($@1days$)\n                                    }\n                                }\n                                Div(col-md-8 mb-sm text-left){\n                                    Input(Name: Duration, Type: number, Value: 3)\n                                }\n                            }\n                        }\n                    }\n                    Div(list-group-item text-right){\n                        Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1polls_templates)\n                        Div(pull-right){\n                            Button(Body: $@1start_poll$, Class: btn btn-primary, Page: @1polls_list, Contract: @1VotingTemplateRun, Params: \"TemplateId=#TemplateId#\")\n                        }\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(col-md-12 alert alert-danger text-center){\n            LangRes(@1attention)\n        }\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "polls_decision",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "If(#vID# > 0){\n    DBFind(@1votings_subject, src_voting_subject).Where({voting_id:#vID#}).Columns(\"id,subject->text\").Vars(prefix)\n    If(#prefix_id#>0){\n    }.Else{\n        SetVar(Name: prefix_subject_text, Value: \"\")\n    }\n\n    Form(){\n        Div(row){\n            Div(col-md-12){\n                Label(){\n                    Span(Body: LangRes(@1text_document))\n                    Span(Class: text-danger, Body:*)\n                }\n                Input(Name: text_document, Type: textarea, Value: #prefix_subject_text#)\n            }\n        }\n        Input(Name: votingID, Type: hidden, Value: #vID#)\n        Button(Body: LangRes(@1save), Class: btn btn-primary pull-right mt, Page: @1polls_view, PageParams: \"vID=#vID#\", Contract: @1VotingSubjectDocument)\n        Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt, Page: @1polls_view, PageParams: \"vID=#vID#\")\n    }\n}.Else{\n    Div(md-12 alert alert-danger text-center){\n        Span(Body: LangRes(@1attention))\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "polls_filters",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "Data(poll_type,\"id,value\"){\n    3, $@1a_polls$\n    4, $@1my_polls$\n    5, $@1role_polls$\n}\n\nForm(){\n    Div(row){\n        Div(col-md-12){\n            Label(Class: m0){\n                Span(Body: LangRes(@1type))\n            }\n            RadioGroup(Name: Type, Source: poll_type, NameColumn: value, ValueColumn: id, Value: #page_par#)\n        }\n    }\n    If(GetVar(search)==\"\"){\n        SetVar(search,)\n    }\n    Button(Body: LangRes(@1filter), Class: btn btn-primary pull-right, Page: @1polls_list, PageParams: \"page_par=Val(Type),search=#search#\")\n    Button(Body: LangRes(@1clear), Class: btn btn-default pull-right, Page: @1polls_list, PageParams: \"page_par=0,search=#search#\")\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "polls_list",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1polls_list).(this_table, @1votings)\nInclude(@1pager_header)\n\nSetTitle($@1polls$)\nIf(EcosysParam(Ecosystem:1, Name: role_admin) == #role_id#){\n    AddToolButton(Title: $@1polls_templates$, Page: @1polls_templates, Icon: fa icon-pin)\n}\n\nIf(GetVar(page_par)){\n    If(#page_par#==3){\n        SetVar(type_filter, {\"status\":3})\n    }.ElseIf(#page_par#==4){\n        SetVar(type_filter, {\"creator->member_id\":#key_id#})\n    }.ElseIf(#page_par#==5){\n        SetVar(type_filter, {\"voting->type_participants\":4})\n    }\n}.Else{\n    SetVar(page_par, \"0\")\n}\n\nIf(GetVar(search)!=\"\"){\n    SetVar(where, {$and: [{\"ecosystem\": #ecosystem_id#}, {\"deleted\": 0}, {\"voting->type\": 3}, GetVar(type_filter), {\"voting->name\": {\"$like\":#search#}}]})\n}.Else{\n    SetVar(where, {$and: [{\"ecosystem\": #ecosystem_id#}, {\"deleted\": 0}, {\"voting->type\": 3}, GetVar(type_filter)]}).(search,)\n}\n\nDiv(btn-group ml-lg mr-lg){\n    If(EcosysParam(Name:founder_account)==#key_id#){\n        Button(Body: Em(Class: fa fa-refresh) $@1update_votings_statuses$, Class: btn bg-gray ml-sm, Page: #this_page#, Contract: @1VotingStatusUpdate)\n    }\n    Div(text-right){\n        Button(Page: @1polls_filters, Class: btn bg-gray-lighter mr-sm, PageParams: \"sort=#sort#,page_par=#page_par#,search=#search#,current_page=#current_page#\", Body: Em(Class: fa fa-filter) $@1filter$).Popup(Header: $@1filter$, Width: \"30\")\n        If(Or(#page_par#>0,#sort#>0)){\n            Button(Page: #this_page#, PageParams: \"sort=0,page_par=0,search=#search#\", Class: btn bg-gray-lighter mr-sm, Body: Em(Class: fa fa-close))\n        }\n    }\n}\n\nDiv(list-group-item ml-lg mr-lg pt-lg){\n    SetVar(search_name, LangRes(@1polls))\n    Include(@1search)\n}\n\nSetVar(WAITING,1).(VALID,2).(STARTED,3).(FINISHED,4).(INVALID,5)\nDBFind(@1applications).Where({ecosystem:1, name:\"Basic\"}).Columns(\"name,id\").Vars(application)\n\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": -1}).Limit(#pager_limit#).Offset(#pager_offset#).Columns(\"id,voting->name,voting->type,voting->type_decision,voting->type_participants,flags->success,flags->decision,flags->full_data,progress->percent_success,progress->number_participants,creator->member_id,creator->member_name,date_started,date_ended,deleted,status,voting->count_type_voters,voting->volume,progress->number_voters\").Count(count_votings).Custom(_id){\n    Span(Class: h5, Body: #id#)\n}.Custom(_name){\n    LinkPage(Page: @1polls_view, PageParams: \"vID=#id#\"){\n        Span(Class: h5 text-bold m0, Body: #voting.name#)\n    }\n}.Custom(_participants){\n    SetVar(participants, AppParam(Ecosystem:1, App:#application_id#, Name: type_voting_participants, Index: #voting.type_participants#))\n    Div(h6 m0){\n        If(Or(#status#==#STARTED#,#status#==#FINISHED#,#voting.type#==2)){\n            #participants#\n        }.Else{\n            Button(Page: @1voting_invite, PageParams: \"back_page=#this_page#\", PageParams: \"vID=#id#,back_page=#this_page#\", Class: btn btn-link p0 text-bold, Body: #participants#).Popup(45, $@1participants_add$)\n        }\n    }\n}.Custom(_date){\n    SetVar(started_class, text-bold h5 m0).(finished_class,text-bold h5 m0)\n    If(Or(#status#==#STARTED#,#status#==#FINISHED#)){\n        SetVar(started_class, text-muted h5 m0)\n    }\n    If(#status#==#FINISHED#){\n        SetVar(finished_class, text-muted h5 m0)\n    }\n    Div(Class: text-left){\n        P(Class: #started_class#, Body: DateTime(DateTime: #date_started#, Format: \"DD.MM.YYYY HH:MI\"))\n        P(Class: #finished_class#, Body: DateTime(DateTime: #date_ended#, Format: \"DD.MM.YYYY HH:MI\"))\n    }\n}.Custom(_status){\n    SetVar(status_class, AppParam(Ecosystem:1, App:#application_id#, Name:voting_statuses_classes, Index:#status#))\n    Div(#status_class#){\n        AppParam(Ecosystem:1, App:#application_id#, Name:voting_statuses, Index:#status#)\n    }\n}.Custom(_result){\n    If(#flags.decision#==0){\n        Span(Body: $@1not_voted$, Class: text-info)\n    }.ElseIf(#flags.decision#==-1){\n        Span(Body: $@1no$, Class: text-danger)\n    }.ElseIf(#flags.decision#==1){\n        Span(Body: $@1yes$, Class: text-success)\n    }\n}.Custom(_actions){\n    If(And(#creator.member_id#==#key_id#,#status#==#INVALID#)){\n        Button(Class: fa fa-trash btn btn-default, Contract: @1VotingDelete, Params: \"votingID=#id#\", Page: #this_page#).Alert(Text: \"$@1want_delete_voting$\", ConfirmButton: $@1yes$, CancelButton: $@1no$, Icon: question)\n    }\n}.Count(count)\n\nDiv(fullscreen){\n    Div(table-responsive ml-lg mr-lg){\n        Div(list-group-item){\n            If(#count# > 0){\n                Table(src, \"Polls=_name,$@1result$=_result,$@1type$=_type,$@1subject_voting$=_subject,$@1participants$=_participants,$@1date_start$ / $@1date_end$=_date,$@1creator$=_creator,$@1progress$=_progress,$@1decision$=_decision,$@1status$=_status,=_actions\")\n            }.Else{\n                Div(Class: text-center h4 text-muted, Body: \"$@1polls$ $@1not_founded$\")\n            }\n        }.Style(\n            margin-top:-15px;\n            tbody > tr:nth-of-type(odd) {\n                background-color: #f8f9fc;\n            }\n        )\n    }\n}           \nDiv(mt-sm ml-lg mr-sm mb-sm){\n    Include(@1pager)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "polls_template_add",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "Form(){\n    Input(Name: TypeDecision, Type: number, Value: 3, Class: hidden)\n    Input(Name: TypeVoting, Value: 3, Class: hidden)\n    Input(Name: Volume, Type: number, Value: 100, Class: hidden)\n    Input(Name: Quorum, Type: number, Value: 5, Class: hidden)\n\n    Div(row){\n        Div(col-sm-4 mt-sm text-right){\n            Label(For: #name#){\n                LangRes(@1participants)\n                Span(*,text-danger)\n            }\n        }\n        Div(col-sm-8 text-left){\n            Data(poll_type_participants,\"id,name\"){\n                1, $@1everybody$\n                4, $@1roles_list2$\n            }\n            Select(Name: TypeParticipants, Source: poll_type_participants, NameColumn: name, ValueColumn: id)\n        }\n    }\n    Div(row mt-sm){\n        Div(col-sm-4 mt-sm text-right){\n            Label(For: Title){\n                Span(Body: $@1title$)\n                Span(*,text-danger)\n            }\n        }\n        Div(col-sm-8 text-left){\n            Input(Name: Title, Placeholder: $@1enter_poll_template_name$)\n        }\n    }\n    Div(row mt mb){\n        Div(col-md-12 text-center){\n            Span(Body: $@1poll_start$, Class: text-danger)\n        }\n    }\n    Button(Body: LangRes(@1create), Class: btn btn-primary pull-right, Page: @1polls_templates, Contract: @1VotingTemplateCreate, Params: \"Poll=1\")\n    Button(Body: LangRes(@1back), Class: btn btn-default pull-right, Page: @1polls_templates)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "polls_templates",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1polls_templates).(this_table, @1voting_templates)\nInclude(@1pager_header)\n\nSetTitle($@1polls_templates$)\nIf(EcosysParam(Ecosystem:1, Name: role_admin) == #role_id#){\n    AddToolButton(Title: $@1template_add$, Page: @1polls_template_add, Icon: icon-plus).Popup(40, $@1template_add$)\n}\nSpan(Class: h5 m0 mb ml-lg){\n    LinkPage(Class: ml-sm, Body: $@1polls$, Page: @1polls_list, PageParams: \"type=0\" )\n    Span(Class: text-muted mh, Body: /)\n    Span(Class: text-muted, Body: $@1polls_templates$)\n}.Style(\n    display: inline-block;\n)\n\nIf(GetVar(search)){\n    SetVar(where, {\"ecosystem\": #ecosystem_id#, \"type_voting\": 3, \"title\": {\"$like\":#search#}})\n}.Else{\n    SetVar(where, {\"ecosystem\": #ecosystem_id#, \"type_voting\": 3}).(search,)\n}\n\nDiv(list-group-item ml-lg mr-lg pt-lg){\n    SetVar(search_name, LangRes(@1template))\n    Include(@1search)\n}\n\nDBFind(@1applications).Where({ecosystem:1, name:\"Basic\"}).Columns(\"name,id\").Vars(application)\n\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": 1}).Limit(#pager_limit#).Offset(#pager_offset#).Custom(_participants){\n    AppParam(Ecosystem:1, App:#application_id#, Name:type_voting_participants, Index: #type_participants#)\n}.Custom(_actions){\n    Div(text-right){\n        Button(Class: btn btn-default fa fa-play, Page: @1polls_create, PageParams: \"TemplateId=#id#\")\n    }\n}.Count(count)\n\nDiv(fullscreen){\n    Div(table-responsive ml-lg mr-lg){\n        Div(list-group-item){\n            If(#count# > 0){\n                Table(src, \"$@1template$=title,$@1participants$=_participants,$@1decision$=_decision,=_actions\")\n            }.Else{\n                Div(Class: text-center h4 text-muted, Body: \"$@1polls_templates$ $@1not_founded$\")\n            }\n        }.Style(\n            margin-top:-15px;\n            tbody > tr:nth-of-type(odd) {\n                background-color: #f8f9fc;\n            }\n        )\n    }\n}\nDiv(mt-sm ml-lg mr-sm mb-sm){\n    Include(@1pager)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "polls_view",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Columns(\"name,id\").Where({ecosystem:1, name:\"Basic\"}).Vars(application)\nIf(#notific_id#>0){\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->voting_id\").Vars(notific)\n    SetVar(vID,#notific_page_params_voting_id#)\n}\n\nSetVar(WAITING,1).(VALID,2).(STARTED,3).(FINISHED,4).(INVALID,5)\nSetVar(date_format,\"DD.MM.YYYY HH:MI\")\nSetVar(this_page,\"@1polls_view\")\nSetVar(col_right,\"col-md-6 text-left h3\")\nSetVar(col_left,\"col-md-6 text-right h3\")\n\nDiv(content-wrapper){\n    If(#vID# > 0){\n        DBFind(@1votings, Source: charts).WhereId(#vID#).Columns(\"id,voting->name,voting->volume,voting->quorum,voting->type_participants,voting->type,voting->count_type_voters,voting->type_decision,voting->description,optional->role_id,optional->role_vacancies,optional->number_candidates,optional->contract_accept,optional->contract_reject,progress->number_participants,progress->number_voters,progress->percent_success,progress->percent_voters,flags->success,flags->full_data,flags->decision,flags->notifics,date_started,date_ended,status\").Vars(instance)\n        SetVar(type_decision,#instance_voting_type_decision#)\n        SetVar(type_participants,#instance_voting_type_participants#)\n\n        SetVar(isVotingAllowed,0)\n        SetVar(isStartProcessing,0)\n        If(Or(#type_participants#==1,#type_participants#==2,#type_participants#==3,#type_participants#==4)){\n            DBFind(@1votings_participants).Where({voting_id:#vID#,\"member->member_id\":#key_id#, decision:0, ecosystem: #ecosystem_id#}).Columns(\"id\").Vars(flag_participant)\n            If(And(#instance_status#==#STARTED#,#flag_participant_id#>0)){\n                DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, \"recipient->member_id\":#key_id#, page_name:#this_page#, \"page_params->voting_id\": #vID#, closed:0}).Columns(\"id,notification->type,date_start_processing\").Vars(notificcc)\n                If(#notificcc_id#>0){\n                    SetVar(isVotingAllowed,1)\n                    SetVar(notific_id,#notificcc_id#)\n                    If(And(#notificcc_notification_type#==2,#notificcc_date_start_processing#==\"\")){\n                        SetVar(isStartProcessing,1)\n                    }\n                }\n            }\n        }\n        If(#type_participants#==5){\n            DBFind(@1votings_participants).Where({voting_id:#vID#,\"member->role_id\":#role_id#, decision:0, ecosystem: #ecosystem_id#}).Columns(\"id\").Vars(flag_participant)\n            If(And(#instance_status#==#STARTED#,#flag_participant_id#>0)){\n                DBFind(@1notifications).Where({{\"$or\":[{\"date_start_processing\": \"$isnull\"}, {\"processing_info->member_id\": #key_id#}]}, \"ecosystem\":#ecosystem_id#, \"recipient->role_id\":#role_id#, \"page_name\":#this_page#, \"page_params->voting_id\": #vID#, \"closed\":0}).Columns(\"id,notification->type,date_start_processing\").Vars(notificcc)\n                If(#notificcc_id#>0){\n                    SetVar(isVotingAllowed,1)\n                    SetVar(notific_id,#notificcc_id#)\n                    If(And(#notificcc_notification_type#==2,#notificcc_date_start_processing#==\"\")){\n                        SetVar(isStartProcessing,1)\n                    }\n                }\n            }\n        }\n        SetTitle(#instance_voting_name#)\n        Div(breadcrumb){\n            LinkPage(Body: $@1polls$, Page: @1polls_list, PageParams: \"type=0\")\n            Span(/,mh)\n            Span(Class: text-muted, Body: ##instance_id#)\n        }\n\n        Div(row mt-sm){\n            Div(col-lg-6 col-lg-offset-3){\n                Form(panel panel-primary){\n                    Input(Type: hidden, Name: votingID, Value: #vID#)\n\n                    Div(list-group-item text-center){\n                        P(Class: h3 text-bold m0, Body: #instance_voting_name#)\n                    }\n                    Div(list-group-item text-center){\n                        If(#type_decision#==3){\n                            DBFind(@1votings_subject, src_voting_subject).Where({voting_id:#vID#}).Columns(\"id,subject->text,subject->hash\").Vars(subject)\n                            Div(row){\n                                Div(#col_left#){\n                                    Label(For: TypeParticipants){\n                                        Span(Body: $@1question$:)\n                                    }\n                                }\n                                Div(#col_right#){\n                                    #subject_subject_text#\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-12){\n                                    If(And(Or(#instance_status#==#INVALID#,#instance_status#==#WAITING#),#instance_voting_type#==3)){\n                                        Button(Class: btn btn-link, Page: @1polls_decision, PageParams: \"vID=#vID#\"){\n                                            Strong(LangRes(@1subject_voting_edit))\n                                        }.Popup(50, $@1subject_voting$)\n                                    }\n                                }\n                            }\n                            Div(row mt-sm){\n                                Div(col-sm-6 col-sm-offset-2 col-lg-8 col-lg-offset-2){\n                                    If(#isStartProcessing#==1){\n                                        Button(Body: LangRes(@1process), Class: btn btn-info text-capitalize, Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\", Page: #this_page#, PageParams: \"notific_id=#notific_id#\")\n                                    }.Else{\n                                        If(#isVotingAllowed#==1){\n                                            Button(Body: $@1no$, Class: btn btn-danger pull-left, Contract: @1VotingDecisionReject, PageParams: \"vID=#vID#\", Page: #this_page#, Params: \"RoleId=#role_id#\")\n                                            Button(Body: $@1yes$, Class: btn btn-success pull-right, Contract: @1VotingDecisionAccept, PageParams: \"vID=#vID#\", Page: #this_page#, Params: \"RoleId=#role_id#\")\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    Div(list-group-item text-center){\n                        Div(row t4){\n                            Div(col-md-5 col-md-offset-1){\n                                LangRes(@1voted)\n                            }\n                            Div(col-md-5){\n                                LangRes(@1progress)\n                            }\n                        }\n                        If(graph_work==\"good\"){\n                            Div(row text-muted t6 text-center){\n                                Div(col-md-5 col-md-offset-1){\n                                    LangRes(@1voting_graph_voted)\n                                }\n                                Div(col-md-5){\n                                    LangRes(@1voting_graph_progress)\n                                }\n                            }\n                        }\n                        Div(row text-center t3){\n                            If(#instance_voting_count_type_voters# == 1){\n                                Div(col-md-5 col-md-offset-1){\n                                    #instance_progress_number_voters# LangRes(@1voters) / #instance_voting_volume# LangRes(@1voters)\n                                }\n                                Div(col-md-5){\n                                    #instance_progress_percent_success#% LangRes(@1success) / 100% LangRes(@1total)\n                                }\n                            }.Else{\n                                Div(col-md-5 col-md-offset-1){\n                                    #instance_progress_number_voters# LangRes(@1voters) / #instance_progress_percent_voters#% LangRes(@1voters)\n                                }\n                                Div(col-md-5){\n                                    #instance_progress_percent_success#% LangRes(@1success) / 100% LangRes(@1total)\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(@1attention))\n        }\n    }\n}.Style(\n    .t3 {font-size:24px;}\n    .t4 {font-size:18px;}\n    .t5 {font-size:14px;}\n    .t6 {font-size:12px;}\n    .break {word-break: break-all;}\n)\n",
            "Menu": "default_menu",
            "Type": "pages"
        }
    ]
}