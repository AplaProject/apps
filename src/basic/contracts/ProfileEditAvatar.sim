contract ProfileEditAvatar {
    data {
        member_image bytes "file"
        Lang string "optional"
    }

    conditions {
        $app_id = DBFind("@1applications").Where({ecosystem:1, name:"Basic", deleted:0}).One("id")
        
        if !$app_id {
            warning LangRes("@1app_not_found", $Lang)
        }
    }

    action {
        var m map
        m["image_id"] = @1UploadBinary("Name,Data,ApplicationId", "new_avatar", $member_image, Int($app_id))
        @1BufferManager("Action,Key,Val", "set", "avatar", JSONEncode(m))
    }
}