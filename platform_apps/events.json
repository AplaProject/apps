{
    "name": "Events",
    "conditions": "ContractConditions(\"@1DeveloperCondition\")",
    "data": [
        {
            "Name": "default_menu",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "MenuItem(Title:$@1e_events$, Page:@1e_events, Icon:\"icon-credit-card\")",
            "Type": "menu"
        },
        {
            "Name": "e_create_event",
            "Trans": "{\"en\": \"Create event\", \"ru\": \"Создать мероприятие\"}",
            "Type": "languages"
        },
        {
            "Name": "e_create_type",
            "Trans": "{\"en\": \"Create type\", \"ru\": \"Создать тип\"}",
            "Type": "languages"
        },
        {
            "Name": "e_desc",
            "Trans": "{\"en\": \"Complete list of all events\", \"ru\": \"Полный список всех событий\"}",
            "Type": "languages"
        },
        {
            "Name": "e_distribution_flyers",
            "Trans": "{\"en\": \"Flyers distribution\", \"ru\": \"Распространение листовок\"}",
            "Type": "languages"
        },
        {
            "Name": "e_edit_event",
            "Trans": "{\"en\": \"Edit event\", \"ru\": \"Редактировать мероприятие\"}",
            "Type": "languages"
        },
        {
            "Name": "e_edit_type",
            "Trans": "{\"en\": \"Edit type\", \"ru\": \"Редактировать тип\"}",
            "Type": "languages"
        },
        {
            "Name": "e_event_address",
            "Trans": "{\"en\": \"Event address\", \"ru\": \"Адрес мероприятия\"}",
            "Type": "languages"
        },
        {
            "Name": "e_event_name",
            "Trans": "{\"en\": \"Event title\", \"ru\": \"Название мероприятия\"}",
            "Type": "languages"
        },
        {
            "Name": "e_events",
            "Trans": "{\"en\": \"Events\", \"ru\": \"Мероприятия\"}",
            "Type": "languages"
        },
        {
            "Name": "e_events_filter",
            "Trans": "{\"en\": \"Filter\", \"ru\": \"Фильтровать\"}",
            "Type": "languages"
        },
        {
            "Name": "e_map",
            "Trans": "{\"en\": \"Map\", \"ru\": \"Карта\"}",
            "Type": "languages"
        },
        {
            "Name": "e_meeting",
            "Trans": "{\"en\": \"Meeting\", \"ru\": \"Митинг\"}",
            "Type": "languages"
        },
        {
            "Name": "e_moscow",
            "Trans": "{\"en\": \"Moscow\", \"ru\": \"Москва\"}",
            "Type": "languages"
        },
        {
            "Name": "e_new_type",
            "Trans": "{\"en\": \"New type...\", \"ru\": \"Новый тип...\"}",
            "Type": "languages"
        },
        {
            "Name": "e_picket",
            "Trans": "{\"en\": \"Picket\", \"ru\": \"Пикет\"}",
            "Type": "languages"
        },
        {
            "Name": "e_reset",
            "Trans": "{\"en\": \"Reset\", \"ru\": \"Сбросить\"}",
            "Type": "languages"
        },
        {
            "Name": "e_responsible",
            "Trans": "{\"en\": \"Responsible\", \"ru\": \"Ответственный\"}",
            "Type": "languages"
        },
        {
            "Name": "e_select_type",
            "Trans": "{\"en\": \"Select type..\", \"ru\": \"Выбрать тип..\"}",
            "Type": "languages"
        },
        {
            "Name": "e_spb",
            "Trans": "{\"en\": \"Saint-Petersburg\", \"ru\": \"Санкт-Петербург\"}",
            "Type": "languages"
        },
        {
            "Name": "e_starting_date",
            "Trans": "{\"en\": \"Starting date\", \"ru\": \"Дата начала\"}",
            "Type": "languages"
        },
        {
            "Name": "e_type",
            "Trans": "{\"en\": \"Type\", \"ru\": \"Тип\"}",
            "Type": "languages"
        },
        {
            "Name": "e_types",
            "Trans": "{\"en\": \"Types of events\", \"ru\": \"Типы событий\"}",
            "Type": "languages"
        },
        {
            "Name": "e_types_dec",
            "Trans": "{\"en\": \"You can create a new event type or edit an existing one\", \"ru\": \"Вы можете создать новый тип события или отредактировать существующий\"}",
            "Type": "languages"
        },
        {
            "Name": "e_events",
            "Columns": "[\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EEvent\\\")\",\n        \"name\": \"name\",\n        \"type\": \"varchar\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EEvent\\\")\",\n        \"name\": \"description\",\n        \"type\": \"text\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EEvent\\\")\",\n        \"name\": \"type\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EEvent\\\")\",\n        \"name\": \"starting_date\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EEvent\\\")\",\n        \"name\": \"event_address_json\",\n        \"type\": \"json\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EEvent\\\")\",\n        \"name\": \"responsible\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"false\",\n        \"name\": \"created_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EEvent\\\")\",\n        \"name\": \"deleted_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EEvent\\\")\",\n        \"name\": \"ecosystem\",\n        \"type\": \"number\"\n    }\n]",
            "Permissions": "{\"insert\":\"ContractAccess(\\\"@1EEvent\\\")\",\"update\":\"ContractAccess(\\\"@1EEvent\\\")\",\"new_column\":\"ContractConditions(\\\"@1AdminCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Name": "e_types",
            "Columns": "[\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EType\\\")\",\n        \"name\": \"name\",\n        \"type\": \"varchar\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EType\\\")\",\n        \"name\": \"info\",\n        \"type\": \"json\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EType\\\")\",\n        \"name\": \"deleted_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1EType\\\")\",\n        \"name\": \"ecosystem\",\n        \"type\": \"number\"\n    }\n]",
            "Permissions": "{\"insert\":\"ContractAccess(\\\"@1EType\\\")\",\"update\":\"ContractAccess(\\\"@1EType\\\")\",\"new_column\":\"ContractConditions(\\\"@1AdminCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Name": "events_admin_role",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "0",
            "Type": "app_params"
        },
        {
            "Name": "events_config",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "{\n    \"name\": \"Events\",\n    \"conditions\": \"ContractConditions(\\\"DeveloperCondition\\\")\",\n    \"data\": [\n        {\n            \"Name\": \"default_menu\",\n            \"Conditions\": \"ContractConditions(\\\"DeveloperCondition\\\")\",\n            \"Value\": \"MenuItem(Title:$@1e_events$, Page:@1e_events, Icon:\\\"icon-credit-card\\\")\",\n            \"Type\": \"menu\"\n        },\n        {\n            \"Name\": \"events_admin_role\",\n            \"Conditions\": \"ContractConditions(\\\"DeveloperCondition\\\")\",\n            \"Value\": \"0\",\n            \"Type\": \"app_params\"\n        }\n    ]\n}",
            "Type": "app_params"
        },
        {
            "Name": "e_event_form",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1e_event_form).(back_page, @1e_events)\n\nSetTitle($@1e_events$)\nDiv(breadcrumb text-muted){\n    LinkPage(Body:$@1e_events$, Page: @1e_events)\n    Span(/,mh)\n    If(#Id#>0){\n        $@1e_edit_event$\n    }.Else{\n        $@1e_create_event$\n    }\n}\n\nSetVar(event_name,).(event_description,).(event_event_address_json,{\"type\":\"point\",\"coords\":[[37.620558583362,55.75364730329732]],\"area\":0, \"zoom\":10})\n\nDBFind(@1e_types, t).Where({\"ecosystem\": #ecosystem_id#}).Columns(\"id,name\")\nSetVar(types_json,`\"0\":\"$@1e_new_type$\"`)\nForList(t){\n    SetVar(types_json,`#types_json#,\"#id#\":\"#name#\"`)\n}\nJsonToSource(types,{#types_json#})\n\nDiv(row){\n    Div(col-sm-6 col-sm-offset-3){\n        Form(mt-lg panel panel-primary){\n            Div(panel-body){\n                If(#Id#>0){\n                    Input(Name: Id, Type: hidden, Value: #Id#)\n                    DBFind(\"@1e_events\").WhereId(#Id#).Vars(event)\n                    If(GetVar(MemberId)==\"\"){\n                        SetVar(MemberId, #event_responsible#)\n                    }\n                    If(GetVar(Type)==\"\"){\n                        SetVar(Type, #event_type#)\n                    }\n                }.Else{\n                    SetVar(Id,)\n                }\n                Div(row mb-sm){\n                    Div(col-sm-4 mt text-bold text-right){\n                        $@1e_responsible$\n                    }\n                    Div(col-sm-8 text-left){\n                        Div(input-group){\n                            Div(text-muted mt){\n                                If(GetVar(MemberId)!=\"\"){\n                                    SetVar(AddressMemberId, Address(#MemberId#))\n                                    Div(list-group-item){\n                                        #AddressMemberId#\n                                    }.Style(height: 35px; top: -5px;)\n                                }.Else{\n                                    Div(list-group-item){\n                                        xxxx-xxxx-xxxx-xxxx-xxxx\n                                    }.Style(height: 35px; top: -5px;)\n                                }\n                            }\n                            Div(input-group-btn){\n                                Button(Class: btn bg-gray-lighter fa fa-caret-down buttons, Page: @1select_wallet, PageParams:\"back_page=#this_page#,EcosystemId=#ecosystem_id#,Id=#Id#\").Popup(Header: $@1member$, Width: \"50\")\n                            }.Style(\n                                .buttons {\n                                    border: 1px solid #dde6e9;\n                                    padding: 6px 16px;\n                                }\n                            )\n                        }\n                    }\n                }\n                If(GetVar(MemberId)!=\"\"){\n                    Div(row mb-sm){\n                        Div(col-md-4 mt-sm text-right text-bold){\n                            $@1e_event_name$\n                        }\n                        Div(col-md-8 text-left){\n                            Input(Name: Name, Value: #event_name#)\n                        }\n                    }\n                    Div(row mb-sm){\n                        Div(col-sm-4 mt text-bold text-right){\n                            $@1description$\n                        }\n                        Div(col-sm-8 text-left){\n                            Input(Name: Description, Type: textarea, Value: #event_description#)\n                        }\n                    }\n                    Div(row mb-sm){\n                        Div(col-sm-4 mt-sm text-right text-bold){\n                            $@1e_type$\n                        }\n                        Div(col-sm-8 text-left){\n                            Select(Name: Type, Source: types, NameColumn: value, ValueColumn: key, Value: #Type#)\n                        }\n                    }\n                    Div(row mb-sm){\n                        Div(col-sm-4 mt text-bold text-right){\n                            $@1e_event_address$\n                        }\n                        Div(col-sm-8 text-left){\n                            InputMap(Name: EventAddress, Type: point, MapType: streets, Value: #event_event_address_json#)\n                        }\n                    }\n                    Div(row mb-sm){\n                        Div(col-sm-4 mt-sm text-right text-bold){\n                            $@1e_starting_date$\n                        }\n                        Div(col-sm-8 text-left){\n                            Div(row){\n                                If(#Id#>0){\n                                    Div(col-sm-6){\n                                        SetVar(date, DateTime(#event_starting_date#, Format: YYYY-MM-DD))\n                                        Input(Name:StartingDate, Type:date, Value: #date#)\n                                    }\n                                    Div(col-sm-6){\n                                        SetVar(time, DateTime(#event_starting_date#, Format: HH:MI))\n                                        Input(Name:StartingTime, Type:time, Value: #time#)\n                                    }\n                                }.Else{\n                                    Div(col-sm-6){\n                                        Input(Name:StartingDate, Type:date)\n                                    }\n                                    Div(col-sm-6){\n                                        Input(Name:StartingTime, Type:time, Value: \"00:00\")\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n            Div(panel-footer text-right){\n                Button(Body: $@1back$, Class: btn btn-default, Page: #back_page#)\n                If(GetVar(MemberId)!=\"\"){\n                    Button(Body: $@1send$, Class: btn btn-primary pull-right, Page: #back_page#, Contract: @1EEvent, Params: \"Responsible=#MemberId#\")\n                }\n            }\n        }\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "e_events",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1e_events).(this_table, @1e_events)\nInclude(@1pager_header)\n\nSetTitle($@1e_events$)\nSpan(Class: text-muted h5 m0 mb ml-lg, Body: Span(Class: ml-sm, Body: \"$@1e_desc$\"))\n\nDBFind(\"@1applications\").Where({\"ecosystem\": #ecosystem_id#, \"name\": \"Events\"}).Vars(application)\nSetVar(admin_ids, AppParam(Ecosystem: #ecosystem_id#, App: #application_id#, Name: events_admin_role))\nDBFind(\"@1roles_participants\").Where({\"ecosystem\": #ecosystem_id#, \"$and\": [\"role->id\": {\"$in\": [#admin_ids#]}, \"role->id\": #role_id#], \"member->member_id\": #key_id#, \"deleted\": 0}).Vars(admin_access)\nIf(#admin_access_id#>0){\n    AddToolButton(Title:$@1e_types$, Page: @1e_type_form, Icon: icon-plus).Popup(50, $@1e_types$)\n    AddToolButton(Title:$@1create$, Page: @1e_event_form, Icon: icon-calendar)\n}\n\nSetVar(where_type,)\nIf(#search#){\n    SetVar(where, {\"name\": {\"$like\": \"#search#\"}})\n}.ElseIf(#Type#>0){\n    SetVar(where_type, {type: #Type#})\n    SetVar(where, {\"ecosystem\": #ecosystem_id#, #where_type#})\n}.Else{\n    SetVar(where, {\"ecosystem\": #ecosystem_id#, \"id\":{\"$neq\": 0}}).(Type, 0)\n}\n\nDiv(mr-lg text-right){\n    Button(Page: @1e_events_filter, Class: btn bg-gray-lighter mr-sm, PageParams: \"sort=#sort#,page_par=#page_par#,search=#search#,current_page=#current_page#\", Body: Em(Class: fa fa-filter) $@1filter$).Popup(Header: $@1filter$, Width: \"50\")\n}.Style(margin-top: -28px; z-index: 1001;)\n\nDiv(list-group-item ml-lg mr-lg pt-lg){\n    SetVar(search_name, $@1name$)\n    Include(@1search)\n}\n\nDBFind(#this_table#, src).Where(#where#).Order({\"starting_date\": 1, \"id\": 1}).Limit(#pager_limit#).Offset(#pager_offset#).Columns(\"id,name,description,starting_date,type,event_address_json,event_address_json->address,responsible\").Custom(_responsible){\n    Address(#responsible#)\n}.Custom(_type){\n    SetVar(t_name,)\n    DBFind(@1e_types,tt).Where({\"ecosystem\": #ecosystem_id#, \"id\": #type#}).Columns(\"name\").Vars(t)\n    Span(#t_name#)\n}.Custom(_date){\n    If(#starting_date#>0){\n        Span(Class:text-muted, Body:DateTime(#starting_date#, Format: YYYY-MM-DD HH:MI))\n    }\n}.Custom(_address){\n    Button(Body:#event_address_json.address#, Page: @1e_map, Class: btn btn-link p0 m0, PageParams: \"Coords=#event_address_json#\").Popup(50, $@1e_map$)\n}.Custom(_actions){\n    Button(Page: @1e_event_form, Class: btn btn-default fa fa-pencil pull-right, PageParams: \"Id=#id#\")\n}.Count(count)\n\nDiv(fullscreen){\n    Div(table-responsive ml-lg mr-lg){\n        Div(list-group-item){\n            If(#count# > 0){\n                Table(src, \"$@1id$=id,$@1name$=name,$@1description$=description,$@1e_starting_date$=_date,$@1type$=_type,$@1address$=_address,$@1e_responsible$=_responsible,=_actions\")\n            }.Else{\n                Div(text-center h4 text-muted){\n                    $@1e_events$ $@1not_founded$\n                }\n            }\n        }.Style(\n            margin-top:-15px;\n            tbody > tr:nth-of-type(odd) {\n                background-color: #f8f9fc;\n            }\n        )\n    }\n}\nDiv(mt-sm ml-lg mr-sm mb-sm){\n    Include(@1pager)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "e_events_filter",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1e_events_filter)\nIf(#back_page#==\"\"){\n    SetVar(back_page, @1e_events)\n}\n\nDBFind(@1e_types, t).Where({\"ecosystem\": #ecosystem_id#}).Columns(\"id,name\")\n\nSetVar(types_json,`\"0\":\"$@1e_select_type$\"`)\nForList(t){\n    SetVar(types_json,`#types_json#,\"#id#\":\"#name#\"`)\n}\nJsonToSource(types,{#types_json#})\n\nForm(){\n    Div(row mb-sm){\n        Div(col-md-3 mt-sm text-right text-bold){\n            Label($@1e_type$)\n        }\n        Div(col-md-9 text-left){\n            Select(Name: Type, Source: types, NameColumn: value, ValueColumn: key)\n        }\n    }\n\n    Div(mt pull-right){\n        Button(Class: btn btn-default, Page: #back_page#, Body:$@1e_reset$)\n        Button(Class: btn btn-primary, Page: #back_page#, PageParams: \"Type=Val(Type)\", Body: $@1filter$)\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "e_map",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "If(#back_page#==\"\"){\n    SetVar(back_page, @1e_events)\n}\nJsonToSource(c, #Coords#)\nForList(c){\n    If(#key#==address){\n        Div(Class: mb text-center, Body: #value#)\n    }\n}\nMap(Type: point, Hmap:400, Value: #Coords#)\nDiv(mt text-center){\n    Button(Body: $@1back$, Class: btn btn-primary, Page: #back_page#)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "e_type_form",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1e_type_form).(back_page, @1e_events)\nSetVar(t_name,)\n\nDBFind(@1e_types, t).Where({\"ecosystem\": #ecosystem_id#}).Columns(\"id,name\")\nSetVar(types_json,`\"0\":\"$@1e_new_type$\"`)\nForList(t){\n    SetVar(types_json,`#types_json#,\"#id#\":\"#name#\"`)\n}\nJsonToSource(types,{#types_json#})\n\nForm(){\n    Div(row){\n        Div(col-sm-3 mt-sm text-right text-bold){\n            $@1e_type$\n        }\n        Div(col-sm-9 text-left){\n            Select(Name: Type, Source: types, NameColumn: value, ValueColumn: key, Value: #Type#)\n            Span(Class: text-danger h6, Body: $@1e_types_dec$)\n        }\n    }\n    Div(row mt){\n        Div(col-sm-3 mt-sm text-right text-bold){\n            $@1name$\n        }\n        Div(col-sm-9 text-left){\n            Input(Name: Name, Value: #t_name#)\n        }\n    }\n    Div(mt){\n        Div(){\n            Button(Body: $@1e_create_type$, Class: btn btn-primary pull-right, Page: #back_page#, Contract: @1EType, Params: \"Id=0\")\n        }.Show(Type=0)\n        Div(){\n            Button(Body: $@1e_edit_type$, Class: btn btn-primary pull-right, Page: #back_page#, Contract: @1EType, Params: \"Id=Val(Type)\")\n        }.Hide(Type=0)\n        Button(Body: $@1back$, Class: btn btn-default pull-right, Page: #back_page#)\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "EEvent",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract EEvent {\n    data {\n        Id int \"optional\"\n        Name string\n        Description string\n        Type int\n        StartingDate string\n        StartingTime string\n        EventAddress string\n        Responsible int\n    }\n\n    func dateAddTime(d, t string) string {\n        var dt string\n        if Contains(d, \"T00:00:00Z\") {\n            d = Replace(d, \"T00:00:00Z\", \"\")\n        }\n        if Size(t) == 5 {\n            dt = Sprintf(\"%v %v:00\", d, t)\n        }\n        return dt\n    }\n\n    conditions{\n        $app = DBFind(\"@1applications\").Where({\"ecosystem\": $ecosystem_id, \"name\": \"Events\"}).One(\"id\")\n        var admin_ids int\n        admin_ids = AppParam(Int($app), \"events_admin_role\", $ecosystem_id)\n        var rids array\n        rids = JSONDecode(\"[\"+admin_ids+\"]\")  \n        if !DBFind(\"@1roles_participants\").Where({\"ecosystem\": $ecosystem_id, \"role->id\":{\"$in\":rids}, \"member->member_id\": $key_id, \"deleted\": 0}).Row() {\n            warning LangRes(\"@1access_denied\", \"en\")\n        }\n\n        if $Id > 0 {\n            var event map\n            event = DBFind(\"@1e_events\").Where({\"id\": $Id, \"ecosystem\": $ecosystem_id}).Row()\n            if !event{\n                warning \"The event is not found\"\n            }\n            if event[\"starting_date\"] < $block_time {\n                warning \"The event is not editable\"\n            }\n        }\n\n        $date = UnixDateTime(dateAddTime($StartingDate, $StartingTime))\n        if $date == 0 {\n            warning \"Invalid date\"\n        }\n\n        if !DBFind(\"@1keys\").Where({\"ecosystem\": $ecosystem_id, \"id\": $Responsible}).Row(){\n            warning \"Responsible member is not found\"\n        }\n    }\n\n    action {\n        var addr map encAddr string\n        addr = JSONDecode($EventAddress)\n        addr[\"zoom\"] = 11\n        encAddr = JSONEncode(addr)\n\n        var m map\n        m = {name:$Name, description:$Description, type:$Type, starting_date:$date, event_address_json:encAddr, responsible:$Responsible}\n        if $Id > 0 {\n            DBUpdate(\"@1e_events\", $Id, m)\n        } else {\n            m[\"created_at\"] = $block_time\n            m[\"ecosystem\"] = $ecosystem_id\n            DBInsert(\"@1e_events\", m)\n        }\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "EType",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract EType {\n    data {\n        Id int \"optional\"\n        Name string\n    }\n\n    conditions{\n        $app = DBFind(\"@1applications\").Where({\"ecosystem\": $ecosystem_id, \"name\": \"Events\"}).One(\"id\")\n        var admin_ids int\n        admin_ids = AppParam(Int($app), \"events_admin_role\", $ecosystem_id)\n        var rids array\n        rids = JSONDecode(\"[\"+admin_ids+\"]\")  \n        if !DBFind(\"@1roles_participants\").Where({\"ecosystem\": $ecosystem_id, \"role->id\":{\"$in\":rids}, \"member->member_id\": $key_id, \"deleted\": 0}).Row() {\n            warning LangRes(\"@1access_denied\", \"en\")\n        }\n\n        if DBFind(\"@1e_types\").Where({\"name\": $Name, \"ecosystem\": $ecosystem_id}).Row() {\n            warning \"Type with this name is already exists\"\n        }\n\n        if $Id > 0 {\n            if !DBFind(\"@1e_types\").Where({\"id\": $Id, \"ecosystem\": $ecosystem_id}).Row() {\n                warning \"The type is not found\"\n            }\n        }\n    }\n\n    action {\n        if $Id > 0 {\n            DBUpdate(\"@1e_types\", $Id, {name: $Name})\n        } else {\n            DBInsert(\"@1e_types\", {name: $Name, ecosystem: $ecosystem_id})\n        }\n    }\n}",
            "Type": "contracts"
        }
    ]
}